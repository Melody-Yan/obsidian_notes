"use strict";var obsidian=require("obsidian");function __awaiter(e,o,a,l){return new(a=a||Promise)(function(n,t){function i(e){try{s(l.next(e))}catch(e){t(e)}}function r(e){try{s(l.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(i,r)}s((l=l.apply(e,o||[])).next())})}class StatusBar{constructor(e){this.messages=[],this.statusBarEl=e}displayMessage(e,t,n=!1){this.messages[0]&&this.messages[0].message===e||(this.messages.push({message:"希果壳五彩: "+e.slice(0,100),timeout:1e3*t}),n&&(this.currentMessage=null,this.lastMessageTimestamp=null,this.statusBarEl.setText("")),this.display())}display(){this.currentMessage?Date.now()-this.lastMessageTimestamp>=this.currentMessage.timeout&&(this.currentMessage=null,this.lastMessageTimestamp=null):this.messages.length?(this.currentMessage=this.messages.shift(),this.statusBarEl.setText(this.currentMessage.message),this.lastMessageTimestamp=Date.now()):this.statusBarEl.setText("")}}class BGCONSTS{}BGCONSTS.APPID="20",BGCONSTS.SERVICE_ID=7,BGCONSTS.MARKET_INFO="obsidian-plugin",BGCONSTS.ENDPOINT="obsidianwucai",BGCONSTS.VERSION="24.1.19",BGCONSTS.VERSION_NUM=240119,BGCONSTS.IS_DEBUG=!1,BGCONSTS.TEST_TOKEN="",BGCONSTS.BASE_URL="https://marker.dotalk.cn",BGCONSTS.OUT="json";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return commonjsRequire(e,null==t?n.path:t)}},n.exports),n.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var moment=createCommonjsModule(function(uo,e){uo.exports=function(){var Y,I;function h(){return Y.apply(null,arguments)}function F(e){Y=e}function o(e){return e instanceof Array||Object.prototype.toString.call(e)==="[object Array]"}function W(e){return e!=null&&Object.prototype.toString.call(e)==="[object Object]"}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function B(e){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(e).length===0;else{var t;for(t in e)if(l(e,t))return false;return true}}function a(e){return e===void 0}function u(e){return typeof e==="number"||Object.prototype.toString.call(e)==="[object Number]"}function U(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"}function j(e,t){var n=[],i,r=e.length;for(i=0;i<r;++i)n.push(t(e[i],i));return n}function V(e,t){for(var n in t)if(l(t,n))e[n]=t[n];if(l(t,"toString"))e.toString=t.toString;if(l(t,"valueOf"))e.valueOf=t.valueOf;return e}function c(e,t,n,i){return Jn(e,t,n,i,true).utc()}function K(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidEra:null,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],era:null,meridiem:null,rfc2822:false,weekdayMismatch:false}}function f(e){if(e._pf==null)e._pf=K();return e._pf}if(Array.prototype.some)I=Array.prototype.some;else I=function(e){var t=Object(this),n=t.length>>>0,i;for(i=0;i<n;i++)if(i in t&&e.call(this,t[i],i,t))return true;return false};function G(e){if(e._isValid==null){var t=f(e),n=I.call(t.parsedDateParts,function(e){return e!=null}),i=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict)i=i&&t.charsLeftOver===0&&t.unusedTokens.length===0&&t.bigHour===undefined;if(Object.isFrozen==null||!Object.isFrozen(e))e._isValid=i;else return i}return e._isValid}function H(e){var t=c(NaN);if(e!=null)V(f(t),e);else f(t).userInvalidated=true;return t}var $=h.momentProperties=[],z=false;function q(e,t){var n,i,r,s=$.length;if(!a(t._isAMomentObject))e._isAMomentObject=t._isAMomentObject;if(!a(t._i))e._i=t._i;if(!a(t._f))e._f=t._f;if(!a(t._l))e._l=t._l;if(!a(t._strict))e._strict=t._strict;if(!a(t._tzm))e._tzm=t._tzm;if(!a(t._isUTC))e._isUTC=t._isUTC;if(!a(t._offset))e._offset=t._offset;if(!a(t._pf))e._pf=f(t);if(!a(t._locale))e._locale=t._locale;if(s>0)for(n=0;n<s;n++){i=$[n];r=t[i];if(!a(r))e[i]=r}return e}function Z(e){q(this,e);this._d=new Date(e._d!=null?e._d.getTime():NaN);if(!this.isValid())this._d=new Date(NaN);if(z===false){z=true;h.updateOffset(this);z=false}}function d(e){return e instanceof Z||e!=null&&e._isAMomentObject!=null}function X(e){if(h.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn)console.warn("Deprecation warning: "+e)}function e(s,o){var a=true;return V(function(){if(h.deprecationHandler!=null)h.deprecationHandler(null,s);if(a){var e=[],t,n,i,r=arguments.length;for(n=0;n<r;n++){t="";if(typeof arguments[n]==="object"){t+="\n["+n+"] ";for(i in arguments[0])if(l(arguments[0],i))t+=i+": "+arguments[0][i]+", ";t=t.slice(0,-2)}else t=arguments[n];e.push(t)}X(s+"\nArguments: "+Array.prototype.slice.call(e).join("")+"\n"+(new Error).stack);a=false}return o.apply(this,arguments)},o)}var J={},Q;function ee(e,t){if(h.deprecationHandler!=null)h.deprecationHandler(e,t);if(!J[e]){X(t);J[e]=true}}function p(e){return typeof Function!=="undefined"&&e instanceof Function||Object.prototype.toString.call(e)==="[object Function]"}function te(e){var t,n;for(n in e)if(l(e,n)){t=e[n];if(p(t))this[n]=t;else this["_"+n]=t}this._config=e;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function ne(e,t){var n=V({},e),i;for(i in t)if(l(t,i))if(W(e[i])&&W(t[i])){n[i]={};V(n[i],e[i]);V(n[i],t[i])}else if(t[i]!=null)n[i]=t[i];else delete n[i];for(i in e)if(l(e,i)&&!l(t,i)&&W(e[i]))n[i]=V({},n[i]);return n}function ie(e){if(e!=null)this.set(e)}if(h.suppressDeprecationWarnings=false,h.deprecationHandler=null,Object.keys)Q=Object.keys;else Q=function(e){var t,n=[];for(t in e)if(l(e,t))n.push(t);return n};var re={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function se(e,t,n){var i=this._calendar[e]||this._calendar["sameElse"];return p(i)?i.call(t,n):i}function s(e,t,n){var i=""+Math.abs(e),r=t-i.length,s=e>=0;return(s?n?"+":"":"-")+Math.pow(10,Math.max(0,r)).toString().substr(1)+i}var oe=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,ae=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,le={},ue={};function i(e,t,n,i){var r=i;if(typeof i==="string")r=function(){return this[i]()};if(e)ue[e]=r;if(t)ue[t[0]]=function(){return s(r.apply(this,arguments),t[1],t[2])};if(n)ue[n]=function(){return this.localeData().ordinal(r.apply(this,arguments),e)}}function ce(e){if(e.match(/\[[\s\S]/))return e.replace(/^\[|\]$/g,"");return e.replace(/\\/g,"")}function he(i){var r=i.match(oe),e,s;for(e=0,s=r.length;e<s;e++)if(ue[r[e]])r[e]=ue[r[e]];else r[e]=ce(r[e]);return function(e){var t="",n;for(n=0;n<s;n++)t+=p(r[n])?r[n].call(e,i):r[n];return t}}function fe(e,t){if(!e.isValid())return e.localeData().invalidDate();t=de(t,e.localeData());le[t]=le[t]||he(t);return le[t](e)}function de(e,t){var n=5;function i(e){return t.longDateFormat(e)||e}ae.lastIndex=0;while(n>=0&&ae.test(e)){e=e.replace(ae,i);ae.lastIndex=0;n-=1}return e}var pe={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function me(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];if(t||!n)return t;this._longDateFormat[e]=n.match(oe).map(function(e){if(e==="MMMM"||e==="MM"||e==="DD"||e==="dddd")return e.slice(1);return e}).join("");return this._longDateFormat[e]}var ge="Invalid date";function ye(){return this._invalidDate}var _e="%d",ve=/\d{1,2}/;function we(e){return this._ordinal.replace("%d",e)}var ke={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function be(e,t,n,i){var r=this._relativeTime[n];return p(r)?r(e,t,n,i):r.replace(/%d/i,e)}function Se(e,t){var n=this._relativeTime[e>0?"future":"past"];return p(n)?n(t):n.replace(/%s/i,t)}var xe={};function t(e,t){var n=e.toLowerCase();xe[n]=xe[n+"s"]=xe[t]=e}function m(e){return typeof e==="string"?xe[e]||xe[e.toLowerCase()]:undefined}function Te(e){var t={},n,i;for(i in e)if(l(e,i)){n=m(i);if(n)t[n]=e[i]}return t}var Oe={};function n(e,t){Oe[e]=t}function Ee(e){var t=[],n;for(n in e)if(l(e,n))t.push({unit:n,priority:Oe[n]});t.sort(function(e,t){return e.priority-t.priority});return t}function Ce(e){return e%4===0&&e%100!==0||e%400===0}function g(e){if(e<0)return Math.ceil(e)||0;else return Math.floor(e)}function y(e){var t=+e,n=0;if(t!==0&&isFinite(t))n=g(t);return n}function Le(t,n){return function(e){if(e!=null){Ae(this,t,e);h.updateOffset(this,n);return this}else return Ne(this,t)}}function Ne(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function Ae(e,t,n){if(e.isValid()&&!isNaN(n))if(t==="FullYear"&&Ce(e.year())&&e.month()===1&&e.date()===29){n=y(n);e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),st(n,e.month()))}else e._d["set"+(e._isUTC?"UTC":"")+t](n)}function Me(e){e=m(e);if(p(this[e]))return this[e]();return this}function De(e,t){if(typeof e==="object"){e=Te(e);var n=Ee(e),i,r=n.length;for(i=0;i<r;i++)this[n[i].unit](e[n[i].unit])}else{e=m(e);if(p(this[e]))return this[e](t)}return this}var Re=/\d/,r=/\d\d/,Pe=/\d{3}/,Ye=/\d{4}/,Ie=/[+-]?\d{6}/,_=/\d\d?/,Fe=/\d\d\d\d?/,We=/\d\d\d\d\d\d?/,Be=/\d{1,3}/,Ue=/\d{1,4}/,je=/[+-]?\d{1,6}/,Ve=/\d+/,Ke=/[+-]?\d+/,Ge=/Z|[+-]\d\d:?\d\d/gi,He=/Z|[+-]\d\d(?::?\d\d)?/gi,$e=/[+-]?\d+(\.\d{1,3})?/,ze=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,qe;function v(e,n,i){qe[e]=p(n)?n:function(e,t){return e&&i?i:n}}function Ze(e,t){if(!l(qe,e))return new RegExp(Xe(e));return qe[e](t._strict,t._locale)}function Xe(e){return w(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,r){return t||n||i||r}))}function w(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var qe={},Je={};function k(e,n){var t,i=n,r;if(typeof e==="string")e=[e];if(u(n))i=function(e,t){t[n]=y(e)};r=e.length;for(t=0;t<r;t++)Je[e[t]]=i}function Qe(e,r){k(e,function(e,t,n,i){n._w=n._w||{};r(e,n._w,n,i)})}function et(e,t,n){if(t!=null&&l(Je,e))Je[e](t,n._a,n,e)}var b=0,S=1,x=2,T=3,O=4,E=5,tt=6,nt=7,it=8,C;function rt(e,t){return(e%t+t)%t}if(Array.prototype.indexOf)C=Array.prototype.indexOf;else C=function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1};function st(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=rt(t,12);e+=(t-n)/12;return n===1?Ce(e)?29:28:31-n%7%2}i("M",["MM",2],"Mo",function(){return this.month()+1}),i("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),i("MMMM",0,0,function(e){return this.localeData().months(this,e)}),t("month","M"),n("month",8),v("M",_),v("MM",_,r),v("MMM",function(e,t){return t.monthsShortRegex(e)}),v("MMMM",function(e,t){return t.monthsRegex(e)}),k(["M","MM"],function(e,t){t[S]=y(e)-1}),k(["MMM","MMMM"],function(e,t,n,i){var r=n._locale.monthsParse(e,i,n._strict);if(r!=null)t[S]=r;else f(n).invalidMonth=e});var ot="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),at="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),lt=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,ut=ze,ct=ze;function ht(e,t){if(!e)return o(this._months)?this._months:this._months["standalone"];return o(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||lt).test(t)?"format":"standalone"][e.month()]}function ft(e,t){if(!e)return o(this._monthsShort)?this._monthsShort:this._monthsShort["standalone"];return o(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[lt.test(t)?"format":"standalone"][e.month()]}function dt(e,t,n){var i,r,s,o=e.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){s=c([2e3,i]);this._shortMonthsParse[i]=this.monthsShort(s,"").toLocaleLowerCase();this._longMonthsParse[i]=this.months(s,"").toLocaleLowerCase()}}if(n)if(t==="MMM"){r=C.call(this._shortMonthsParse,o);return r!==-1?r:null}else{r=C.call(this._longMonthsParse,o);return r!==-1?r:null}else if(t==="MMM"){r=C.call(this._shortMonthsParse,o);if(r!==-1)return r;r=C.call(this._longMonthsParse,o);return r!==-1?r:null}else{r=C.call(this._longMonthsParse,o);if(r!==-1)return r;r=C.call(this._shortMonthsParse,o);return r!==-1?r:null}}function pt(e,t,n){var i,r,s;if(this._monthsParseExact)return dt.call(this,e,t,n);if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){r=c([2e3,i]);if(n&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(r,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(r,"").replace(".","")+"$","i")}if(!n&&!this._monthsParse[i]){s="^"+this.months(r,"")+"|^"+this.monthsShort(r,"");this._monthsParse[i]=new RegExp(s.replace(".",""),"i")}if(n&&t==="MMMM"&&this._longMonthsParse[i].test(e))return i;else if(n&&t==="MMM"&&this._shortMonthsParse[i].test(e))return i;else if(!n&&this._monthsParse[i].test(e))return i}}function mt(e,t){var n;if(!e.isValid())return e;if(typeof t==="string")if(/^\d+$/.test(t))t=y(t);else{t=e.localeData().monthsParse(t);if(!u(t))return e}n=Math.min(e.date(),st(e.year(),t));e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n);return e}function gt(e){if(e!=null){mt(this,e);h.updateOffset(this,true);return this}else return Ne(this,"Month")}function yt(){return st(this.year(),this.month())}function _t(e){if(this._monthsParseExact){if(!l(this,"_monthsRegex"))wt.call(this);if(e)return this._monthsShortStrictRegex;else return this._monthsShortRegex}else{if(!l(this,"_monthsShortRegex"))this._monthsShortRegex=ut;return this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex}}function vt(e){if(this._monthsParseExact){if(!l(this,"_monthsRegex"))wt.call(this);if(e)return this._monthsStrictRegex;else return this._monthsRegex}else{if(!l(this,"_monthsRegex"))this._monthsRegex=ct;return this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex}}function wt(){function e(e,t){return t.length-e.length}var t=[],n=[],i=[],r,s;for(r=0;r<12;r++){s=c([2e3,r]);t.push(this.monthsShort(s,""));n.push(this.months(s,""));i.push(this.months(s,""));i.push(this.monthsShort(s,""))}t.sort(e);n.sort(e);i.sort(e);for(r=0;r<12;r++){t[r]=w(t[r]);n[r]=w(n[r])}for(r=0;r<24;r++)i[r]=w(i[r]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i");this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp("^("+n.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+t.join("|")+")","i")}function kt(e){return Ce(e)?366:365}i("Y",0,0,function(){var e=this.year();return e<=9999?s(e,4):"+"+e}),i(0,["YY",2],0,function(){return this.year()%100}),i(0,["YYYY",4],0,"year"),i(0,["YYYYY",5],0,"year"),i(0,["YYYYYY",6,true],0,"year"),t("year","y"),n("year",1),v("Y",Ke),v("YY",_,r),v("YYYY",Ue,Ye),v("YYYYY",je,Ie),v("YYYYYY",je,Ie),k(["YYYYY","YYYYYY"],b),k("YYYY",function(e,t){t[b]=e.length===2?h.parseTwoDigitYear(e):y(e)}),k("YY",function(e,t){t[b]=h.parseTwoDigitYear(e)}),k("Y",function(e,t){t[b]=parseInt(e,10)}),h.parseTwoDigitYear=function(e){return y(e)+(y(e)>68?1900:2e3)};var bt=Le("FullYear",true);function St(){return Ce(this.year())}function xt(e,t,n,i,r,s,o){var a;if(e<100&&e>=0){a=new Date(e+400,t,n,i,r,s,o);if(isFinite(a.getFullYear()))a.setFullYear(e)}else a=new Date(e,t,n,i,r,s,o);return a}function Tt(e){var t,n;if(e<100&&e>=0){n=Array.prototype.slice.call(arguments);n[0]=e+400;t=new Date(Date.UTC.apply(null,n));if(isFinite(t.getUTCFullYear()))t.setUTCFullYear(e)}else t=new Date(Date.UTC.apply(null,arguments));return t}function Ot(e,t,n){var i=7+t-n,r=(7+Tt(e,0,i).getUTCDay()-t)%7;return-r+i-1}function Et(e,t,n,i,r){var s=(7+n-i)%7,o=Ot(e,i,r),a=1+7*(t-1)+s+o,l,u;if(a<=0){l=e-1;u=kt(l)+a}else if(a>kt(e)){l=e+1;u=a-kt(e)}else{l=e;u=a}return{year:l,dayOfYear:u}}function Ct(e,t,n){var i=Ot(e.year(),t,n),r=Math.floor((e.dayOfYear()-i-1)/7)+1,s,o;if(r<1){o=e.year()-1;s=r+L(o,t,n)}else if(r>L(e.year(),t,n)){s=r-L(e.year(),t,n);o=e.year()+1}else{o=e.year();s=r}return{week:s,year:o}}function L(e,t,n){var i=Ot(e,t,n),r=Ot(e+1,t,n);return(kt(e)-i+r)/7}function Lt(e){return Ct(e,this._week.dow,this._week.doy).week}i("w",["ww",2],"wo","week"),i("W",["WW",2],"Wo","isoWeek"),t("week","w"),t("isoWeek","W"),n("week",5),n("isoWeek",5),v("w",_),v("ww",_,r),v("W",_),v("WW",_,r),Qe(["w","ww","W","WW"],function(e,t,n,i){t[i.substr(0,1)]=y(e)});var Nt={dow:0,doy:6};function At(){return this._week.dow}function Mt(){return this._week.doy}function Dt(e){var t=this.localeData().week(this);return e==null?t:this.add((e-t)*7,"d")}function Rt(e){var t=Ct(this,1,4).week;return e==null?t:this.add((e-t)*7,"d")}function Pt(e,t){if(typeof e!=="string")return e;if(!isNaN(e))return parseInt(e,10);e=t.weekdaysParse(e);if(typeof e==="number")return e;return null}function Yt(e,t){if(typeof e==="string")return t.weekdaysParse(e)%7||7;return isNaN(e)?null:e}function It(e,t){return e.slice(t,7).concat(e.slice(0,t))}i("d",0,"do","day"),i("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),i("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),i("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),i("e",0,0,"weekday"),i("E",0,0,"isoWeekday"),t("day","d"),t("weekday","e"),t("isoWeekday","E"),n("day",11),n("weekday",11),n("isoWeekday",11),v("d",_),v("e",_),v("E",_),v("dd",function(e,t){return t.weekdaysMinRegex(e)}),v("ddd",function(e,t){return t.weekdaysShortRegex(e)}),v("dddd",function(e,t){return t.weekdaysRegex(e)}),Qe(["dd","ddd","dddd"],function(e,t,n,i){var r=n._locale.weekdaysParse(e,i,n._strict);if(r!=null)t.d=r;else f(n).invalidWeekday=e}),Qe(["d","e","E"],function(e,t,n,i){t[i]=y(e)});var Ft="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Wt="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Bt="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ut=ze,jt=ze,Vt=ze;function Kt(e,t){var n=o(this._weekdays)?this._weekdays:this._weekdays[e&&e!==true&&this._weekdays.isFormat.test(t)?"format":"standalone"];return e===true?It(n,this._week.dow):e?n[e.day()]:n}function Gt(e){return e===true?It(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort}function Ht(e){return e===true?It(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin}function $t(e,t,n){var i,r,s,o=e.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){s=c([2e3,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(s,"").toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(s,"").toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(s,"").toLocaleLowerCase()}}if(n)if(t==="dddd"){r=C.call(this._weekdaysParse,o);return r!==-1?r:null}else if(t==="ddd"){r=C.call(this._shortWeekdaysParse,o);return r!==-1?r:null}else{r=C.call(this._minWeekdaysParse,o);return r!==-1?r:null}else if(t==="dddd"){r=C.call(this._weekdaysParse,o);if(r!==-1)return r;r=C.call(this._shortWeekdaysParse,o);if(r!==-1)return r;r=C.call(this._minWeekdaysParse,o);return r!==-1?r:null}else if(t==="ddd"){r=C.call(this._shortWeekdaysParse,o);if(r!==-1)return r;r=C.call(this._weekdaysParse,o);if(r!==-1)return r;r=C.call(this._minWeekdaysParse,o);return r!==-1?r:null}else{r=C.call(this._minWeekdaysParse,o);if(r!==-1)return r;r=C.call(this._weekdaysParse,o);if(r!==-1)return r;r=C.call(this._shortWeekdaysParse,o);return r!==-1?r:null}}function zt(e,t,n){var i,r,s;if(this._weekdaysParseExact)return $t.call(this,e,t,n);if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(i=0;i<7;i++){r=c([2e3,1]).day(i);if(n&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(r,"").replace(".","\\.?")+"$","i");this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(r,"").replace(".","\\.?")+"$","i");this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(r,"").replace(".","\\.?")+"$","i")}if(!this._weekdaysParse[i]){s="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,"");this._weekdaysParse[i]=new RegExp(s.replace(".",""),"i")}if(n&&t==="dddd"&&this._fullWeekdaysParse[i].test(e))return i;else if(n&&t==="ddd"&&this._shortWeekdaysParse[i].test(e))return i;else if(n&&t==="dd"&&this._minWeekdaysParse[i].test(e))return i;else if(!n&&this._weekdaysParse[i].test(e))return i}}function qt(e){if(!this.isValid())return e!=null?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();if(e!=null){e=Pt(e,this.localeData());return this.add(e-t,"d")}else return t}function Zt(e){if(!this.isValid())return e!=null?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return e==null?t:this.add(e-t,"d")}function Xt(e){if(!this.isValid())return e!=null?this:NaN;if(e!=null){var t=Yt(e,this.localeData());return this.day(this.day()%7?t:t-7)}else return this.day()||7}function Jt(e){if(this._weekdaysParseExact){if(!l(this,"_weekdaysRegex"))tn.call(this);if(e)return this._weekdaysStrictRegex;else return this._weekdaysRegex}else{if(!l(this,"_weekdaysRegex"))this._weekdaysRegex=Ut;return this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex}}function Qt(e){if(this._weekdaysParseExact){if(!l(this,"_weekdaysRegex"))tn.call(this);if(e)return this._weekdaysShortStrictRegex;else return this._weekdaysShortRegex}else{if(!l(this,"_weekdaysShortRegex"))this._weekdaysShortRegex=jt;return this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}function en(e){if(this._weekdaysParseExact){if(!l(this,"_weekdaysRegex"))tn.call(this);if(e)return this._weekdaysMinStrictRegex;else return this._weekdaysMinRegex}else{if(!l(this,"_weekdaysMinRegex"))this._weekdaysMinRegex=Vt;return this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function tn(){function e(e,t){return t.length-e.length}var t=[],n=[],i=[],r=[],s,o,a,l,u;for(s=0;s<7;s++){o=c([2e3,1]).day(s);a=w(this.weekdaysMin(o,""));l=w(this.weekdaysShort(o,""));u=w(this.weekdays(o,""));t.push(a);n.push(l);i.push(u);r.push(a);r.push(l);r.push(u)}t.sort(e);n.sort(e);i.sort(e);r.sort(e);this._weekdaysRegex=new RegExp("^("+r.join("|")+")","i");this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp("^("+i.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+n.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function nn(){return this.hours()%12||12}function rn(){return this.hours()||24}function sn(e,t){i(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function on(e,t){return t._meridiemParse}function an(e){return(e+"").toLowerCase().charAt(0)==="p"}i("H",["HH",2],0,"hour"),i("h",["hh",2],0,nn),i("k",["kk",2],0,rn),i("hmm",0,0,function(){return""+nn.apply(this)+s(this.minutes(),2)}),i("hmmss",0,0,function(){return""+nn.apply(this)+s(this.minutes(),2)+s(this.seconds(),2)}),i("Hmm",0,0,function(){return""+this.hours()+s(this.minutes(),2)}),i("Hmmss",0,0,function(){return""+this.hours()+s(this.minutes(),2)+s(this.seconds(),2)}),sn("a",true),sn("A",false),t("hour","h"),n("hour",13),v("a",on),v("A",on),v("H",_),v("h",_),v("k",_),v("HH",_,r),v("hh",_,r),v("kk",_,r),v("hmm",Fe),v("hmmss",We),v("Hmm",Fe),v("Hmmss",We),k(["H","HH"],T),k(["k","kk"],function(e,t,n){var i=y(e);t[T]=i===24?0:i}),k(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e);n._meridiem=e}),k(["h","hh"],function(e,t,n){t[T]=y(e);f(n).bigHour=true}),k("hmm",function(e,t,n){var i=e.length-2;t[T]=y(e.substr(0,i));t[O]=y(e.substr(i));f(n).bigHour=true}),k("hmmss",function(e,t,n){var i=e.length-4,r=e.length-2;t[T]=y(e.substr(0,i));t[O]=y(e.substr(i,2));t[E]=y(e.substr(r));f(n).bigHour=true}),k("Hmm",function(e,t,n){var i=e.length-2;t[T]=y(e.substr(0,i));t[O]=y(e.substr(i))}),k("Hmmss",function(e,t,n){var i=e.length-4,r=e.length-2;t[T]=y(e.substr(0,i));t[O]=y(e.substr(i,2));t[E]=y(e.substr(r))});var ln,un=Le("Hours",true);function cn(e,t,n){if(e>11)return n?"pm":"PM";else return n?"am":"AM"}var hn={calendar:re,longDateFormat:pe,invalidDate:ge,ordinal:_e,dayOfMonthOrdinalParse:ve,relativeTime:ke,months:ot,monthsShort:at,week:Nt,weekdays:Ft,weekdaysMin:Bt,weekdaysShort:Wt,meridiemParse:/[ap]\.?m?\.?/i},N={},fn={},dn;function pn(e,t){var n,i=Math.min(e.length,t.length);for(n=0;n<i;n+=1)if(e[n]!==t[n])return n;return i}function mn(e){return e?e.toLowerCase().replace("_","-"):e}function gn(e){var t=0,n,i,r,s;while(t<e.length){s=mn(e[t]).split("-");n=s.length;i=mn(e[t+1]);i=i?i.split("-"):null;while(n>0){r=_n(s.slice(0,n).join("-"));if(r)return r;if(i&&i.length>=n&&pn(s,i)>=n-1)break;n--}t++}return dn}function yn(e){return e.match("^[^/\\\\]*$")!=null}function _n(t){var e=null,n;if(N[t]===undefined&&"object"!=="undefined"&&uo&&uo.exports&&yn(t))try{e=dn._abbr;n=commonjsRequire;n("./locale/"+t);vn(e)}catch(e){N[t]=null}return N[t]}function vn(e,t){var n;if(e){if(a(t))n=bn(e);else n=wn(e,t);if(n)dn=n;else if(typeof console!=="undefined"&&console.warn)console.warn("Locale "+e+" not found. Did you forget to load it?")}return dn._abbr}function wn(e,t){if(t!==null){var n,i=hn;t.abbr=e;if(N[e]!=null){ee("defineLocaleOverride","use moment.updateLocale(localeName, config) to change "+"an existing locale. moment.defineLocale(localeName, "+"config) should only be used for creating a new locale "+"See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");i=N[e]._config}else if(t.parentLocale!=null)if(N[t.parentLocale]!=null)i=N[t.parentLocale]._config;else{n=_n(t.parentLocale);if(n!=null)i=n._config;else{if(!fn[t.parentLocale])fn[t.parentLocale]=[];fn[t.parentLocale].push({name:e,config:t});return null}}N[e]=new ie(ne(i,t));if(fn[e])fn[e].forEach(function(e){wn(e.name,e.config)});vn(e);return N[e]}else{delete N[e];return null}}function kn(e,t){if(t!=null){var n,i,r=hn;if(N[e]!=null&&N[e].parentLocale!=null)N[e].set(ne(N[e]._config,t));else{i=_n(e);if(i!=null)r=i._config;t=ne(r,t);if(i==null)t.abbr=e;n=new ie(t);n.parentLocale=N[e];N[e]=n}vn(e)}else if(N[e]!=null)if(N[e].parentLocale!=null){N[e]=N[e].parentLocale;if(e===vn())vn(e)}else if(N[e]!=null)delete N[e];return N[e]}function bn(e){var t;if(e&&e._locale&&e._locale._abbr)e=e._locale._abbr;if(!e)return dn;if(!o(e)){t=_n(e);if(t)return t;e=[e]}return gn(e)}function Sn(){return Q(N)}function xn(e){var t,n=e._a;if(n&&f(e).overflow===-2){t=n[S]<0||n[S]>11?S:n[x]<1||n[x]>st(n[b],n[S])?x:n[T]<0||n[T]>24||n[T]===24&&(n[O]!==0||n[E]!==0||n[tt]!==0)?T:n[O]<0||n[O]>59?O:n[E]<0||n[E]>59?E:n[tt]<0||n[tt]>999?tt:-1;if(f(e)._overflowDayOfYear&&(t<b||t>x))t=x;if(f(e)._overflowWeeks&&t===-1)t=nt;if(f(e)._overflowWeekday&&t===-1)t=it;f(e).overflow=t}return e}var Tn=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,On=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,En=/Z|[+-]\d\d(?::?\d\d)?/,Cn=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,false],["YYYY",/\d{4}/,false]],Ln=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Nn=/^\/?Date\((-?\d+)/i,An=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Mn={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Dn(e){var t,n,i=e._i,r=Tn.exec(i)||On.exec(i),s,o,a,l,u=Cn.length,c=Ln.length;if(r){f(e).iso=true;for(t=0,n=u;t<n;t++)if(Cn[t][1].exec(r[1])){o=Cn[t][0];s=Cn[t][2]!==false;break}if(o==null){e._isValid=false;return}if(r[3]){for(t=0,n=c;t<n;t++)if(Ln[t][1].exec(r[3])){a=(r[2]||" ")+Ln[t][0];break}if(a==null){e._isValid=false;return}}if(!s&&a!=null){e._isValid=false;return}if(r[4])if(En.exec(r[4]))l="Z";else{e._isValid=false;return}e._f=o+(a||"")+(l||"");Gn(e)}else e._isValid=false}function Rn(e,t,n,i,r,s){var o=[Pn(e),at.indexOf(t),parseInt(n,10),parseInt(i,10),parseInt(r,10)];if(s)o.push(parseInt(s,10));return o}function Pn(e){var t=parseInt(e,10);if(t<=49)return 2e3+t;else if(t<=999)return 1900+t;return t}function Yn(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function In(e,t,n){if(e){var i=Wt.indexOf(e),r=new Date(t[0],t[1],t[2]).getDay();if(i!==r){f(n).weekdayMismatch=true;n._isValid=false;return false}}return true}function Fn(e,t,n){if(e)return Mn[e];else if(t)return 0;else{var i=parseInt(n,10),r=i%100,s=(i-r)/100;return s*60+r}}function Wn(e){var t=An.exec(Yn(e._i)),n;if(t){n=Rn(t[4],t[3],t[2],t[5],t[6],t[7]);if(!In(t[1],n,e))return;e._a=n;e._tzm=Fn(t[8],t[9],t[10]);e._d=Tt.apply(null,e._a);e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm);f(e).rfc2822=true}else e._isValid=false}function Bn(e){var t=Nn.exec(e._i);if(t!==null){e._d=new Date(+t[1]);return}Dn(e);if(e._isValid===false)delete e._isValid;else return;Wn(e);if(e._isValid===false)delete e._isValid;else return;if(e._strict)e._isValid=false;else h.createFromInputFallback(e)}function Un(e,t,n){if(e!=null)return e;if(t!=null)return t;return n}function jn(e){var t=new Date(h.now());if(e._useUTC)return[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()];return[t.getFullYear(),t.getMonth(),t.getDate()]}function Vn(e){var t,n,i=[],r,s,o;if(e._d)return;r=jn(e);if(e._w&&e._a[x]==null&&e._a[S]==null)Kn(e);if(e._dayOfYear!=null){o=Un(e._a[b],r[b]);if(e._dayOfYear>kt(o)||e._dayOfYear===0)f(e)._overflowDayOfYear=true;n=Tt(o,0,e._dayOfYear);e._a[S]=n.getUTCMonth();e._a[x]=n.getUTCDate()}for(t=0;t<3&&e._a[t]==null;++t)e._a[t]=i[t]=r[t];for(;t<7;t++)e._a[t]=i[t]=e._a[t]==null?t===2?1:0:e._a[t];if(e._a[T]===24&&e._a[O]===0&&e._a[E]===0&&e._a[tt]===0){e._nextDay=true;e._a[T]=0}e._d=(e._useUTC?Tt:xt).apply(null,i);s=e._useUTC?e._d.getUTCDay():e._d.getDay();if(e._tzm!=null)e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm);if(e._nextDay)e._a[T]=24;if(e._w&&typeof e._w.d!=="undefined"&&e._w.d!==s)f(e).weekdayMismatch=true}function Kn(e){var t,n,i,r,s,o,a,l,u;t=e._w;if(t.GG!=null||t.W!=null||t.E!=null){s=1;o=4;n=Un(t.GG,e._a[b],Ct(A(),1,4).year);i=Un(t.W,1);r=Un(t.E,1);if(r<1||r>7)l=true}else{s=e._locale._week.dow;o=e._locale._week.doy;u=Ct(A(),s,o);n=Un(t.gg,e._a[b],u.year);i=Un(t.w,u.week);if(t.d!=null){r=t.d;if(r<0||r>6)l=true}else if(t.e!=null){r=t.e+s;if(t.e<0||t.e>6)l=true}else r=s}if(i<1||i>L(n,s,o))f(e)._overflowWeeks=true;else if(l!=null)f(e)._overflowWeekday=true;else{a=Et(n,i,r,s,o);e._a[b]=a.year;e._dayOfYear=a.dayOfYear}}function Gn(e){if(e._f===h.ISO_8601){Dn(e);return}if(e._f===h.RFC_2822){Wn(e);return}e._a=[];f(e).empty=true;var t=""+e._i,n,i,r,s,o,a=t.length,l=0,u,c;r=de(e._f,e._locale).match(oe)||[];c=r.length;for(n=0;n<c;n++){s=r[n];i=(t.match(Ze(s,e))||[])[0];if(i){o=t.substr(0,t.indexOf(i));if(o.length>0)f(e).unusedInput.push(o);t=t.slice(t.indexOf(i)+i.length);l+=i.length}if(ue[s]){if(i)f(e).empty=false;else f(e).unusedTokens.push(s);et(s,i,e)}else if(e._strict&&!i)f(e).unusedTokens.push(s)}f(e).charsLeftOver=a-l;if(t.length>0)f(e).unusedInput.push(t);if(e._a[T]<=12&&f(e).bigHour===true&&e._a[T]>0)f(e).bigHour=undefined;f(e).parsedDateParts=e._a.slice(0);f(e).meridiem=e._meridiem;e._a[T]=Hn(e._locale,e._a[T],e._meridiem);u=f(e).era;if(u!==null)e._a[b]=e._locale.erasConvertYear(u,e._a[b]);Vn(e);xn(e)}function Hn(e,t,n){var i;if(n==null)return t;if(e.meridiemHour!=null)return e.meridiemHour(t,n);else if(e.isPM!=null){i=e.isPM(n);if(i&&t<12)t+=12;if(!i&&t===12)t=0;return t}else return t}function $n(e){var t,n,i,r,s,o,a=false,l=e._f.length;if(l===0){f(e).invalidFormat=true;e._d=new Date(NaN);return}for(r=0;r<l;r++){s=0;o=false;t=q({},e);if(e._useUTC!=null)t._useUTC=e._useUTC;t._f=e._f[r];Gn(t);if(G(t))o=true;s+=f(t).charsLeftOver;s+=f(t).unusedTokens.length*10;f(t).score=s;if(!a){if(i==null||s<i||o){i=s;n=t;if(o)a=true}}else if(s<i){i=s;n=t}}V(e,n||t)}function zn(e){if(e._d)return;var t=Te(e._i),n=t.day===undefined?t.date:t.day;e._a=j([t.year,t.month,n,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)});Vn(e)}function qn(e){var t=new Z(xn(Zn(e)));if(t._nextDay){t.add(1,"d");t._nextDay=undefined}return t}function Zn(e){var t=e._i,n=e._f;e._locale=e._locale||bn(e._l);if(t===null||n===undefined&&t==="")return H({nullInput:true});if(typeof t==="string")e._i=t=e._locale.preparse(t);if(d(t))return new Z(xn(t));else if(U(t))e._d=t;else if(o(n))$n(e);else if(n)Gn(e);else Xn(e);if(!G(e))e._d=null;return e}function Xn(e){var t=e._i;if(a(t))e._d=new Date(h.now());else if(U(t))e._d=new Date(t.valueOf());else if(typeof t==="string")Bn(e);else if(o(t)){e._a=j(t.slice(0),function(e){return parseInt(e,10)});Vn(e)}else if(W(t))zn(e);else if(u(t))e._d=new Date(t);else h.createFromInputFallback(e)}function Jn(e,t,n,i,r){var s={};if(t===true||t===false){i=t;t=undefined}if(n===true||n===false){i=n;n=undefined}if(W(e)&&B(e)||o(e)&&e.length===0)e=undefined;s._isAMomentObject=true;s._useUTC=s._isUTC=r;s._l=n;s._i=e;s._f=t;s._strict=i;return qn(s)}function A(e,t,n,i){return Jn(e,t,n,i,false)}h.createFromInputFallback=e("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), "+"which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are "+"discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),h.ISO_8601=function(){},h.RFC_2822=function(){};var Qn=e("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=A.apply(null,arguments);if(this.isValid()&&e.isValid())return e<this?this:e;else return H()}),ei=e("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=A.apply(null,arguments);if(this.isValid()&&e.isValid())return e>this?this:e;else return H()});function ti(e,t){var n,i;if(t.length===1&&o(t[0]))t=t[0];if(!t.length)return A();n=t[0];for(i=1;i<t.length;++i)if(!t[i].isValid()||t[i][e](n))n=t[i];return n}function ni(){var e=[].slice.call(arguments,0);return ti("isBefore",e)}function ii(){var e=[].slice.call(arguments,0);return ti("isAfter",e)}var ri=function(){return Date.now?Date.now():+new Date},si=["year","quarter","month","week","day","hour","minute","second","millisecond"];function oi(e){var t,n=false,i,r=si.length;for(t in e)if(l(e,t)&&!(C.call(si,t)!==-1&&(e[t]==null||!isNaN(e[t]))))return false;for(i=0;i<r;++i)if(e[si[i]]){if(n)return false;if(parseFloat(e[si[i]])!==y(e[si[i]]))n=true}return true}function ai(){return this._isValid}function li(){return M(NaN)}function ui(e){var t=Te(e),n=t.year||0,i=t.quarter||0,r=t.month||0,s=t.week||t.isoWeek||0,o=t.day||0,a=t.hour||0,l=t.minute||0,u=t.second||0,c=t.millisecond||0;this._isValid=oi(t);this._milliseconds=+c+u*1e3+l*6e4+a*1e3*60*60;this._days=+o+s*7;this._months=+r+i*3+n*12;this._data={};this._locale=bn();this._bubble()}function ci(e){return e instanceof ui}function hi(e){if(e<0)return Math.round(-1*e)*-1;else return Math.round(e)}function fi(e,t,n){var i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),s=0,o;for(o=0;o<i;o++)if(n&&e[o]!==t[o]||!n&&y(e[o])!==y(t[o]))s++;return s+r}function di(e,n){i(e,0,0,function(){var e=this.utcOffset(),t="+";if(e<0){e=-e;t="-"}return t+s(~~(e/60),2)+n+s(~~e%60,2)})}di("Z",":"),di("ZZ",""),v("Z",He),v("ZZ",He),k(["Z","ZZ"],function(e,t,n){n._useUTC=true;n._tzm=mi(He,e)});var pi=/([\+\-]|\d\d)/gi;function mi(e,t){var n=(t||"").match(e),i,r,s;if(n===null)return null;i=n[n.length-1]||[];r=(i+"").match(pi)||["-",0,0];s=+(r[1]*60)+y(r[2]);return s===0?0:r[0]==="+"?s:-s}function gi(e,t){var n,i;if(t._isUTC){n=t.clone();i=(d(e)||U(e)?e.valueOf():A(e).valueOf())-n.valueOf();n._d.setTime(n._d.valueOf()+i);h.updateOffset(n,false);return n}else return A(e).local()}function yi(e){return-Math.round(e._d.getTimezoneOffset())}function _i(e,t,n){var i=this._offset||0,r;if(!this.isValid())return e!=null?this:NaN;if(e!=null){if(typeof e==="string"){e=mi(He,e);if(e===null)return this}else if(Math.abs(e)<16&&!n)e=e*60;if(!this._isUTC&&t)r=yi(this);this._offset=e;this._isUTC=true;if(r!=null)this.add(r,"m");if(i!==e)if(!t||this._changeInProgress)Pi(this,M(e-i,"m"),1,false);else if(!this._changeInProgress){this._changeInProgress=true;h.updateOffset(this,true);this._changeInProgress=null}return this}else return this._isUTC?i:yi(this)}function vi(e,t){if(e!=null){if(typeof e!=="string")e=-e;this.utcOffset(e,t);return this}else return-this.utcOffset()}function wi(e){return this.utcOffset(0,e)}function ki(e){if(this._isUTC){this.utcOffset(0,e);this._isUTC=false;if(e)this.subtract(yi(this),"m")}return this}function bi(){if(this._tzm!=null)this.utcOffset(this._tzm,false,true);else if(typeof this._i==="string"){var e=mi(Ge,this._i);if(e!=null)this.utcOffset(e);else this.utcOffset(0,true)}return this}function Si(e){if(!this.isValid())return false;e=e?A(e).utcOffset():0;return(this.utcOffset()-e)%60===0}function xi(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Ti(){if(!a(this._isDSTShifted))return this._isDSTShifted;var e={},t;q(e,this);e=Zn(e);if(e._a){t=e._isUTC?c(e._a):A(e._a);this._isDSTShifted=this.isValid()&&fi(e._a,t.toArray())>0}else this._isDSTShifted=false;return this._isDSTShifted}function Oi(){return this.isValid()?!this._isUTC:false}function Ei(){return this.isValid()?this._isUTC:false}function Ci(){return this.isValid()?this._isUTC&&this._offset===0:false}h.updateOffset=function(){};var Li=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Ni=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function M(e,t){var n=e,i=null,r,s,o;if(ci(e))n={ms:e._milliseconds,d:e._days,M:e._months};else if(u(e)||!isNaN(+e)){n={};if(t)n[t]=+e;else n.milliseconds=+e}else if(i=Li.exec(e)){r=i[1]==="-"?-1:1;n={y:0,d:y(i[x])*r,h:y(i[T])*r,m:y(i[O])*r,s:y(i[E])*r,ms:y(hi(i[tt]*1e3))*r}}else if(i=Ni.exec(e)){r=i[1]==="-"?-1:1;n={y:Ai(i[2],r),M:Ai(i[3],r),w:Ai(i[4],r),d:Ai(i[5],r),h:Ai(i[6],r),m:Ai(i[7],r),s:Ai(i[8],r)}}else if(n==null)n={};else if(typeof n==="object"&&("from"in n||"to"in n)){o=Di(A(n.from),A(n.to));n={};n.ms=o.milliseconds;n.M=o.months}s=new ui(n);if(ci(e)&&l(e,"_locale"))s._locale=e._locale;if(ci(e)&&l(e,"_isValid"))s._isValid=e._isValid;return s}function Ai(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Mi(e,t){var n={};n.months=t.month()-e.month()+(t.year()-e.year())*12;if(e.clone().add(n.months,"M").isAfter(t))--n.months;n.milliseconds=+t-+e.clone().add(n.months,"M");return n}function Di(e,t){var n;if(!(e.isValid()&&t.isValid()))return{milliseconds:0,months:0};t=gi(t,e);if(e.isBefore(t))n=Mi(e,t);else{n=Mi(t,e);n.milliseconds=-n.milliseconds;n.months=-n.months}return n}function Ri(r,s){return function(e,t){var n,i;if(t!==null&&!isNaN(+t)){ee(s,"moment()."+s+"(period, number) is deprecated. Please use moment()."+s+"(number, period). "+"See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");i=e;e=t;t=i}n=M(e,t);Pi(this,n,r);return this}}function Pi(e,t,n,i){var r=t._milliseconds,s=hi(t._days),o=hi(t._months);if(!e.isValid())return;i=i==null?true:i;if(o)mt(e,Ne(e,"Month")+o*n);if(s)Ae(e,"Date",Ne(e,"Date")+s*n);if(r)e._d.setTime(e._d.valueOf()+r*n);if(i)h.updateOffset(e,s||o)}M.fn=ui.prototype,M.invalid=li;var Yi=Ri(1,"add"),Ii=Ri(-1,"subtract");function Fi(e){return typeof e==="string"||e instanceof String}function Wi(e){return d(e)||U(e)||Fi(e)||u(e)||Ui(e)||Bi(e)||e===null||e===undefined}function Bi(e){var t=W(e)&&!B(e),n=false,i=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],r,s,o=i.length;for(r=0;r<o;r+=1){s=i[r];n=n||l(e,s)}return t&&n}function Ui(t){var e=o(t),n=false;if(e)n=t.filter(function(e){return!u(e)&&Fi(t)}).length===0;return e&&n}function ji(e){var t=W(e)&&!B(e),n=false,i=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],r,s;for(r=0;r<i.length;r+=1){s=i[r];n=n||l(e,s)}return t&&n}function Vi(e,t){var n=e.diff(t,"days",true);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"}function Ki(e,t){if(arguments.length===1)if(!arguments[0]){e=undefined;t=undefined}else if(Wi(arguments[0])){e=arguments[0];t=undefined}else if(ji(arguments[0])){t=arguments[0];e=undefined}var n=e||A(),i=gi(n,this).startOf("day"),r=h.calendarFormat(this,i)||"sameElse",s=t&&(p(t[r])?t[r].call(this,n):t[r]);return this.format(s||this.localeData().calendar(r,this,A(n)))}function Gi(){return new Z(this)}function Hi(e,t){var n=d(e)?e:A(e);if(!(this.isValid()&&n.isValid()))return false;t=m(t)||"millisecond";if(t==="millisecond")return this.valueOf()>n.valueOf();else return n.valueOf()<this.clone().startOf(t).valueOf()}function $i(e,t){var n=d(e)?e:A(e);if(!(this.isValid()&&n.isValid()))return false;t=m(t)||"millisecond";if(t==="millisecond")return this.valueOf()<n.valueOf();else return this.clone().endOf(t).valueOf()<n.valueOf()}function zi(e,t,n,i){var r=d(e)?e:A(e),s=d(t)?t:A(t);if(!(this.isValid()&&r.isValid()&&s.isValid()))return false;i=i||"()";return(i[0]==="("?this.isAfter(r,n):!this.isBefore(r,n))&&(i[1]===")"?this.isBefore(s,n):!this.isAfter(s,n))}function qi(e,t){var n=d(e)?e:A(e),i;if(!(this.isValid()&&n.isValid()))return false;t=m(t)||"millisecond";if(t==="millisecond")return this.valueOf()===n.valueOf();else{i=n.valueOf();return this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()}}function Zi(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function Xi(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function Ji(e,t,n){var i,r,s;if(!this.isValid())return NaN;i=gi(e,this);if(!i.isValid())return NaN;r=(i.utcOffset()-this.utcOffset())*6e4;t=m(t);switch(t){case"year":s=Qi(this,i)/12;break;case"month":s=Qi(this,i);break;case"quarter":s=Qi(this,i)/3;break;case"second":s=(this-i)/1e3;break;case"minute":s=(this-i)/6e4;break;case"hour":s=(this-i)/36e5;break;case"day":s=(this-i-r)/864e5;break;case"week":s=(this-i-r)/6048e5;break;default:s=this-i}return n?s:g(s)}function Qi(e,t){if(e.date()<t.date())return-Qi(t,e);var n=(t.year()-e.year())*12+(t.month()-e.month()),i=e.clone().add(n,"months"),r,s;if(t-i<0){r=e.clone().add(n-1,"months");s=(t-i)/(i-r)}else{r=e.clone().add(n+1,"months");s=(t-i)/(r-i)}return-(n+s)||0}function er(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function tr(e){if(!this.isValid())return null;var t=e!==true,n=t?this.clone().utc():this;if(n.year()<0||n.year()>9999)return fe(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ");if(p(Date.prototype.toISOString))if(t)return this.toDate().toISOString();else return new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",fe(n,"Z"));return fe(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function nr(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="",n,i,r,s;if(!this.isLocal()){e=this.utcOffset()===0?"moment.utc":"moment.parseZone";t="Z"}n="["+e+'("]';i=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY";r="-MM-DD[T]HH:mm:ss.SSS";s=t+'[")]';return this.format(n+i+r+s)}function ir(e){if(!e)e=this.isUtc()?h.defaultFormatUtc:h.defaultFormat;var t=fe(this,e);return this.localeData().postformat(t)}function rr(e,t){if(this.isValid()&&(d(e)&&e.isValid()||A(e).isValid()))return M({to:this,from:e}).locale(this.locale()).humanize(!t);else return this.localeData().invalidDate()}function sr(e){return this.from(A(),e)}function or(e,t){if(this.isValid()&&(d(e)&&e.isValid()||A(e).isValid()))return M({from:this,to:e}).locale(this.locale()).humanize(!t);else return this.localeData().invalidDate()}function ar(e){return this.to(A(),e)}function lr(e){var t;if(e===undefined)return this._locale._abbr;else{t=bn(e);if(t!=null)this._locale=t;return this}}h.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",h.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var ur=e("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){if(e===undefined)return this.localeData();else return this.locale(e)});function cr(){return this._locale}var hr=1e3,fr=60*hr,dr=60*fr,pr=(365*400+97)*24*dr;function mr(e,t){return(e%t+t)%t}function gr(e,t,n){if(e<100&&e>=0)return new Date(e+400,t,n)-pr;else return new Date(e,t,n).valueOf()}function yr(e,t,n){if(e<100&&e>=0)return Date.UTC(e+400,t,n)-pr;else return Date.UTC(e,t,n)}function _r(e){var t,n;e=m(e);if(e===undefined||e==="millisecond"||!this.isValid())return this;n=this._isUTC?yr:gr;switch(e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf();t-=mr(t+(this._isUTC?0:this.utcOffset()*fr),dr);break;case"minute":t=this._d.valueOf();t-=mr(t,fr);break;case"second":t=this._d.valueOf();t-=mr(t,hr);break}this._d.setTime(t);h.updateOffset(this,true);return this}function vr(e){var t,n;e=m(e);if(e===undefined||e==="millisecond"||!this.isValid())return this;n=this._isUTC?yr:gr;switch(e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf();t+=dr-mr(t+(this._isUTC?0:this.utcOffset()*fr),dr)-1;break;case"minute":t=this._d.valueOf();t+=fr-mr(t,fr)-1;break;case"second":t=this._d.valueOf();t+=hr-mr(t,hr)-1;break}this._d.setTime(t);h.updateOffset(this,true);return this}function wr(){return this._d.valueOf()-(this._offset||0)*6e4}function kr(){return Math.floor(this.valueOf()/1e3)}function br(){return new Date(this.valueOf())}function Sr(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function xr(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function Tr(){return this.isValid()?this.toISOString():null}function Or(){return G(this)}function Er(){return V({},f(this))}function Cr(){return f(this).overflow}function Lr(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Nr(e,t){var n,i,r,s=this._eras||bn("en")._eras;for(n=0,i=s.length;n<i;++n){switch(typeof s[n].since){case"string":r=h(s[n].since).startOf("day");s[n].since=r.valueOf();break}switch(typeof s[n].until){case"undefined":s[n].until=+Infinity;break;case"string":r=h(s[n].until).startOf("day").valueOf();s[n].until=r.valueOf();break}}return s}function Ar(e,t,n){var i,r,s=this.eras(),o,a,l;e=e.toUpperCase();for(i=0,r=s.length;i<r;++i){o=s[i].name.toUpperCase();a=s[i].abbr.toUpperCase();l=s[i].narrow.toUpperCase();if(n)switch(t){case"N":case"NN":case"NNN":if(a===e)return s[i];break;case"NNNN":if(o===e)return s[i];break;case"NNNNN":if(l===e)return s[i];break}else if([o,a,l].indexOf(e)>=0)return s[i]}}function Mr(e,t){var n=e.since<=e.until?+1:-1;if(t===undefined)return h(e.since).year();else return h(e.since).year()+(t-e.offset)*n}function Dr(){var e,t,n,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e){n=this.clone().startOf("day").valueOf();if(i[e].since<=n&&n<=i[e].until)return i[e].name;if(i[e].until<=n&&n<=i[e].since)return i[e].name}return""}function Rr(){var e,t,n,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e){n=this.clone().startOf("day").valueOf();if(i[e].since<=n&&n<=i[e].until)return i[e].narrow;if(i[e].until<=n&&n<=i[e].since)return i[e].narrow}return""}function Pr(){var e,t,n,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e){n=this.clone().startOf("day").valueOf();if(i[e].since<=n&&n<=i[e].until)return i[e].abbr;if(i[e].until<=n&&n<=i[e].since)return i[e].abbr}return""}function Yr(){var e,t,n,i,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){n=r[e].since<=r[e].until?+1:-1;i=this.clone().startOf("day").valueOf();if(r[e].since<=i&&i<=r[e].until||r[e].until<=i&&i<=r[e].since)return(this.year()-h(r[e].since).year())*n+r[e].offset}return this.year()}function Ir(e){if(!l(this,"_erasNameRegex"))Kr.call(this);return e?this._erasNameRegex:this._erasRegex}function Fr(e){if(!l(this,"_erasAbbrRegex"))Kr.call(this);return e?this._erasAbbrRegex:this._erasRegex}function Wr(e){if(!l(this,"_erasNarrowRegex"))Kr.call(this);return e?this._erasNarrowRegex:this._erasRegex}function Br(e,t){return t.erasAbbrRegex(e)}function Ur(e,t){return t.erasNameRegex(e)}function jr(e,t){return t.erasNarrowRegex(e)}function Vr(e,t){return t._eraYearOrdinalRegex||Ve}function Kr(){var e=[],t=[],n=[],i=[],r,s,o=this.eras();for(r=0,s=o.length;r<s;++r){t.push(w(o[r].name));e.push(w(o[r].abbr));n.push(w(o[r].narrow));i.push(w(o[r].name));i.push(w(o[r].abbr));i.push(w(o[r].narrow))}this._erasRegex=new RegExp("^("+i.join("|")+")","i");this._erasNameRegex=new RegExp("^("+t.join("|")+")","i");this._erasAbbrRegex=new RegExp("^("+e.join("|")+")","i");this._erasNarrowRegex=new RegExp("^("+n.join("|")+")","i")}function Gr(e,t){i(0,[e,e.length],0,t)}function Hr(e){return Jr.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function $r(e){return Jr.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function zr(){return L(this.year(),1,4)}function qr(){return L(this.isoWeekYear(),1,4)}function Zr(){var e=this.localeData()._week;return L(this.year(),e.dow,e.doy)}function Xr(){var e=this.localeData()._week;return L(this.weekYear(),e.dow,e.doy)}function Jr(e,t,n,i,r){var s;if(e==null)return Ct(this,i,r).year;else{s=L(e,i,r);if(t>s)t=s;return Qr.call(this,e,t,n,i,r)}}function Qr(e,t,n,i,r){var s=Et(e,t,n,i,r),o=Tt(s.year,0,s.dayOfYear);this.year(o.getUTCFullYear());this.month(o.getUTCMonth());this.date(o.getUTCDate());return this}function es(e){return e==null?Math.ceil((this.month()+1)/3):this.month((e-1)*3+this.month()%3)}i("N",0,0,"eraAbbr"),i("NN",0,0,"eraAbbr"),i("NNN",0,0,"eraAbbr"),i("NNNN",0,0,"eraName"),i("NNNNN",0,0,"eraNarrow"),i("y",["y",1],"yo","eraYear"),i("y",["yy",2],0,"eraYear"),i("y",["yyy",3],0,"eraYear"),i("y",["yyyy",4],0,"eraYear"),v("N",Br),v("NN",Br),v("NNN",Br),v("NNNN",Ur),v("NNNNN",jr),k(["N","NN","NNN","NNNN","NNNNN"],function(e,t,n,i){var r=n._locale.erasParse(e,i,n._strict);if(r)f(n).era=r;else f(n).invalidEra=e}),v("y",Ve),v("yy",Ve),v("yyy",Ve),v("yyyy",Ve),v("yo",Vr),k(["y","yy","yyy","yyyy"],b),k(["yo"],function(e,t,n,i){var r;if(n._locale._eraYearOrdinalRegex)r=e.match(n._locale._eraYearOrdinalRegex);if(n._locale.eraYearOrdinalParse)t[b]=n._locale.eraYearOrdinalParse(e,r);else t[b]=parseInt(e,10)}),i(0,["gg",2],0,function(){return this.weekYear()%100}),i(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Gr("gggg","weekYear"),Gr("ggggg","weekYear"),Gr("GGGG","isoWeekYear"),Gr("GGGGG","isoWeekYear"),t("weekYear","gg"),t("isoWeekYear","GG"),n("weekYear",1),n("isoWeekYear",1),v("G",Ke),v("g",Ke),v("GG",_,r),v("gg",_,r),v("GGGG",Ue,Ye),v("gggg",Ue,Ye),v("GGGGG",je,Ie),v("ggggg",je,Ie),Qe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,i){t[i.substr(0,2)]=y(e)}),Qe(["gg","GG"],function(e,t,n,i){t[i]=h.parseTwoDigitYear(e)}),i("Q",0,"Qo","quarter"),t("quarter","Q"),n("quarter",7),v("Q",Re),k("Q",function(e,t){t[S]=(y(e)-1)*3}),i("D",["DD",2],"Do","date"),t("date","D"),n("date",9),v("D",_),v("DD",_,r),v("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),k(["D","DD"],x),k("Do",function(e,t){t[x]=y(e.match(_)[0])});var ts=Le("Date",true);function ns(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return e==null?t:this.add(e-t,"d")}i("DDD",["DDDD",3],"DDDo","dayOfYear"),t("dayOfYear","DDD"),n("dayOfYear",4),v("DDD",Be),v("DDDD",Pe),k(["DDD","DDDD"],function(e,t,n){n._dayOfYear=y(e)}),i("m",["mm",2],0,"minute"),t("minute","m"),n("minute",14),v("m",_),v("mm",_,r),k(["m","mm"],O);var is=Le("Minutes",false),rs=(i("s",["ss",2],0,"second"),t("second","s"),n("second",15),v("s",_),v("ss",_,r),k(["s","ss"],E),Le("Seconds",false)),ss,os;for(i("S",0,0,function(){return~~(this.millisecond()/100)}),i(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),i(0,["SSS",3],0,"millisecond"),i(0,["SSSS",4],0,function(){return this.millisecond()*10}),i(0,["SSSSS",5],0,function(){return this.millisecond()*100}),i(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),i(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),i(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),i(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),t("millisecond","ms"),n("millisecond",16),v("S",Be,Re),v("SS",Be,r),v("SSS",Be,Pe),ss="SSSS";ss.length<=9;ss+="S")v(ss,Ve);function as(e,t){t[tt]=y(("0."+e)*1e3)}for(ss="S";ss.length<=9;ss+="S")k(ss,as);function ls(){return this._isUTC?"UTC":""}function us(){return this._isUTC?"Coordinated Universal Time":""}os=Le("Milliseconds",false),i("z",0,0,"zoneAbbr"),i("zz",0,0,"zoneName");var D=Z.prototype;if(D.add=Yi,D.calendar=Ki,D.clone=Gi,D.diff=Ji,D.endOf=vr,D.format=ir,D.from=rr,D.fromNow=sr,D.to=or,D.toNow=ar,D.get=Me,D.invalidAt=Cr,D.isAfter=Hi,D.isBefore=$i,D.isBetween=zi,D.isSame=qi,D.isSameOrAfter=Zi,D.isSameOrBefore=Xi,D.isValid=Or,D.lang=ur,D.locale=lr,D.localeData=cr,D.max=ei,D.min=Qn,D.parsingFlags=Er,D.set=De,D.startOf=_r,D.subtract=Ii,D.toArray=Sr,D.toObject=xr,D.toDate=br,D.toISOString=tr,D.inspect=nr,typeof Symbol!=="undefined"&&Symbol.for!=null)D[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"};function cs(e){return A(e*1e3)}function hs(){return A.apply(null,arguments).parseZone()}function fs(e){return e}D.toJSON=Tr,D.toString=er,D.unix=kr,D.valueOf=wr,D.creationData=Lr,D.eraName=Dr,D.eraNarrow=Rr,D.eraAbbr=Pr,D.eraYear=Yr,D.year=bt,D.isLeapYear=St,D.weekYear=Hr,D.isoWeekYear=$r,D.quarter=D.quarters=es,D.month=gt,D.daysInMonth=yt,D.week=D.weeks=Dt,D.isoWeek=D.isoWeeks=Rt,D.weeksInYear=Zr,D.weeksInWeekYear=Xr,D.isoWeeksInYear=zr,D.isoWeeksInISOWeekYear=qr,D.date=ts,D.day=D.days=qt,D.weekday=Zt,D.isoWeekday=Xt,D.dayOfYear=ns,D.hour=D.hours=un,D.minute=D.minutes=is,D.second=D.seconds=rs,D.millisecond=D.milliseconds=os,D.utcOffset=_i,D.utc=wi,D.local=ki,D.parseZone=bi,D.hasAlignedHourOffset=Si,D.isDST=xi,D.isLocal=Oi,D.isUtcOffset=Ei,D.isUtc=Ci,D.isUTC=Ci,D.zoneAbbr=ls,D.zoneName=us,D.dates=e("dates accessor is deprecated. Use date instead.",ts),D.months=e("months accessor is deprecated. Use month instead",gt),D.years=e("years accessor is deprecated. Use year instead",bt),D.zone=e("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",vi),D.isDSTShifted=e("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Ti);var R=ie.prototype;function ds(e,t,n,i){var r=bn(),s=c().set(i,t);return r[n](s,e)}function ps(e,t,n){if(u(e)){t=e;e=undefined}e=e||"";if(t!=null)return ds(e,t,n,"month");var i,r=[];for(i=0;i<12;i++)r[i]=ds(e,i,n,"month");return r}function ms(e,t,n,i){if(typeof e==="boolean"){if(u(t)){n=t;t=undefined}t=t||""}else{t=e;n=t;e=false;if(u(t)){n=t;t=undefined}t=t||""}var r=bn(),s=e?r._week.dow:0,o,a=[];if(n!=null)return ds(t,(n+s)%7,i,"day");for(o=0;o<7;o++)a[o]=ds(t,(o+s)%7,i,"day");return a}function gs(e,t){return ps(e,t,"months")}function ys(e,t){return ps(e,t,"monthsShort")}function _s(e,t,n){return ms(e,t,n,"weekdays")}function vs(e,t,n){return ms(e,t,n,"weekdaysShort")}function ws(e,t,n){return ms(e,t,n,"weekdaysMin")}R.calendar=se,R.longDateFormat=me,R.invalidDate=ye,R.ordinal=we,R.preparse=fs,R.postformat=fs,R.relativeTime=be,R.pastFuture=Se,R.set=te,R.eras=Nr,R.erasParse=Ar,R.erasConvertYear=Mr,R.erasAbbrRegex=Fr,R.erasNameRegex=Ir,R.erasNarrowRegex=Wr,R.months=ht,R.monthsShort=ft,R.monthsParse=pt,R.monthsRegex=vt,R.monthsShortRegex=_t,R.week=Lt,R.firstDayOfYear=Mt,R.firstDayOfWeek=At,R.weekdays=Kt,R.weekdaysMin=Ht,R.weekdaysShort=Gt,R.weekdaysParse=zt,R.weekdaysRegex=Jt,R.weekdaysShortRegex=Qt,R.weekdaysMinRegex=en,R.isPM=an,R.meridiem=cn,vn("en",{eras:[{since:"0001-01-01",until:+Infinity,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-Infinity,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=y(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}}),h.lang=e("moment.lang is deprecated. Use moment.locale instead.",vn),h.langData=e("moment.langData is deprecated. Use moment.localeData instead.",bn);var ks=Math.abs;function bs(){var e=this._data;this._milliseconds=ks(this._milliseconds);this._days=ks(this._days);this._months=ks(this._months);e.milliseconds=ks(e.milliseconds);e.seconds=ks(e.seconds);e.minutes=ks(e.minutes);e.hours=ks(e.hours);e.months=ks(e.months);e.years=ks(e.years);return this}function Ss(e,t,n,i){var r=M(t,n);e._milliseconds+=i*r._milliseconds;e._days+=i*r._days;e._months+=i*r._months;return e._bubble()}function xs(e,t){return Ss(this,e,t,1)}function Ts(e,t){return Ss(this,e,t,-1)}function Os(e){if(e<0)return Math.floor(e);else return Math.ceil(e)}function Es(){var e=this._milliseconds,t=this._days,n=this._months,i=this._data,r,s,o,a,l;if(!(e>=0&&t>=0&&n>=0||e<=0&&t<=0&&n<=0)){e+=Os(Ls(n)+t)*864e5;t=0;n=0}i.milliseconds=e%1e3;r=g(e/1e3);i.seconds=r%60;s=g(r/60);i.minutes=s%60;o=g(s/60);i.hours=o%24;t+=g(o/24);l=g(Cs(t));n+=l;t-=Os(Ls(l));a=g(n/12);n%=12;i.days=t;i.months=n;i.years=a;return this}function Cs(e){return e*4800/146097}function Ls(e){return e*146097/4800}function Ns(e){if(!this.isValid())return NaN;var t,n,i=this._milliseconds;e=m(e);if(e==="month"||e==="quarter"||e==="year"){t=this._days+i/864e5;n=this._months+Cs(t);switch(e){case"month":return n;case"quarter":return n/3;case"year":return n/12}}else{t=this._days+Math.round(Ls(this._months));switch(e){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return t*24+i/36e5;case"minute":return t*1440+i/6e4;case"second":return t*86400+i/1e3;case"millisecond":return Math.floor(t*864e5)+i;default:throw new Error("Unknown unit "+e)}}}function As(){if(!this.isValid())return NaN;return this._milliseconds+this._days*864e5+this._months%12*2592e6+y(this._months/12)*31536e6}function Ms(e){return function(){return this.as(e)}}var Ds=Ms("ms"),Rs=Ms("s"),Ps=Ms("m"),Ys=Ms("h"),Is=Ms("d"),Fs=Ms("w"),Ws=Ms("M"),Bs=Ms("Q"),Us=Ms("y");function js(){return M(this)}function Vs(e){e=m(e);return this.isValid()?this[e+"s"]():NaN}function Ks(e){return function(){return this.isValid()?this._data[e]:NaN}}var Gs=Ks("milliseconds"),Hs=Ks("seconds"),$s=Ks("minutes"),zs=Ks("hours"),qs=Ks("days"),Zs=Ks("months"),Xs=Ks("years");function Js(){return g(this.days()/7)}var Qs=Math.round,eo={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function to(e,t,n,i,r){return r.relativeTime(t||1,!!n,e,i)}function no(e,t,n,i){var r=M(e).abs(),s=Qs(r.as("s")),o=Qs(r.as("m")),a=Qs(r.as("h")),l=Qs(r.as("d")),u=Qs(r.as("M")),c=Qs(r.as("w")),h=Qs(r.as("y")),f=s<=n.ss&&["s",s]||s<n.s&&["ss",s]||o<=1&&["m"]||o<n.m&&["mm",o]||a<=1&&["h"]||a<n.h&&["hh",a]||l<=1&&["d"]||l<n.d&&["dd",l];if(n.w!=null)f=f||c<=1&&["w"]||c<n.w&&["ww",c];f=f||u<=1&&["M"]||u<n.M&&["MM",u]||h<=1&&["y"]||["yy",h];f[2]=t;f[3]=+e>0;f[4]=i;return to.apply(null,f)}function io(e){if(e===undefined)return Qs;if(typeof e==="function"){Qs=e;return true}return false}function ro(e,t){if(eo[e]===undefined)return false;if(t===undefined)return eo[e];eo[e]=t;if(e==="s")eo.ss=t-1;return true}function so(e,t){if(!this.isValid())return this.localeData().invalidDate();var n=false,i=eo,r,s;if(typeof e==="object"){t=e;e=false}if(typeof e==="boolean")n=e;if(typeof t==="object"){i=Object.assign({},eo,t);if(t.s!=null&&t.ss==null)i.ss=t.s-1}r=this.localeData();s=no(this,!n,i,r);if(n)s=r.pastFuture(+this,s);return r.postformat(s)}var oo=Math.abs;function ao(e){return(e>0)-(e<0)||+e}function lo(){if(!this.isValid())return this.localeData().invalidDate();var e=oo(this._milliseconds)/1e3,t=oo(this._days),n=oo(this._months),i,r,s,o,a=this.asSeconds(),l,u,c,h;if(!a)return"P0D";i=g(e/60);r=g(i/60);e%=60;i%=60;s=g(n/12);n%=12;o=e?e.toFixed(3).replace(/\.?0+$/,""):"";l=a<0?"-":"";u=ao(this._months)!==ao(a)?"-":"";c=ao(this._days)!==ao(a)?"-":"";h=ao(this._milliseconds)!==ao(a)?"-":"";return l+"P"+(s?u+s+"Y":"")+(n?u+n+"M":"")+(t?c+t+"D":"")+(r||i||e?"T":"")+(r?h+r+"H":"")+(i?h+i+"M":"")+(e?h+o+"S":"")}var P=ui.prototype;return P.isValid=ai,P.abs=bs,P.add=xs,P.subtract=Ts,P.as=Ns,P.asMilliseconds=Ds,P.asSeconds=Rs,P.asMinutes=Ps,P.asHours=Ys,P.asDays=Is,P.asWeeks=Fs,P.asMonths=Ws,P.asQuarters=Bs,P.asYears=Us,P.valueOf=As,P._bubble=Es,P.clone=js,P.get=Vs,P.milliseconds=Gs,P.seconds=Hs,P.minutes=$s,P.hours=zs,P.days=qs,P.weeks=Js,P.months=Zs,P.years=Xs,P.humanize=so,P.toISOString=lo,P.toString=lo,P.toJSON=lo,P.locale=lr,P.localeData=cr,P.toIsoString=e("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",lo),P.lang=ur,i("X",0,0,"unix"),i("x",0,0,"valueOf"),v("x",Ke),v("X",$e),k("X",function(e,t,n){n._d=new Date(parseFloat(e)*1e3)}),k("x",function(e,t,n){n._d=new Date(y(e))}),h.version="2.29.4",F(A),h.fn=D,h.min=ni,h.max=ii,h.now=ri,h.utc=c,h.unix=cs,h.months=gs,h.isDate=U,h.locale=vn,h.invalid=H,h.duration=M,h.isMoment=d,h.weekdays=_s,h.parseZone=hs,h.localeData=bn,h.isDuration=ci,h.monthsShort=ys,h.weekdaysMin=ws,h.defineLocale=wn,h.updateLocale=kn,h.locales=Sn,h.weekdaysShort=vs,h.normalizeUnits=m,h.relativeTimeRounding=io,h.relativeTimeThreshold=ro,h.calendarFormat=Vi,h.prototype=D,h.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},h}()});class WuCaiUtils{static getBlocks(e){var e=(e||"").matchAll(this.fetchBlocksRegExp),t={highlights:"",pagenote:"",mdcontent:""};if(e)for(const n of e)switch((n[1]||"").toLowerCase()){case"pagenote":t.pagenote.length<=0&&(t.pagenote=n[0]||"");break;case"highlights":t.highlights.length<=0&&(t.highlights=n[0]||"");break;case"mdcontent":t.mdcontent.length<=0&&(t.mdcontent=n[0]||"")}return t}static getDiffDay(e,t){return!(t<=0||e<=0)&&this.formatDateTime(new Date(1e3*e),"YYYY-MM-DD")!==this.formatDateTime(new Date(1e3*t),"YYYY-MM-DD")?t:0}static formatPageTitle(e){return e.length<=0?e:e.replace(/(:\s+)/g,":")}static replaceHolders(o,e){return o=o||"",Object.keys(e||{}).forEach(t=>{var n=this.holdersRegExpMap[t];if(n){var i=(e[t]||"").replace(/(^[\r\n]+|[\r\n]+$)/g,"");if(i&&!(i.length<=0)){n=o.matchAll(n);if(!n)return o+=this.wrapBlock(i,t);let e=0;for(const s of n){var r=s[1].length,r=o.substring(s.index+r);o=o.substring(0,s.index)+this.wrapBlockNoBreak(i,t)+r,e++;break}e<=0&&(o+=this.wrapBlock(i,t))}}}),o}static replaceBlocks(s,o){return s=s||"",Object.keys(o||{}).forEach(e=>{var t=this.blocksRegExpMap[e];if(t){var n=(o[e]||"").replace(/(^[\r\n]+|[\r\n]+$)/g,"");if(n&&!(n.length<=0)){e=s.matchAll(t);if(e)for(const r of e){var i=r[0]||"";s=s.replace(i,n);break}}}}),s}static formatDateTime(e,t="YYYY-MM-DD HH:mm"){return e?moment(e).format(t):""}static trimString(e){return!e||e.length<=0?"":e.replace(/^\s+|\s+$/g,"")}static truncateFileName255(e,t,n){var i=e.lastIndexOf("/");return e.length-(i+1)+t<=(n=n<=64||255<=n?64:n)?e:e.substring(0,i+1+(n-t))}static getPrefxFromAnnoPrefix(e){var t;return e&&!(e.length<=0)&&0<(t=e.indexOf(" "))?e.substring(0,t+1):""}static trimWithLine(e){if(!e||e.length<=0)return"";var t=e.split("\n"),n=[];if(1<t.length){for(let e=0;e<t.length;e++){var i=t[e].replace(/[\s\t]+/," ").replace(/[\r\n]+/g,"").trim();0<i.length&&n.push(i)}e=n.join("\n")}else e=e.trim();return e}static normalTitle(e){return(e=(e=(e=e||"").replace(/[\s\t\n]+/g," ")).replace(/[\~\\、\/\*"'<>%\$#&;；:?？。，！!\|]/g,"")).length<=0?"No title":e}static isWhiteSpaceForTagParser(e){return 65292==e||12290==e||65307==e||65311==e||10==e||13==e||32<=e&&e<=34||36<=e&&e<=44||46==e||58<=e&&e<=63||59==e||64==e||91<=e&&e<=94||123<=e&&e<=126||65292==e}static convertHashTagToBackLink(t){if((t=t||"").length<=0)return t;if(t.indexOf("#")<0)return t;var n=t.length;let i=-1;var r=n-1,s=[];for(let e=0;e<n;e++){var o=t.charCodeAt(e),a=e==r,l=this.isWhiteSpaceForTagParser(o),u=e-i;35===o?(-1<i&&1<u&&s.push([i,e]),i=e):-1<i&&(l||a)&&1<=u&&(a&&!l&&1<=u?s.push([i,e+1]):1<u&&s.push([i,e]),i=-1)}if(s.length<=0)return t;var e=[];let c=0;for(const d of s){var h=d[0],f=d[1];0<h-c&&e.push(t.substring(c,h)),e.push("[["+t.substring(h+1,f)+"]]"),c=f}return 0<c&&c<t.length&&e.push(t.substring(c,t.length)),e.join("")}static formatTime(e,t="YYYY-MM-DD HH:mm"){return e<=0?"":(e=new Date(1e3*e),this.formatDateTime(e,t))}static isOnlyDateTimeLine(e){return/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(e)&&!0}static repeatStr(t,n){if(n<=0||!t||t.length<=0)return"";var i=[];for(let e=0;e<n;e++)i.push(t);return i.join("")}static formatPageNote(e,t){return t?e||"":this.convertHashTagToBackLink(e)||""}static formatHighlights(e,t,n){if(!t)return[];var i,r,s=1===n.tagStyle,o=[];for(i of t)i&&(r=i.highlighttype||1,r={note:i.note||i.imageUrl||"",imageurl:i.imageUrl,updateat_ts:i.updateat,createat_ts:i.createat,type:this.highlightTypeMaps[r]||"highlight",annotation:i.annonation||"",color:i.color,slotid:i.slotid,refid:i.refid,refurl:WuCaiUtils.getHighlightRefUrl(e,i.refurl||"")},s||(r.annotation&&(r.annotation=this.convertHashTagToBackLink(r.annotation)),r.note&&(r.note=this.convertHashTagToBackLink(r.note))),o.push(r));return o}static toYAMLList(e){return!e||e.length<=0?"":"\n  - "+e.join("\n  - ")}static mergeTags(e,t,n){e=(e=e||[]).concat((t=t||"").split(",")).map(e=>WuCaiUtils.formatTag(e,n));return this.removeDupAndSort(e).join(" ")}static trimTags(e){return e?(e=e||"").split(" ").filter(e=>e).map(e=>e.replace(/[#\[\]]/g,"").replace(/\s+/g,"-")).filter(e=>e):[]}static formatPageMirror(e){return(e=e||"")?e.replace(/g1proxy\.nostrabc\.com/g,"g1proxy.wimg.site"):""}static removeDupAndSort(e){if(!e||e.length<=1)return e;var t,n={};for(t of e)t&&void 0===n[t]&&(n[t]=1);return Object.keys(n).sort()}static formatTag(t,n){if(t=t.trim()){if(!(t=t.replace(/\s+/g,"-")))return t;var i="#"===t[0],r="["===t[0];if(!i&&!r)return n?"#"+t:`[[${t}]]`;if(r)return t;if(i&&n)return t;let e="";return(e=i?t.substring(1).trim():e)?`[[${e}]]`:""}}static formatTags(e,t){return(e=e||[]).map(e=>WuCaiUtils.formatTag(e,t)).filter(e=>e).join(" ")}static wrapBlock(e,t,n=0){return`
%%begin ${t}%%
${e}
%%end ${t}%%
`}static wrapBlockNoBreak(e,t){return`%%begin ${t}%%
${e}
%%end ${t}%%`}static renderTemplate(e,t){return t.pageEngine.render(e)}static renderTemplateWithEditable(e,t,n){var i,r={};return n.blocks.pagenote&&(i=n.pagenoteEngine.render(e))&&(r.pagenote=i),n.blocks.highlights&&(i=n.highlightsEngine.render(e))&&(r.highlights=i),n.blocks.mdcontent&&(i=n.mdcontentEngine.render(e))&&(r.mdcontent=i),this.replaceHolders(t,r)}static getDirFromPath(e){var t;return!e||(t=e.lastIndexOf("/"))<=0?"":e.substring(0,t)}static getDomainByUrl(e){if(!e)return"";/^www\./.test(e)&&(e="https://"+e);try{var t=new URL(e);return t?t.hostname.toLocaleLowerCase():""}catch(e){return""}}static getDomain2ByDomain(e){var t,n;return!e||e.length<=0?"":(n=(t=e.split(".")).length)<=2?e:t[n-2]+"."+t[n-1]}static detectIsMardownFormat(e){return!(!e||e.length<=0||!(/^- \[[ x]\] +/.test(e)&&e.indexOf("\n")<0)&&(!/^\`\`\`/.test(e)||!/\`\`\`\s*$/.test(e)))}static getNoteIdxFromFilePath(e){var t;return!e||e.length<=0||!/-([a-z0-9_]+)\.md$/i.test(e)||(t=e.lastIndexOf("-"))<0?"":e.substring(t+1,e.length-3)}static getHighlightRefUrl(e,t){if(!t)return e;let n="";var i;return(n=0<=t.indexOf("#")?t.split("-")[1]:n)?(t=e.indexOf("#"))<0?e+("#WCREFX-"+n):(i=e.substring(t+1))?0<e.indexOf("WCREFX-")?e.replace(/WCREFX-([a-z\d]+)/g,"WCREFX-"+n):0<=i.indexOf("/")||0<=i.indexOf("?")?0<=i.indexOf("?")||0<=i.indexOf("=")?(i=encodeURIComponent("WCREFX-"+n),(e=e.replace(/&+$/,""))+"&wucairefx="+i):e:e.substring(0,t)+("#WCREFX-"+n):(e=e.substring(0,t))+("#WCREFX-"+n):e}static getPageMirrorMarkdown(e){return __awaiter(this,void 0,void 0,function*(){let t=yield fetch(e,{method:"GET"});return t&&200===t.status&&t.ok?new Promise((i,e)=>{try{t.text().then(e=>{if(!e||e.length<=0)return"";var t,n=e.indexOf(":");n<=0?i(""):(t=parseInt(e.substring(0,n)),i(e.substring(t+n+1)))}).catch(e=>{i("")})}catch(e){i("")}}):new Promise((e,t)=>{e("")})})}}WuCaiUtils.allowedBlock=["highlights","pagenote"],WuCaiUtils.fetchBlocksRegExp=new RegExp("\\{%\\s*block\\s+([a-z0-9-_]+)\\s*%\\}[\\s\\S]*?\\{%\\s*endblock\\s*%\\}","ig"),WuCaiUtils.blocksRegExpMap={highlights:new RegExp("\\{%\\s*block\\s+highlights\\s*%\\}[\\s\\S]*?\\{%\\s*endblock\\s*%\\}","img"),pagenote:new RegExp("\\{%\\s*block\\s+pagenote\\s*%\\}[\\s\\S]*?\\{%\\s*endblock\\s*%\\}","img"),mdcontent:new RegExp("\\{%\\s*block\\s+mdcontent\\s*%\\}[\\s\\S]*?\\{%\\s*endblock\\s*%\\}","img")},WuCaiUtils.holdersRegExpMap={highlights:new RegExp("(%%\\s*begin\\s+highlights\\s*%%([\\s\\S]*?)%%\\s*end\\s+highlights\\s*%%)","ig"),pagenote:new RegExp("(%%\\s*begin\\s+pagenote\\s*%%([\\s\\S]*?)%%\\s*end\\s+pagenote\\s*%%)","ig"),mdcontent:new RegExp("(%%\\s*begin\\s+mdcontent\\s*%%([\\s\\S]*?)%%\\s*end\\s+mdcontent\\s*%%)","ig")},WuCaiUtils.highlightTypeMaps={1:"highlight",2:"image",3:"math",4:"quote"};var nunjucks=createCommonjsModule(function(e,t){var n;n=function(){return n=[function(e,i,t){var s=Array.prototype,n=Object.prototype,r={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","\\":"&#92;"},o=/[&"'<>\\]/g;function a(e,t){return n.hasOwnProperty.call(e,t)}function l(e){return r[e]}function u(e,t,n){var i,r,s,o,a;return e instanceof Error&&(e=(r=e).name+": "+r.message),Object.setPrototypeOf?(i=new Error(e),Object.setPrototypeOf(i,u.prototype)):(i=this,Object.defineProperty(i,"message",{enumerable:!1,writable:!0,value:e})),Object.defineProperty(i,"name",{value:"Template render error"}),Error.captureStackTrace&&Error.captureStackTrace(i,this.constructor),o=r?(s=Object.getOwnPropertyDescriptor(r,"stack"),(o=s&&(s.get||function(){return s.value}))||function(){return r.stack}):(a=new Error(e).stack,function(){return a}),Object.defineProperty(i,"stack",{get:function(){return o.call(i)}}),Object.defineProperty(i,"cause",{value:r}),i.lineno=t,i.colno=n,i.firstUpdate=!0,i.Update=function(e){e="("+(e||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?e+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(e+=" [Line "+this.lineno+"]")),e+="\n ",this.firstUpdate&&(e+=" "),this.message=e+(this.message||""),this.firstUpdate=!1,this},i}function c(e){return"[object Function]"===n.toString.call(e)}function h(e){return"[object Array]"===n.toString.call(e)}function f(e){return"[object String]"===n.toString.call(e)}function d(e){return"[object Object]"===n.toString.call(e)}function p(e){var r=(e=e)?"string"==typeof e?e.split("."):[e]:[];return function(e){for(var t=e,n=0;n<r.length;n++){var i=r[n];if(!a(t,i))return;t=t[i]}return t}}function m(e){return Array.prototype.slice.call(e)}function g(e,t,n){return Array.prototype.indexOf.call(e||[],t,n)}function y(e){var t,n=[];for(t in e)a(e,t)&&n.push(t);return n}(i=e.exports={}).hasOwnProp=a,i._prettifyError=function(e,t,n){return(n=n.Update?n:new i.TemplateError(n)).Update(e),t||(e=n,(n=new Error(e.message)).name=e.name),n},Object.setPrototypeOf?Object.setPrototypeOf(u.prototype,Error.prototype):u.prototype=Object.create(Error.prototype,{constructor:{value:u}}),i.TemplateError=u,i.escape=function(e){return e.replace(o,l)},i.isFunction=c,i.isArray=h,i.isString=f,i.isObject=d,i.getAttrGetter=p,i.groupBy=function(e,t,n){for(var i={},r=c(t)?t:p(t),s=0;s<e.length;s++){var o=e[s],a=r(o,s);if(void 0===a&&!0===n)throw new TypeError('groupby: attribute "'+t+'" resolved to undefined');(i[a]||(i[a]=[])).push(o)}return i},i.toArray=m,i.without=function(e){var t=[];if(e)for(var n=e.length,i=m(arguments).slice(1),r=-1;++r<n;)-1===g(i,e[r])&&t.push(e[r]);return t},i.repeat=function(e,t){for(var n="",i=0;i<t;i++)n+=e;return n},i.each=function(e,t,n){if(null!=e)if(s.forEach&&e.forEach===s.forEach)e.forEach(t,n);else if(e.length===+e.length)for(var i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},i.map=function(e,t){var n=[];if(null!=e){if(s.map&&e.map===s.map)return e.map(t);for(var i=0;i<e.length;i++)n[n.length]=t(e[i],i);e.length===+e.length&&(n.length=e.length)}return n},i.asyncIter=function(t,n,i){var r=-1;!function e(){++r<t.length?n(t[r],r,e,i):i()}()},i.asyncFor=function(n,i,r){var s=y(n||{}),o=s.length,a=-1;!function e(){var t=s[++a];a<o?i(t,n[t],a,o,e):r()}()},i.indexOf=g,i.keys=y,i._entries=function(t){return y(t).map(function(e){return[e,t[e]]})},i._values=function(t){return y(t).map(function(e){return t[e]})},i._assign=i.extend=function(t,n){return t=t||{},y(n).forEach(function(e){t[e]=n[e]}),t},i.inOperator=function(e,t){if(h(t)||f(t))return-1!==t.indexOf(e);if(d(t))return e in t;throw new Error('Cannot use "in" operator to search for "'+e+'" in unexpected types.')}},function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(i.key),i)}}function s(e,t,n){t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function o(e,t){e.prototype=Object.create(t.prototype),r(e.prototype.constructor=e,t)}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var a=n(16),l=n(0);function u(t,n,r){r=r||{},l.keys(r).forEach(function(e){var n,i;r[e]=(n=t.prototype[e],i=r[e],"function"!=typeof n||"function"!=typeof i?i:function(){var e=this.parent,t=(this.parent=n,i.apply(this,arguments));return this.parent=e,t})});var e=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),s(t,[{key:"typename",get:function(){return n}}]),t}(t);return l._assign(e.prototype,r),e}n=function(){function e(){this.init.apply(this,arguments)}return e.prototype.init=function(){},e.extend=function(e,t){return"object"==typeof e&&(t=e,e="anonymous"),u(this,e,t)},s(e,[{key:"typename",get:function(){return this.constructor.name}}]),e}(),a=function(t){function e(){var e=t.call(this)||this;return e.init.apply(e,arguments),e}return o(e,t),e.prototype.init=function(){},e.extend=function(e,t){return"object"==typeof e&&(t=e,e="anonymous"),u(this,e,t)},s(e,[{key:"typename",get:function(){return this.constructor.name}}]),e}(a);e.exports={Obj:n,EmitterObj:a}},function(e,t,n){var d=n(0),i=Array.from,r="function"==typeof Symbol&&Symbol.iterator&&"function"==typeof i,n=function(){function t(e,t){this.variables=Object.create(null),this.parent=e,this.topLevel=!1,this.isolateWrites=t}var e=t.prototype;return e.set=function(e,t,n){var i=e.split("."),r=this.variables,s=this;if(n&&(s=this.resolve(i[0],!0)))s.set(e,t);else{for(var o=0;o<i.length-1;o++){var a=i[o];r[a]||(r[a]={}),r=r[a]}r[i[i.length-1]]=t}},e.get=function(e){e=this.variables[e];return void 0!==e?e:null},e.lookup=function(e){var t=this.parent,n=this.variables[e];return void 0!==n?n:t&&t.lookup(e)},e.resolve=function(e,t){t=t&&this.isolateWrites?void 0:this.parent;return void 0!==this.variables[e]?this:t&&t.resolve(e)},e.push=function(e){return new t(this,e)},e.pop=function(){return this.parent},t}();function h(e){return e&&Object.prototype.hasOwnProperty.call(e,"__keywords")}function f(e){var t=e.length;return 0===t?0:h(e[t-1])?t-1:t}function s(e){if("string"!=typeof e)return e;this.val=e,this.length=e.length}(s.prototype=Object.create(String.prototype,{length:{writable:!0,configurable:!0,value:0}})).valueOf=function(){return this.val},s.prototype.toString=function(){return this.val},e.exports={Frame:n,makeMacro:function(l,u,c){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=f(t),r=function(e){var t=e.length;if(t){e=e[t-1];if(h(e))return e}return{}}(t);if(i>l.length)s=t.slice(0,l.length),t.slice(s.length,i).forEach(function(e,t){t<u.length&&(r[u[t]]=e)}),s.push(r);else if(i<l.length){for(var s=t.slice(0,i),o=i;o<l.length;o++){var a=l[o];s.push(r[a]),delete r[a]}s.push(r)}else s=t;return c.apply(this,s)}},makeKeywordArgs:function(e){return e.__keywords=!0,e},numArgs:f,suppressValue:function(e,t){return e=null!=e?e:"",e=!t||e instanceof s?e:d.escape(e.toString())},ensureDefined:function(e,t,n){if(null==e)throw new d.TemplateError("attempted to output null or undefined value",t+1,n+1);return e},memberLookup:function(i,r){if(null!=i)return"function"==typeof i[r]?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i[r].apply(i,t)}:i[r]},contextOrFrameLookup:function(e,t,n){return void 0!==(t=t.lookup(n))?t:e.lookup(n)},callWrap:function(e,t,n,i){if(!e)throw new Error("Unable to call `"+t+"`, which is undefined or falsey");if("function"!=typeof e)throw new Error("Unable to call `"+t+"`, which is not a function");return e.apply(n,i)},handleError:function(e,t,n){return e.lineno?e:new d.TemplateError(e,t,n)},isArray:d.isArray,keys:d.keys,SafeString:s,copySafeness:function(e,t){return e instanceof s?new s(t):t.toString()},markSafe:function(n){var e=typeof n;return"string"==e?new s(n):"function"!=e?n:function(e){var t=n.apply(this,arguments);return"string"==typeof t?new s(t):t}},asyncEach:function(e,i,s,t){var r;d.isArray(e)?(r=e.length,d.asyncIter(e,function(e,t,n){switch(i){case 1:s(e,t,r,n);break;case 2:s(e[0],e[1],t,r,n);break;case 3:s(e[0],e[1],e[2],t,r,n);break;default:e.push(t,r,n),s.apply(this,e)}},t)):d.asyncFor(e,function(e,t,n,i,r){s(e,t,n,i,r)},t)},asyncAll:function(e,t,n,i){var r=0;function s(e,t){r++,c[e]=t,r===u&&i(null,c.join(""))}if(d.isArray(e))if(u=e.length,c=new Array(u),0===u)i(null,"");else for(var o=0;o<e.length;o++){var a=e[o];switch(t){case 1:n(a,o,u,s);break;case 2:n(a[0],a[1],o,u,s);break;case 3:n(a[0],a[1],a[2],o,u,s);break;default:a.push(o,u,s),n.apply(this,a)}}else{var l=d.keys(e||{}),u=l.length,c=new Array(u);if(0===u)i(null,"");else for(var h=0;h<l.length;h++){var f=l[h];n(f,e[f],h,u,s)}}},inOperator:d.inOperator,fromIterator:function(e){return"object"==typeof e&&null!==e&&!d.isArray(e)&&r&&Symbol.iterator in e?i(e):e}}},function(e,Y,t){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(i.key),i)}}function n(e,t,n){t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function r(e,t){e.prototype=Object.create(t.prototype),s(e.prototype.constructor=e,t)}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t,n){e instanceof t&&n.push(e),e instanceof a&&e.findAll(t,n)}var a=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var n=t.prototype;return n.init=function(e,t){for(var n=arguments,i=this,r=arguments.length,s=new Array(2<r?r-2:0),o=2;o<r;o++)s[o-2]=arguments[o];this.lineno=e,this.colno=t,this.fields.forEach(function(e,t){t=n[t+2];i[e]=t=void 0===t?null:t})},n.findAll=function(t,n){var i=this;return n=n||[],this instanceof l?this.children.forEach(function(e){return o(e,t,n)}):this.fields.forEach(function(e){return o(i[e],t,n)}),n},n.iterFields=function(t){var n=this;this.fields.forEach(function(e){t(n[e],e)})},t}(t(1).Obj),t=function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),n(t,[{key:"typename",get:function(){return"Value"}},{key:"fields",get:function(){return["value"]}}]),t}(a),l=function(i){function e(){return i.apply(this,arguments)||this}r(e,i);var t=e.prototype;return t.init=function(e,t,n){i.prototype.init.call(this,e,t,n||[])},t.addChild=function(e){this.children.push(e)},n(e,[{key:"typename",get:function(){return"NodeList"}},{key:"fields",get:function(){return["children"]}}]),e}(a),u=l.extend("Root"),c=t.extend("Literal"),h=t.extend("Symbol"),f=l.extend("Group"),d=l.extend("Array"),p=a.extend("Pair",{fields:["key","value"]}),m=l.extend("Dict"),g=a.extend("LookupVal",{fields:["target","val"]}),y=a.extend("If",{fields:["cond","body","else_"]}),_=y.extend("IfAsync"),v=a.extend("InlineIf",{fields:["cond","body","else_"]}),w=a.extend("For",{fields:["arr","name","body","else_"]}),k=w.extend("AsyncEach"),b=w.extend("AsyncAll"),S=a.extend("Macro",{fields:["name","args","body"]}),x=S.extend("Caller"),T=a.extend("Import",{fields:["template","target","withContext"]}),O=function(s){function e(){return s.apply(this,arguments)||this}return r(e,s),e.prototype.init=function(e,t,n,i,r){s.prototype.init.call(this,e,t,n,i||new l,r)},n(e,[{key:"typename",get:function(){return"FromImport"}},{key:"fields",get:function(){return["template","names","withContext"]}}]),e}(a),E=a.extend("FunCall",{fields:["name","args"]}),C=E.extend("Filter"),L=C.extend("FilterAsync",{fields:["name","args","symbol"]}),N=m.extend("KeywordArgs"),A=a.extend("Block",{fields:["name","body"]}),I=a.extend("Super",{fields:["blockName","symbol"]}),F=a.extend("TemplateRef",{fields:["template"]}).extend("Extends"),W=a.extend("Include",{fields:["template","ignoreMissing"]}),B=a.extend("Set",{fields:["targets","value"]}),U=a.extend("Switch",{fields:["expr","cases","default"]}),j=a.extend("Case",{fields:["cond","body"]}),V=l.extend("Output"),K=a.extend("Capture",{fields:["body"]}),G=c.extend("TemplateData"),M=a.extend("UnaryOp",{fields:["target"]}),D=a.extend("BinOp",{fields:["left","right"]}),H=D.extend("In"),$=D.extend("Is"),z=D.extend("Or"),q=D.extend("And"),Z=M.extend("Not"),X=D.extend("Add"),J=D.extend("Concat"),Q=D.extend("Sub"),ee=D.extend("Mul"),te=D.extend("Div"),ne=D.extend("FloorDiv"),ie=D.extend("Mod"),re=D.extend("Pow"),se=M.extend("Neg"),M=M.extend("Pos"),oe=a.extend("Compare",{fields:["expr","ops"]}),ae=a.extend("CompareOperand",{fields:["expr","type"]}),R=a.extend("CallExtension",{init:function(e,t,n,i){this.parent(),this.extName=e.__name||e,this.prop=t,this.args=n||new l,this.contentArgs=i||[],this.autoescape=e.autoescape},fields:["extName","prop","args","contentArgs"]}),le=R.extend("CallExtensionAsync");function P(e,n,i){var r=e.split("\n");r.forEach(function(e,t){e&&(i&&0<t||!i)&&process.stdout.write(" ".repeat(n));t=t===r.length-1?"":"\n";process.stdout.write(e+t)})}e.exports={Node:a,Root:u,NodeList:l,Value:t,Literal:c,Symbol:h,Group:f,Array:d,Pair:p,Dict:m,Output:V,Capture:K,TemplateData:G,If:y,IfAsync:_,InlineIf:v,For:w,AsyncEach:k,AsyncAll:b,Macro:S,Caller:x,Import:T,FromImport:O,FunCall:E,Filter:C,FilterAsync:L,KeywordArgs:N,Block:A,Super:I,Extends:F,Include:W,Set:B,Switch:U,Case:j,LookupVal:g,BinOp:D,In:H,Is:$,Or:z,And:q,Not:Z,Add:X,Concat:J,Sub:Q,Mul:ee,Div:te,FloorDiv:ne,Mod:ie,Pow:re,Neg:se,Pos:M,Compare:oe,CompareOperand:ae,CallExtension:R,CallExtensionAsync:le,printNodes:function n(e,i){var r,s;i=i||0,P(e.typename+": ",i),e instanceof l?(P("\n"),e.children.forEach(function(e){n(e,i+2)})):e instanceof R?(P(e.extName+"."+e.prop+"\n"),e.args&&n(e.args,i+2),e.contentArgs&&e.contentArgs.forEach(function(e){n(e,i+2)})):(r=[],s=null,e.iterFields(function(e,t){e instanceof a?r.push([t,e]):(s=s||{})[t]=e}),s?P(JSON.stringify(s,null,2)+"\n",null,!0):P("\n"),r.forEach(function(e){var t=e[0],e=e[1];P("["+t+"] =>",i+2),n(e,i+4)}))}}},function(e,t){},function(e,t,n){function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var o=n(8),a=n(17),h=n(3),s=n(0).TemplateError,f=n(2).Frame,n=n(1).Obj,l={"==":"==","===":"===","!=":"!=","!==":"!==","<":"<",">":">","<=":"<=",">=":">="},u=function(e){var t;function n(){return e.apply(this,arguments)||this}t=e,(i=n).prototype=Object.create(t.prototype),r(i.prototype.constructor=i,t);var i=n.prototype;return i.init=function(e,t){this.templateName=e,this.codebuf=[],this.lastId=0,this.buffer=null,this.bufferStack=[],this._scopeClosers="",this.inBlock=!1,this.throwOnUndefined=t},i.fail=function(e,t,n){throw void 0!==t&&(t+=1),void 0!==n&&(n+=1),new s(e,t,n)},i._pushBuffer=function(){var e=this._tmpid();return this.bufferStack.push(this.buffer),this.buffer=e,this._emit("var "+this.buffer+' = "";'),e},i._popBuffer=function(){this.buffer=this.bufferStack.pop()},i._emit=function(e){this.codebuf.push(e)},i._emitLine=function(e){this._emit(e+"\n")},i._emitLines=function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(function(e){return t._emitLine(e)})},i._emitFuncBegin=function(e,t){this.buffer="output",this._scopeClosers="",this._emitLine("function "+t+"(env, context, frame, runtime, cb) {"),this._emitLine("var lineno = "+e.lineno+";"),this._emitLine("var colno = "+e.colno+";"),this._emitLine("var "+this.buffer+' = "";'),this._emitLine("try {")},i._emitFuncEnd=function(e){e||this._emitLine("cb(null, "+this.buffer+");"),this._closeScopeLevels(),this._emitLine("} catch (e) {"),this._emitLine("  cb(runtime.handleError(e, lineno, colno));"),this._emitLine("}"),this._emitLine("}"),this.buffer=null},i._addScopeLevel=function(){this._scopeClosers+="})"},i._closeScopeLevels=function(){this._emitLine(this._scopeClosers+";"),this._scopeClosers=""},i._withScopedSyntax=function(e){var t=this._scopeClosers;this._scopeClosers="",e.call(this),this._closeScopeLevels(),this._scopeClosers=t},i._makeCallback=function(e){var t=this._tmpid();return"function("+t+(e?","+e:"")+") {\nif("+t+") { cb("+t+"); return; }"},i._tmpid=function(){return this.lastId++,"t_"+this.lastId},i._templateName=function(){return null==this.templateName?"undefined":JSON.stringify(this.templateName)},i._compileChildren=function(e,t){var n=this;e.children.forEach(function(e){n.compile(e,t)})},i._compileAggregate=function(e,n,t,i){var r=this;t&&this._emit(t),e.children.forEach(function(e,t){0<t&&r._emit(","),r.compile(e,n)}),i&&this._emit(i)},i._compileExpression=function(e,t){this.assertType(e,h.Literal,h.Symbol,h.Group,h.Array,h.Dict,h.FunCall,h.Caller,h.Filter,h.LookupVal,h.Compare,h.InlineIf,h.In,h.Is,h.And,h.Or,h.Not,h.Add,h.Concat,h.Sub,h.Mul,h.Div,h.FloorDiv,h.Mod,h.Pow,h.Neg,h.Pos,h.Compare,h.NodeList),this.compile(e,t)},i.assertType=function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];n.some(function(e){return t instanceof e})||this.fail("assertType: invalid type: "+t.typename,t.lineno,t.colno)},i.compileCallExtension=function(e,i,t){var r=this,n=e.args,s=e.contentArgs,o="boolean"!=typeof e.autoescape||e.autoescape;t||this._emit(this.buffer+" += runtime.suppressValue("),this._emit('env.getExtension("'+e.extName+'")["'+e.prop+'"]('),this._emit("context"),(n||s)&&this._emit(","),n&&(n instanceof h.NodeList||this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),n.children.forEach(function(e,t){r._compileExpression(e,i),t===n.children.length-1&&!s.length||r._emit(",")})),s.length&&s.forEach(function(e,t){var n;0<t&&r._emit(","),e?(r._emitLine("function(cb) {"),r._emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}"),n=r._pushBuffer(),r._withScopedSyntax(function(){r.compile(e,i),r._emitLine("cb(null, "+n+");")}),r._popBuffer(),r._emitLine("return "+n+";"),r._emitLine("}")):r._emit("null")}),t?(e=this._tmpid(),this._emitLine(", "+this._makeCallback(e)),this._emitLine(this.buffer+" += runtime.suppressValue("+e+", "+o+" && env.opts.autoescape);"),this._addScopeLevel()):(this._emit(")"),this._emit(", "+o+" && env.opts.autoescape);\n"))},i.compileCallExtensionAsync=function(e,t){this.compileCallExtension(e,t,!0)},i.compileNodeList=function(e,t){this._compileChildren(e,t)},i.compileLiteral=function(e){var t;"string"==typeof e.value?(t=(t=(t=(t=(t=(t=e.value.replace(/\\/g,"\\\\")).replace(/"/g,'\\"')).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\t/g,"\\t")).replace(/\u2028/g,"\\u2028"),this._emit('"'+t+'"')):null===e.value?this._emit("null"):this._emit(e.value.toString())},i.compileSymbol=function(e,t){e=e.value,t=t.lookup(e);t?this._emit(t):this._emit('runtime.contextOrFrameLookup(context, frame, "'+e+'")')},i.compileGroup=function(e,t){this._compileAggregate(e,t,"(",")")},i.compileArray=function(e,t){this._compileAggregate(e,t,"[","]")},i.compileDict=function(e,t){this._compileAggregate(e,t,"{","}")},i.compilePair=function(e,t){var n=e.key,e=e.value;n instanceof h.Symbol?n=new h.Literal(n.lineno,n.colno,n.value):n instanceof h.Literal&&"string"==typeof n.value||this.fail("compilePair: Dict keys must be strings or names",n.lineno,n.colno),this.compile(n,t),this._emit(": "),this._compileExpression(e,t)},i.compileInlineIf=function(e,t){this._emit("("),this.compile(e.cond,t),this._emit("?"),this.compile(e.body,t),this._emit(":"),null!==e.else_?this.compile(e.else_,t):this._emit('""'),this._emit(")")},i.compileIn=function(e,t){this._emit("runtime.inOperator("),this.compile(e.left,t),this._emit(","),this.compile(e.right,t),this._emit(")")},i.compileIs=function(e,t){var n=(e.right.name||e.right).value;this._emit('env.getTest("'+n+'").call(context, '),this.compile(e.left,t),e.right.args&&(this._emit(","),this.compile(e.right.args,t)),this._emit(") === true")},i._binOpEmitter=function(e,t,n){this.compile(e.left,t),this._emit(n),this.compile(e.right,t)},i.compileOr=function(e,t){return this._binOpEmitter(e,t," || ")},i.compileAnd=function(e,t){return this._binOpEmitter(e,t," && ")},i.compileAdd=function(e,t){return this._binOpEmitter(e,t," + ")},i.compileConcat=function(e,t){return this._binOpEmitter(e,t,' + "" + ')},i.compileSub=function(e,t){return this._binOpEmitter(e,t," - ")},i.compileMul=function(e,t){return this._binOpEmitter(e,t," * ")},i.compileDiv=function(e,t){return this._binOpEmitter(e,t," / ")},i.compileMod=function(e,t){return this._binOpEmitter(e,t," % ")},i.compileNot=function(e,t){this._emit("!"),this.compile(e.target,t)},i.compileFloorDiv=function(e,t){this._emit("Math.floor("),this.compile(e.left,t),this._emit(" / "),this.compile(e.right,t),this._emit(")")},i.compilePow=function(e,t){this._emit("Math.pow("),this.compile(e.left,t),this._emit(", "),this.compile(e.right,t),this._emit(")")},i.compileNeg=function(e,t){this._emit("-"),this.compile(e.target,t)},i.compilePos=function(e,t){this._emit("+"),this.compile(e.target,t)},i.compileCompare=function(e,t){var n=this;this.compile(e.expr,t),e.ops.forEach(function(e){n._emit(" "+l[e.type]+" "),n.compile(e.expr,t)})},i.compileLookupVal=function(e,t){this._emit("runtime.memberLookup(("),this._compileExpression(e.target,t),this._emit("),"),this._compileExpression(e.val,t),this._emit(")")},i._getNodeName=function(e){switch(e.typename){case"Symbol":return e.value;case"FunCall":return"the return value of ("+this._getNodeName(e.name)+")";case"LookupVal":return this._getNodeName(e.target)+'["'+this._getNodeName(e.val)+'"]';case"Literal":return e.value.toString();default:return"--expression--"}},i.compileFunCall=function(e,t){this._emit("(lineno = "+e.lineno+", colno = "+e.colno+", "),this._emit("runtime.callWrap("),this._compileExpression(e.name,t),this._emit(', "'+this._getNodeName(e.name).replace(/"/g,'\\"')+'", context, '),this._compileAggregate(e.args,t,"[","])"),this._emit(")")},i.compileFilter=function(e,t){var n=e.name;this.assertType(n,h.Symbol),this._emit('env.getFilter("'+n.value+'").call(context, '),this._compileAggregate(e.args,t),this._emit(")")},i.compileFilterAsync=function(e,t){var n=e.name,i=e.symbol.value;this.assertType(n,h.Symbol),t.set(i,i),this._emit('env.getFilter("'+n.value+'").call(context, '),this._compileAggregate(e.args,t),this._emitLine(", "+this._makeCallback(i)),this._addScopeLevel()},i.compileKeywordArgs=function(e,t){this._emit("runtime.makeKeywordArgs("),this.compileDict(e,t),this._emit(")")},i.compileSet=function(e,t){var n=this,i=[];e.targets.forEach(function(e){e=e.value,e=t.lookup(e);null==e&&(e=n._tmpid(),n._emitLine("var "+e+";")),i.push(e)}),e.value?(this._emit(i.join(" = ")+" = "),this._compileExpression(e.value,t)):(this._emit(i.join(" = ")+" = "),this.compile(e.body,t)),this._emitLine(";"),e.targets.forEach(function(e,t){t=i[t],e=e.value;n._emitLine('frame.set("'+e+'", '+t+", true);"),n._emitLine("if(frame.topLevel) {"),n._emitLine('context.setVariable("'+e+'", '+t+");"),n._emitLine("}"),"_"!==e.charAt(0)&&(n._emitLine("if(frame.topLevel) {"),n._emitLine('context.addExport("'+e+'", '+t+");"),n._emitLine("}"))})},i.compileSwitch=function(e,n){var i=this;this._emit("switch ("),this.compile(e.expr,n),this._emit(") {"),e.cases.forEach(function(e,t){i._emit("case "),i.compile(e.cond,n),i._emit(": "),i.compile(e.body,n),e.body.children.length&&i._emitLine("break;")}),e.default&&(this._emit("default:"),this.compile(e.default,n)),this._emit("}")},i.compileIf=function(e,t,n){var i=this;this._emit("if("),this._compileExpression(e.cond,t),this._emitLine(") {"),this._withScopedSyntax(function(){i.compile(e.body,t),n&&i._emit("cb()")}),e.else_?(this._emitLine("}\nelse {"),this._withScopedSyntax(function(){i.compile(e.else_,t),n&&i._emit("cb()")})):n&&(this._emitLine("}\nelse {"),this._emit("cb()")),this._emitLine("}")},i.compileIfAsync=function(e,t){this._emit("(function(cb) {"),this.compileIf(e,t,!0),this._emit("})("+this._makeCallback()),this._addScopeLevel()},i._emitLoopBindings=function(e,t,n,i){var r=this;[{name:"index",val:n+" + 1"},{name:"index0",val:n},{name:"revindex",val:i+" - "+n},{name:"revindex0",val:i+" - "+n+" - 1"},{name:"first",val:n+" === 0"},{name:"last",val:n+" === "+i+" - 1"},{name:"length",val:i}].forEach(function(e){r._emitLine('frame.set("loop.'+e.name+'", '+e.val+");")})},i.compileFor=function(i,r){var e,t,n,s,o=this,a=this._tmpid(),l=this._tmpid(),u=this._tmpid();r=r.push(),this._emitLine("frame = frame.push();"),this._emit("var "+u+" = "),this._compileExpression(i.arr,r),this._emitLine(";"),this._emit("if("+u+") {"),this._emitLine(u+" = runtime.fromIterator("+u+");"),i.name instanceof h.Array?(this._emitLine("var "+a+";"),this._emitLine("if(runtime.isArray("+u+")) {"),this._emitLine("var "+l+" = "+u+".length;"),this._emitLine("for("+a+"=0; "+a+" < "+u+".length; "+a+"++) {"),i.name.children.forEach(function(e,t){var n=o._tmpid();o._emitLine("var "+n+" = "+u+"["+a+"]["+t+"];"),o._emitLine('frame.set("'+e+'", '+u+"["+a+"]["+t+"]);"),r.set(i.name.children[t].value,n)}),this._emitLoopBindings(i,u,a,l),this._withScopedSyntax(function(){o.compile(i.body,r)}),this._emitLine("}"),this._emitLine("} else {"),s=(e=i.name.children)[0],e=e[1],t=this._tmpid(),n=this._tmpid(),r.set(s.value,t),r.set(e.value,n),this._emitLine(a+" = -1;"),this._emitLine("var "+l+" = runtime.keys("+u+").length;"),this._emitLine("for(var "+t+" in "+u+") {"),this._emitLine(a+"++;"),this._emitLine("var "+n+" = "+u+"["+t+"];"),this._emitLine('frame.set("'+s.value+'", '+t+");"),this._emitLine('frame.set("'+e.value+'", '+n+");"),this._emitLoopBindings(i,u,a,l),this._withScopedSyntax(function(){o.compile(i.body,r)}),this._emitLine("}")):(s=this._tmpid(),r.set(i.name.value,s),this._emitLine("var "+l+" = "+u+".length;"),this._emitLine("for(var "+a+"=0; "+a+" < "+u+".length; "+a+"++) {"),this._emitLine("var "+s+" = "+u+"["+a+"];"),this._emitLine('frame.set("'+i.name.value+'", '+s+");"),this._emitLoopBindings(i,u,a,l),this._withScopedSyntax(function(){o.compile(i.body,r)})),this._emitLine("}"),this._emitLine("}"),i.else_&&(this._emitLine("if (!"+l+") {"),this.compile(i.else_,r),this._emitLine("}")),this._emitLine("frame = frame.pop();")},i._compileAsyncLoop=function(t,n,i){var e,r=this,s=this._tmpid(),o=this._tmpid(),a=this._tmpid(),l=i?"asyncAll":"asyncEach",l=(n=n.push(),this._emitLine("frame = frame.push();"),this._emit("var "+a+" = runtime.fromIterator("),this._compileExpression(t.arr,n),this._emitLine(");"),t.name instanceof h.Array?(e=t.name.children.length,this._emit("runtime."+l+"("+a+", "+e+", function("),t.name.children.forEach(function(e){r._emit(e.value+",")}),this._emit(s+","+o+",next) {"),t.name.children.forEach(function(e){e=e.value;n.set(e,e),r._emitLine('frame.set("'+e+'", '+e+");")})):(e=t.name.value,this._emitLine("runtime."+l+"("+a+", 1, function("+e+", "+s+", "+o+",next) {"),this._emitLine('frame.set("'+e+'", '+e+");"),n.set(e,e)),this._emitLoopBindings(t,a,s,o),this._withScopedSyntax(function(){var e;i&&(e=r._pushBuffer()),r.compile(t.body,n),r._emitLine("next("+s+(e?","+e:"")+");"),i&&r._popBuffer()}),this._tmpid());this._emitLine("}, "+this._makeCallback(l)),this._addScopeLevel(),i&&this._emitLine(this.buffer+" += "+l+";"),t.else_&&(this._emitLine("if (!"+a+".length) {"),this.compile(t.else_,n),this._emitLine("}")),this._emitLine("frame = frame.pop();")},i.compileAsyncEach=function(e,t){this._compileAsyncLoop(e,t)},i.compileAsyncAll=function(e,t){this._compileAsyncLoop(e,t,!0)},i._compileMacro=function(n,e){var i=this,r=[],s=null,t="macro_"+this._tmpid(),o=void 0!==e,a=(n.args.children.forEach(function(e,t){t===n.args.children.length-1&&e instanceof h.Dict?s=e:(i.assertType(e,h.Symbol),r.push(e))}),[].concat(r.map(function(e){return"l_"+e.value}),["kwargs"])),l=r.map(function(e){return'"'+e.value+'"'}),u=(s&&s.children||[]).map(function(e){return'"'+e.key.value+'"'}),c=o?e.push(!0):new f,e=(this._emitLines("var "+t+" = runtime.makeMacro(","["+l.join(", ")+"], ","["+u.join(", ")+"], ","function ("+a.join(", ")+") {","var callerFrame = frame;","frame = "+(o?"frame.push(true);":"new runtime.Frame();"),"kwargs = kwargs || {};",'if (Object.prototype.hasOwnProperty.call(kwargs, "caller")) {','frame.set("caller", kwargs.caller); }'),r.forEach(function(e){i._emitLine('frame.set("'+e.value+'", l_'+e.value+");"),c.set(e.value,"l_"+e.value)}),s&&s.children.forEach(function(e){var t=e.key.value;i._emit('frame.set("'+t+'", '),i._emit('Object.prototype.hasOwnProperty.call(kwargs, "'+t+'")'),i._emit(' ? kwargs["'+t+'"] : '),i._compileExpression(e.value,c),i._emit(");")}),this._pushBuffer());return this._withScopedSyntax(function(){i.compile(n.body,c)}),this._emitLine("frame = "+(o?"frame.pop();":"callerFrame;")),this._emitLine("return new runtime.SafeString("+e+");"),this._emitLine("});"),this._popBuffer(),t},i.compileMacro=function(e,t){var n=this._compileMacro(e),i=e.name.value;t.set(i,n),t.parent?this._emitLine('frame.set("'+i+'", '+n+");"):("_"!==e.name.value.charAt(0)&&this._emitLine('context.addExport("'+i+'");'),this._emitLine('context.setVariable("'+i+'", '+n+");"))},i.compileCaller=function(e,t){this._emit("(function (){");e=this._compileMacro(e,t);this._emit("return "+e+";})()")},i._compileGetTemplate=function(e,t,n,i){var r=this._tmpid(),s=this._templateName(),o=this._makeCallback(r),n=n?"true":"false",i=i?"true":"false";return this._emit("env.getTemplate("),this._compileExpression(e.template,t),this._emitLine(", "+n+", "+s+", "+i+", "+o),r},i.compileImport=function(e,t){var n=e.target.value,i=this._compileGetTemplate(e,t,!1,!1);this._addScopeLevel(),this._emitLine(i+".getExported("+(e.withContext?"context.getVariables(), frame, ":"")+this._makeCallback(i)),this._addScopeLevel(),t.set(n,i),t.parent?this._emitLine('frame.set("'+n+'", '+i+");"):this._emitLine('context.setVariable("'+n+'", '+i+");")},i.compileFromImport=function(e,i){var r=this,s=this._compileGetTemplate(e,i,!1,!1);this._addScopeLevel(),this._emitLine(s+".getExported("+(e.withContext?"context.getVariables(), frame, ":"")+this._makeCallback(s)),this._addScopeLevel(),e.names.children.forEach(function(e){var t,n=r._tmpid(),e=e instanceof h.Pair?(t=e.key.value,e.value.value):t=e.value;r._emitLine("if(Object.prototype.hasOwnProperty.call("+s+', "'+t+'")) {'),r._emitLine("var "+n+" = "+s+"."+t+";"),r._emitLine("} else {"),r._emitLine("cb(new Error(\"cannot import '"+t+"'\")); return;"),r._emitLine("}"),i.set(e,n),i.parent?r._emitLine('frame.set("'+e+'", '+n+");"):r._emitLine('context.setVariable("'+e+'", '+n+");")})},i.compileBlock=function(e){var t=this._tmpid();this.inBlock||this._emit('(parentTemplate ? function(e, c, f, r, cb) { cb(""); } : '),this._emit('context.getBlock("'+e.name.value+'")'),this.inBlock||this._emit(")"),this._emitLine("(env, context, frame, runtime, "+this._makeCallback(t)),this._emitLine(this.buffer+" += "+t+";"),this._addScopeLevel()},i.compileSuper=function(e,t){var n=e.blockName.value,e=e.symbol.value,i=this._makeCallback(e);this._emitLine('context.getSuper(env, "'+n+'", b_'+n+", frame, runtime, "+i),this._emitLine(e+" = runtime.markSafe("+e+");"),this._addScopeLevel(),t.set(e,e)},i.compileExtends=function(e,t){var n=this._tmpid(),e=this._compileGetTemplate(e,t,!0,!1);this._emitLine("parentTemplate = "+e),this._emitLine("for(var "+n+" in parentTemplate.blocks) {"),this._emitLine("context.addBlock("+n+", parentTemplate.blocks["+n+"]);"),this._emitLine("}"),this._addScopeLevel()},i.compileInclude=function(e,t){this._emitLine("var tasks = [];"),this._emitLine("tasks.push("),this._emitLine("function(callback) {");t=this._compileGetTemplate(e,t,!1,e.ignoreMissing),this._emitLine("callback(null,"+t+");});"),this._emitLine("});"),e=this._tmpid();this._emitLine("tasks.push("),this._emitLine("function(template, callback){"),this._emitLine("template.render(context.getVariables(), frame, "+this._makeCallback(e)),this._emitLine("callback(null,"+e+");});"),this._emitLine("});"),this._emitLine("tasks.push("),this._emitLine("function(result, callback){"),this._emitLine(this.buffer+" += result;"),this._emitLine("callback(null);"),this._emitLine("});"),this._emitLine("env.waterfall(tasks, function(){"),this._addScopeLevel()},i.compileTemplateData=function(e,t){this.compileLiteral(e,t)},i.compileCapture=function(e,t){var n=this,i=this.buffer;this.buffer="output",this._emitLine("(function() {"),this._emitLine('var output = "";'),this._withScopedSyntax(function(){n.compile(e.body,t)}),this._emitLine("return output;"),this._emitLine("})()"),this.buffer=i},i.compileOutput=function(t,n){var i=this;t.children.forEach(function(e){e instanceof h.TemplateData?e.value&&(i._emit(i.buffer+" += "),i.compileLiteral(e,n),i._emitLine(";")):(i._emit(i.buffer+" += runtime.suppressValue("),i.throwOnUndefined&&i._emit("runtime.ensureDefined("),i.compile(e,n),i.throwOnUndefined&&i._emit(","+t.lineno+","+t.colno+")"),i._emit(", env.opts.autoescape);\n"))})},i.compileRoot=function(e,t){var i=this,r=(t&&this.fail("compileRoot: root node can't have frame"),t=new f,this._emitFuncBegin(e,"root"),this._emitLine("var parentTemplate = null;"),this._compileChildren(e,t),this._emitLine("if(parentTemplate) {"),this._emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),this._emitLine("} else {"),this._emitLine("cb(null, "+this.buffer+");"),this._emitLine("}"),this._emitFuncEnd(!0),this.inBlock=!0,[]),t=e.findAll(h.Block);t.forEach(function(e,t){var n=e.name.value;if(-1!==r.indexOf(n))throw new Error('Block "'+n+'" defined more than once.');r.push(n),i._emitFuncBegin(e,"b_"+n);n=new f;i._emitLine("var frame = frame.push(true);"),i.compile(e.body,n),i._emitFuncEnd()}),this._emitLine("return {"),t.forEach(function(e,t){e="b_"+e.name.value;i._emitLine(e+": "+e+",")}),this._emitLine("root: root\n};")},i.compile=function(e,t){var n=this["compile"+e.typename];n?n.call(this,e,t):this.fail("compile: Cannot compile node: "+e.typename,e.lineno,e.colno)},i.getCode=function(){return this.codebuf.join("")},n}(n);e.exports={compile:function(e,t,n,i,r){var s=new u(i,(r=void 0===r?{}:r).throwOnUndefined),e=(n||[]).map(function(e){return e.preprocess}).filter(function(e){return!!e}).reduce(function(e,t){return t(e)},e);return s.compile(a.transform(o.parse(e,n,r),t,i)),s.getCode()},Compiler:u}},function(e,t,n){function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var s=n(4),n=n(1).EmitterObj;e.exports=function(e){var t;function n(){return e.apply(this,arguments)||this}t=e,(i=n).prototype=Object.create(t.prototype),r(i.prototype.constructor=i,t);var i=n.prototype;return i.resolve=function(e,t){return s.resolve(s.dirname(e),t)},i.isRelative=function(e){return 0===e.indexOf("./")||0===e.indexOf("../")},n}(n)},function(e,t,n){function i(e,t){e.prototype=Object.create(t.prototype),r(e.prototype.constructor=e,t)}function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var s=n(12),o=n(15),h=n(0),a=n(5),l=n(18),u=n(10),c=u.FileSystemLoader,f=u.WebLoader,d=u.PrecompiledLoader,p=n(20),m=n(21),u=n(1),g=u.Obj,u=u.EmitterObj,y=n(2),_=y.handleError,v=y.Frame,w=n(22);function k(e,t,n){s(function(){e(t,n)})}var b={type:"code",obj:{root:function(e,t,n,i,r){try{r(null,"")}catch(e){r(_(e,null,null))}}}},S=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.init=function(e,t){var n=this;t=this.opts=t||{},this.opts.dev=!!t.dev,this.opts.autoescape=null==t.autoescape||t.autoescape,this.opts.throwOnUndefined=!!t.throwOnUndefined,this.opts.trimBlocks=!!t.trimBlocks,this.opts.lstripBlocks=!!t.lstripBlocks,this.loaders=[],e?this.loaders=h.isArray(e)?e:[e]:c?this.loaders=[new c("views")]:f&&(this.loaders=[new f("/views")]),"undefined"!=typeof window&&window.nunjucksPrecompiled&&this.loaders.unshift(new d(window.nunjucksPrecompiled)),this._initLoaders(),this.globals=m(),this.filters={},this.tests={},this.asyncFilters=[],this.extensions={},this.extensionsList=[],h._entries(l).forEach(function(e){var t=e[0],e=e[1];return n.addFilter(t,e)}),h._entries(p).forEach(function(e){var t=e[0],e=e[1];return n.addTest(t,e)})},n._initLoaders=function(){var i=this;this.loaders.forEach(function(n){n.cache={},"function"==typeof n.on&&(n.on("update",function(e,t){n.cache[e]=null,i.emit("update",e,t,n)}),n.on("load",function(e,t){i.emit("load",e,t,n)}))})},n.invalidateCache=function(){this.loaders.forEach(function(e){e.cache={}})},n.addExtension=function(e,t){return t.__name=e,this.extensions[e]=t,this.extensionsList.push(t),this},n.removeExtension=function(e){var t=this.getExtension(e);t&&(this.extensionsList=h.without(this.extensionsList,t),delete this.extensions[e])},n.getExtension=function(e){return this.extensions[e]},n.hasExtension=function(e){return!!this.extensions[e]},n.addGlobal=function(e,t){return this.globals[e]=t,this},n.getGlobal=function(e){if(void 0===this.globals[e])throw new Error("global not found: "+e);return this.globals[e]},n.addFilter=function(e,t,n){return n&&this.asyncFilters.push(e),this.filters[e]=t,this},n.getFilter=function(e){if(this.filters[e])return this.filters[e];throw new Error("filter not found: "+e)},n.addTest=function(e,t){return this.tests[e]=t,this},n.getTest=function(e){if(this.tests[e])return this.tests[e];throw new Error("test not found: "+e)},n.resolveTemplate=function(e,t,n){return!(!e.isRelative||!t)&&e.isRelative(n)&&e.resolve?e.resolve(t,n):n},n.getTemplate=function(s,i,o,r,a){var l,u=this,c=this,e=null;if(s&&s.raw&&(s=s.raw),h.isFunction(o)&&(a=o,o=null,i=i||!1),h.isFunction(i)&&(a=i,i=!1),s instanceof T)e=s;else{if("string"!=typeof s)throw new Error("template names must be a string: "+s);for(var t=0;t<this.loaders.length;t++){var n=this.loaders[t];if(e=n.cache[this.resolveTemplate(n,o,s)])break}}return e?(i&&e.compile(),a?void a(null,e):e):(h.asyncIter(this.loaders,function(n,e,i,r){function t(e,t){e?r(e):t?(t.loader=n,r(null,t)):i()}s=c.resolveTemplate(n,o,s),n.async?n.getSource(s,t):t(null,n.getSource(s))},function(e,t){if(e=t||e||r?e:new Error("template not found: "+s)){if(a)return void a(e);throw e}var n;t?(n=new T(t.src,u,t.path,i),t.noCache||(t.loader.cache[s]=n)):n=new T(b,u,"",i),a?a(null,n):l=n}),l)},n.express=function(e){return w(this,e)},n.render=function(e,n,i){h.isFunction(n)&&(i=n,n=null);var r=null;return this.getTemplate(e,function(e,t){if(e&&i)k(i,e);else{if(e)throw e;r=t.render(n,i)}}),r},n.renderString=function(e,t,n,i){return h.isFunction(n)&&(i=n,n={}),new T(e,this,(n=n||{}).path).render(t,i)},n.waterfall=function(e,t,n){return o(e,t,n)},t}(u),x=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.init=function(e,t,n){var i=this;this.env=n||new S,this.ctx=h.extend({},e),this.blocks={},this.exported=[],h.keys(t).forEach(function(e){i.addBlock(e,t[e])})},n.lookup=function(e){return(e in this.env.globals&&!(e in this.ctx)?this.env.globals:this.ctx)[e]},n.setVariable=function(e,t){this.ctx[e]=t},n.getVariables=function(){return this.ctx},n.addBlock=function(e,t){return this.blocks[e]=this.blocks[e]||[],this.blocks[e].push(t),this},n.getBlock=function(e){if(this.blocks[e])return this.blocks[e][0];throw new Error('unknown block "'+e+'"')},n.getSuper=function(e,t,n,i,r,s){var n=h.indexOf(this.blocks[t]||[],n),o=this.blocks[t][n+1];if(-1===n||!o)throw new Error('no super block available for "'+t+'"');o(e,this,i,r,s)},n.addExport=function(e){this.exported.push(e)},n.getExported=function(){var t=this,n={};return this.exported.forEach(function(e){n[e]=t.ctx[e]}),n},t}(g),T=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var n=t.prototype;return n.init=function(e,t,n,i){if(this.env=t||new S,h.isObject(e))switch(e.type){case"code":this.tmplProps=e.obj;break;case"string":this.tmplStr=e.obj;break;default:throw new Error("Unexpected template object type "+e.type+"; expected 'code', or 'string'")}else{if(!h.isString(e))throw new Error("src must be a string or an object describing the source");this.tmplStr=e}if(this.path=n,i)try{this._compile()}catch(e){throw h._prettifyError(this.path,this.env.opts.dev,e)}else this.compiled=!1},n.render=function(e,t,n){var i=this,r=("function"==typeof e?(n=e,e={}):"function"==typeof t&&(n=t,t=null),!t);try{this.compile()}catch(e){var s=h._prettifyError(this.path,this.env.opts.dev,e);if(n)return k(n,s);throw s}var s=new x(e||{},this.blocks,this.env),e=t?t.push(!0):new v,o=(e.topLevel=!0,null),a=!1;return this.rootRenderFunc(this.env,s,e,y,function(e,t){if(!a||!n||void 0===t)if(e&&(e=h._prettifyError(i.path,i.env.opts.dev,e),a=!0),n)r?k(n,e,t):n(e,t);else{if(e)throw e;o=t}}),o},n.getExported=function(e,t,n){"function"==typeof e&&(n=e,e={}),"function"==typeof t&&(n=t,t=null);try{this.compile()}catch(e){if(n)return n(e);throw e}var t=t?t.push():new v,i=(t.topLevel=!0,new x(e||{},this.blocks,this.env));this.rootRenderFunc(this.env,i,t,y,function(e){e?n(e,null):n(null,i.getExported())})},n.compile=function(){this.compiled||this._compile()},n._compile=function(){var e;e=this.tmplProps||(e=a.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts),new Function(e)()),this.blocks=this._getBlocks(e),this.rootRenderFunc=e.root,this.compiled=!0},n._getBlocks=function(t){var n={};return h.keys(t).forEach(function(e){"b_"===e.slice(0,2)&&(n[e.slice(2)]=t[e])}),n},t}(g);e.exports={Environment:S,Template:T}},function(e,t,n){function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var a=n(9),h=n(3),i=n(1).Obj,s=n(0),o=function(e){var t;function n(){return e.apply(this,arguments)||this}t=e,(i=n).prototype=Object.create(t.prototype),r(i.prototype.constructor=i,t);var i=n.prototype;return i.init=function(e){this.tokens=e,this.peeked=null,this.breakOnBlocks=null,this.dropLeadingWhitespace=!1,this.extensions=[]},i.nextToken=function(e){var t;if(this.peeked){if(e||this.peeked.type!==a.TOKEN_WHITESPACE)return t=this.peeked,this.peeked=null,t;this.peeked=null}if(t=this.tokens.nextToken(),!e)for(;t&&t.type===a.TOKEN_WHITESPACE;)t=this.tokens.nextToken();return t},i.peekToken=function(){return this.peeked=this.peeked||this.nextToken(),this.peeked},i.pushToken=function(e){if(this.peeked)throw new Error("pushToken: can only push one token on between reads");this.peeked=e},i.error=function(e,t,n){var i;return void 0!==t&&void 0!==n||(t=(i=this.peekToken()||{}).lineno,n=i.colno),void 0!==t&&(t+=1),void 0!==n&&(n+=1),new s.TemplateError(e,t,n)},i.fail=function(e,t,n){throw this.error(e,t,n)},i.skip=function(e){var t=this.nextToken();return!(!t||t.type!==e)||(this.pushToken(t),!1)},i.expect=function(e){var t=this.nextToken();return t.type!==e&&this.fail("expected "+e+", got "+t.type,t.lineno,t.colno),t},i.skipValue=function(e,t){var n=this.nextToken();return!(!n||n.type!==e||n.value!==t)||(this.pushToken(n),!1)},i.skipSymbol=function(e){return this.skipValue(a.TOKEN_SYMBOL,e)},i.advanceAfterBlockEnd=function(e){var t;return e||((t=this.peekToken())||this.fail("unexpected end of file"),t.type!==a.TOKEN_SYMBOL&&this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),e=this.nextToken().value),(t=this.nextToken())&&t.type===a.TOKEN_BLOCK_END?"-"===t.value.charAt(0)&&(this.dropLeadingWhitespace=!0):this.fail("expected block end in "+e+" statement"),t},i.advanceAfterVariableEnd=function(){var e=this.nextToken();e&&e.type===a.TOKEN_VARIABLE_END?this.dropLeadingWhitespace="-"===e.value.charAt(e.value.length-this.tokens.tags.VARIABLE_END.length-1):(this.pushToken(e),this.fail("expected variable end"))},i.parseFor=function(){var e,t,n=this.peekToken();if(this.skipSymbol("for")?(e=new h.For(n.lineno,n.colno),t="endfor"):this.skipSymbol("asyncEach")?(e=new h.AsyncEach(n.lineno,n.colno),t="endeach"):this.skipSymbol("asyncAll")?(e=new h.AsyncAll(n.lineno,n.colno),t="endall"):this.fail("parseFor: expected for{Async}",n.lineno,n.colno),e.name=this.parsePrimary(),e.name instanceof h.Symbol||this.fail("parseFor: variable name expected for loop"),this.peekToken().type===a.TOKEN_COMMA){var i=e.name;for(e.name=new h.Array(i.lineno,i.colno),e.name.addChild(i);this.skip(a.TOKEN_COMMA);){var r=this.parsePrimary();e.name.addChild(r)}}return this.skipSymbol("in")||this.fail('parseFor: expected "in" keyword for loop',n.lineno,n.colno),e.arr=this.parseExpression(),this.advanceAfterBlockEnd(n.value),e.body=this.parseUntilBlocks(t,"else"),this.skipSymbol("else")&&(this.advanceAfterBlockEnd("else"),e.else_=this.parseUntilBlocks(t)),this.advanceAfterBlockEnd(),e},i.parseMacro=function(){var e=this.peekToken(),t=(this.skipSymbol("macro")||this.fail("expected macro"),this.parsePrimary(!0)),n=this.parseSignature(),t=new h.Macro(e.lineno,e.colno,t,n);return this.advanceAfterBlockEnd(e.value),t.body=this.parseUntilBlocks("endmacro"),this.advanceAfterBlockEnd(),t},i.parseCall=function(){var e=this.peekToken(),t=(this.skipSymbol("call")||this.fail("expected call"),this.parseSignature(!0)||new h.NodeList),n=this.parsePrimary(),i=(this.advanceAfterBlockEnd(e.value),this.parseUntilBlocks("endcall")),r=(this.advanceAfterBlockEnd(),new h.Symbol(e.lineno,e.colno,"caller")),t=new h.Caller(e.lineno,e.colno,r,t,i),i=n.args.children;return i[i.length-1]instanceof h.KeywordArgs||i.push(new h.KeywordArgs),i[i.length-1].addChild(new h.Pair(e.lineno,e.colno,r,t)),new h.Output(e.lineno,e.colno,[n])},i.parseWithContext=function(){var e=this.peekToken(),t=null;return this.skipSymbol("with")?t=!0:this.skipSymbol("without")&&(t=!1),null===t||this.skipSymbol("context")||this.fail("parseFrom: expected context after with/without",e.lineno,e.colno),t},i.parseImport=function(){var e=this.peekToken(),t=(this.skipSymbol("import")||this.fail("parseImport: expected import",e.lineno,e.colno),this.parseExpression()),n=(this.skipSymbol("as")||this.fail('parseImport: expected "as" keyword',e.lineno,e.colno),this.parseExpression()),i=this.parseWithContext(),t=new h.Import(e.lineno,e.colno,t,n,i);return this.advanceAfterBlockEnd(e.value),t},i.parseFrom=function(){for(var e,t=this.peekToken(),n=(this.skipSymbol("from")||this.fail("parseFrom: expected from"),this.parseExpression()),i=(this.skipSymbol("import")||this.fail("parseFrom: expected import",t.lineno,t.colno),new h.NodeList);;){var r=this.peekToken();if(r.type===a.TOKEN_BLOCK_END){i.children.length||this.fail("parseFrom: Expected at least one import name",t.lineno,t.colno),"-"===r.value.charAt(0)&&(this.dropLeadingWhitespace=!0),this.nextToken();break}0<i.children.length&&!this.skip(a.TOKEN_COMMA)&&this.fail("parseFrom: expected comma",t.lineno,t.colno);var s,r=this.parsePrimary();"_"===r.value.charAt(0)&&this.fail("parseFrom: names starting with an underscore cannot be imported",r.lineno,r.colno),this.skipSymbol("as")?(s=this.parsePrimary(),i.addChild(new h.Pair(r.lineno,r.colno,r,s))):i.addChild(r),e=this.parseWithContext()}return new h.FromImport(t.lineno,t.colno,n,i,e)},i.parseBlock=function(){var e=this.peekToken(),t=(this.skipSymbol("block")||this.fail("parseBlock: expected block",e.lineno,e.colno),new h.Block(e.lineno,e.colno)),e=(t.name=this.parsePrimary(),t.name instanceof h.Symbol||this.fail("parseBlock: variable name expected",e.lineno,e.colno),this.advanceAfterBlockEnd(e.value),t.body=this.parseUntilBlocks("endblock"),this.skipSymbol("endblock"),this.skipSymbol(t.name.value),this.peekToken());return e||this.fail("parseBlock: expected endblock, got end of file"),this.advanceAfterBlockEnd(e.value),t},i.parseExtends=function(){var e="extends",t=this.peekToken(),e=(this.skipSymbol(e)||this.fail("parseTemplateRef: expected "+e),new h.Extends(t.lineno,t.colno));return e.template=this.parseExpression(),this.advanceAfterBlockEnd(t.value),e},i.parseInclude=function(){var e="include",t=this.peekToken(),e=(this.skipSymbol(e)||this.fail("parseInclude: expected "+e),new h.Include(t.lineno,t.colno));return e.template=this.parseExpression(),this.skipSymbol("ignore")&&this.skipSymbol("missing")&&(e.ignoreMissing=!0),this.advanceAfterBlockEnd(t.value),e},i.parseIf=function(){var e,t=this.peekToken(),t=(this.skipSymbol("if")||this.skipSymbol("elif")||this.skipSymbol("elseif")?e=new h.If(t.lineno,t.colno):this.skipSymbol("ifAsync")?e=new h.IfAsync(t.lineno,t.colno):this.fail("parseIf: expected if, elif, or elseif",t.lineno,t.colno),e.cond=this.parseExpression(),this.advanceAfterBlockEnd(t.value),e.body=this.parseUntilBlocks("elif","elseif","else","endif"),this.peekToken());switch(t&&t.value){case"elseif":case"elif":e.else_=this.parseIf();break;case"else":this.advanceAfterBlockEnd(),e.else_=this.parseUntilBlocks("endif"),this.advanceAfterBlockEnd();break;case"endif":e.else_=null,this.advanceAfterBlockEnd();break;default:this.fail("parseIf: expected elif, else, or endif, got end of file")}return e},i.parseSet=function(){for(var e,t=this.peekToken(),n=(this.skipSymbol("set")||this.fail("parseSet: expected set",t.lineno,t.colno),new h.Set(t.lineno,t.colno,[]));(e=this.parsePrimary())&&(n.targets.push(e),this.skip(a.TOKEN_COMMA)););return this.skipValue(a.TOKEN_OPERATOR,"=")?(n.value=this.parseExpression(),this.advanceAfterBlockEnd(t.value)):this.skip(a.TOKEN_BLOCK_END)?(n.body=new h.Capture(t.lineno,t.colno,this.parseUntilBlocks("endset")),n.value=null,this.advanceAfterBlockEnd()):this.fail("parseSet: expected = or block end in set tag",t.lineno,t.colno),n},i.parseSwitch=function(){var e,t="switch",n="endswitch",i="case",r="default",s=this.peekToken(),o=(this.skipSymbol(t)||this.skipSymbol(i)||this.skipSymbol(r)||this.fail('parseSwitch: expected "switch," "case" or "default"',s.lineno,s.colno),this.parseExpression()),a=(this.advanceAfterBlockEnd(t),this.parseUntilBlocks(i,r,n),this.peekToken()),l=[];do{this.skipSymbol(i);var u=this.parseExpression(),c=(this.advanceAfterBlockEnd(t),this.parseUntilBlocks(i,r,n))}while(l.push(new h.Case(a.line,a.col,u,c)),(a=this.peekToken())&&a.value===i);switch(a.value){case r:this.advanceAfterBlockEnd(),e=this.parseUntilBlocks(n),this.advanceAfterBlockEnd();break;case n:this.advanceAfterBlockEnd();break;default:this.fail('parseSwitch: expected "case," "default" or "endswitch," got EOF.')}return new h.Switch(s.lineno,s.colno,o,l,e)},i.parseStatement=function(){var e=this.peekToken();if(e.type!==a.TOKEN_SYMBOL&&this.fail("tag name expected",e.lineno,e.colno),this.breakOnBlocks&&-1!==s.indexOf(this.breakOnBlocks,e.value))return null;switch(e.value){case"raw":return this.parseRaw();case"verbatim":return this.parseRaw("verbatim");case"if":case"ifAsync":return this.parseIf();case"for":case"asyncEach":case"asyncAll":return this.parseFor();case"block":return this.parseBlock();case"extends":return this.parseExtends();case"include":return this.parseInclude();case"set":return this.parseSet();case"macro":return this.parseMacro();case"call":return this.parseCall();case"import":return this.parseImport();case"from":return this.parseFrom();case"filter":return this.parseFilterStatement();case"switch":return this.parseSwitch();default:if(this.extensions.length)for(var t=0;t<this.extensions.length;t++){var n=this.extensions[t];if(-1!==s.indexOf(n.tags||[],e.value))return n.parse(this,h,a)}this.fail("unknown block tag: "+e.value,e.lineno,e.colno)}},i.parseRaw=function(e){for(var t="end"+(e=e||"raw"),n=new RegExp("([\\s\\S]*?){%\\s*("+e+"|"+t+")\\s*(?=%})%}"),i=1,r="",s=this.advanceAfterBlockEnd();(l=this.tokens._extractRegex(n))&&0<i;){var o=l[0],a=l[1],l=l[2];l===e?i+=1:l===t&&--i,0===i?(r+=a,this.tokens.backN(o.length-a.length)):r+=o}return new h.Output(s.lineno,s.colno,[new h.TemplateData(s.lineno,s.colno,r)])},i.parsePostfix=function(e){for(var t,n=this.peekToken();n;){if(n.type===a.TOKEN_LEFT_PAREN)e=new h.FunCall(n.lineno,n.colno,e,this.parseSignature());else if(n.type===a.TOKEN_LEFT_BRACKET)1<(t=this.parseAggregate()).children.length&&this.fail("invalid index"),e=new h.LookupVal(n.lineno,n.colno,e,t.children[0]);else{if(n.type!==a.TOKEN_OPERATOR||"."!==n.value)break;this.nextToken();var i=this.nextToken();i.type!==a.TOKEN_SYMBOL&&this.fail("expected name as lookup value, got "+i.value,i.lineno,i.colno),t=new h.Literal(i.lineno,i.colno,i.value),e=new h.LookupVal(n.lineno,n.colno,e,t)}n=this.peekToken()}return e},i.parseExpression=function(){return this.parseInlineIf()},i.parseInlineIf=function(){var e,t,n=this.parseOr();return this.skipSymbol("if")&&(e=this.parseOr(),t=n,(n=new h.InlineIf(n.lineno,n.colno)).body=t,n.cond=e,this.skipSymbol("else")?n.else_=this.parseOr():n.else_=null),n},i.parseOr=function(){for(var e=this.parseAnd();this.skipSymbol("or");)var t=this.parseAnd(),e=new h.Or(e.lineno,e.colno,e,t);return e},i.parseAnd=function(){for(var e=this.parseNot();this.skipSymbol("and");)var t=this.parseNot(),e=new h.And(e.lineno,e.colno,e,t);return e},i.parseNot=function(){var e=this.peekToken();return this.skipSymbol("not")?new h.Not(e.lineno,e.colno,this.parseNot()):this.parseIn()},i.parseIn=function(){for(var e=this.parseIs();;){var t=this.nextToken();if(!t)break;var n=t.type===a.TOKEN_SYMBOL&&"not"===t.value;if(n||this.pushToken(t),!this.skipSymbol("in")){n&&this.pushToken(t);break}t=this.parseIs(),e=new h.In(e.lineno,e.colno,e,t);n&&(e=new h.Not(e.lineno,e.colno,e))}return e},i.parseIs=function(){var e,t,n=this.parseCompare();return n=this.skipSymbol("is")&&(e=this.skipSymbol("not"),t=this.parseCompare(),n=new h.Is(n.lineno,n.colno,n,t),e)?new h.Not(n.lineno,n.colno,n):n},i.parseCompare=function(){for(var e=["==","===","!=","!==","<",">","<=",">="],t=this.parseConcat(),n=[];;){var i=this.nextToken();if(!i)break;if(-1===e.indexOf(i.value)){this.pushToken(i);break}n.push(new h.CompareOperand(i.lineno,i.colno,this.parseConcat(),i.value))}return n.length?new h.Compare(n[0].lineno,n[0].colno,t,n):t},i.parseConcat=function(){for(var e=this.parseAdd();this.skipValue(a.TOKEN_TILDE,"~");)var t=this.parseAdd(),e=new h.Concat(e.lineno,e.colno,e,t);return e},i.parseAdd=function(){for(var e=this.parseSub();this.skipValue(a.TOKEN_OPERATOR,"+");)var t=this.parseSub(),e=new h.Add(e.lineno,e.colno,e,t);return e},i.parseSub=function(){for(var e=this.parseMul();this.skipValue(a.TOKEN_OPERATOR,"-");)var t=this.parseMul(),e=new h.Sub(e.lineno,e.colno,e,t);return e},i.parseMul=function(){for(var e=this.parseDiv();this.skipValue(a.TOKEN_OPERATOR,"*");)var t=this.parseDiv(),e=new h.Mul(e.lineno,e.colno,e,t);return e},i.parseDiv=function(){for(var e=this.parseFloorDiv();this.skipValue(a.TOKEN_OPERATOR,"/");)var t=this.parseFloorDiv(),e=new h.Div(e.lineno,e.colno,e,t);return e},i.parseFloorDiv=function(){for(var e=this.parseMod();this.skipValue(a.TOKEN_OPERATOR,"//");)var t=this.parseMod(),e=new h.FloorDiv(e.lineno,e.colno,e,t);return e},i.parseMod=function(){for(var e=this.parsePow();this.skipValue(a.TOKEN_OPERATOR,"%");)var t=this.parsePow(),e=new h.Mod(e.lineno,e.colno,e,t);return e},i.parsePow=function(){for(var e=this.parseUnary();this.skipValue(a.TOKEN_OPERATOR,"**");)var t=this.parseUnary(),e=new h.Pow(e.lineno,e.colno,e,t);return e},i.parseUnary=function(e){var t=this.peekToken(),t=this.skipValue(a.TOKEN_OPERATOR,"-")?new h.Neg(t.lineno,t.colno,this.parseUnary(!0)):this.skipValue(a.TOKEN_OPERATOR,"+")?new h.Pos(t.lineno,t.colno,this.parseUnary(!0)):this.parsePrimary();return t=e?t:this.parseFilter(t)},i.parsePrimary=function(e){var t,n=this.nextToken(),i=null;if(n?n.type===a.TOKEN_STRING?t=n.value:n.type===a.TOKEN_INT?t=parseInt(n.value,10):n.type===a.TOKEN_FLOAT?t=parseFloat(n.value):n.type===a.TOKEN_BOOLEAN?"true"===n.value?t=!0:"false"===n.value?t=!1:this.fail("invalid boolean: "+n.value,n.lineno,n.colno):n.type===a.TOKEN_NONE?t=null:n.type===a.TOKEN_REGEX&&(t=new RegExp(n.value.body,n.value.flags)):this.fail("expected expression, got end of file"),i=void 0!==t?new h.Literal(n.lineno,n.colno,t):n.type===a.TOKEN_SYMBOL?new h.Symbol(n.lineno,n.colno,n.value):(this.pushToken(n),this.parseAggregate()),i=e?i:this.parsePostfix(i))return i;throw this.error("unexpected token: "+n.value,n.lineno,n.colno)},i.parseFilterName=function(){for(var e=this.expect(a.TOKEN_SYMBOL),t=e.value;this.skipValue(a.TOKEN_OPERATOR,".");)t+="."+this.expect(a.TOKEN_SYMBOL).value;return new h.Symbol(e.lineno,e.colno,t)},i.parseFilterArgs=function(e){return this.peekToken().type===a.TOKEN_LEFT_PAREN?this.parsePostfix(e).args.children:[]},i.parseFilter=function(e){for(;this.skip(a.TOKEN_PIPE);){var t=this.parseFilterName();e=new h.Filter(t.lineno,t.colno,t,new h.NodeList(t.lineno,t.colno,[e].concat(this.parseFilterArgs(e))))}return e},i.parseFilterStatement=function(){var e=this.peekToken(),t=(this.skipSymbol("filter")||this.fail("parseFilterStatement: expected filter"),this.parseFilterName()),n=this.parseFilterArgs(t),e=(this.advanceAfterBlockEnd(e.value),new h.Capture(t.lineno,t.colno,this.parseUntilBlocks("endfilter"))),e=(this.advanceAfterBlockEnd(),new h.Filter(t.lineno,t.colno,t,new h.NodeList(t.lineno,t.colno,[e].concat(n))));return new h.Output(t.lineno,t.colno,[e])},i.parseAggregate=function(){var e,t=this.nextToken();switch(t.type){case a.TOKEN_LEFT_PAREN:e=new h.Group(t.lineno,t.colno);break;case a.TOKEN_LEFT_BRACKET:e=new h.Array(t.lineno,t.colno);break;case a.TOKEN_LEFT_CURLY:e=new h.Dict(t.lineno,t.colno);break;default:return null}for(;;){var n,i=this.peekToken().type;if(i===a.TOKEN_RIGHT_PAREN||i===a.TOKEN_RIGHT_BRACKET||i===a.TOKEN_RIGHT_CURLY){this.nextToken();break}0<e.children.length&&(this.skip(a.TOKEN_COMMA)||this.fail("parseAggregate: expected comma after expression",t.lineno,t.colno)),e instanceof h.Dict?(i=this.parsePrimary(),this.skip(a.TOKEN_COLON)||this.fail("parseAggregate: expected colon after dict key",t.lineno,t.colno),n=this.parseExpression(),e.addChild(new h.Pair(i.lineno,i.colno,i,n))):(i=this.parseExpression(),e.addChild(i))}return e},i.parseSignature=function(e,t){var n=this.peekToken();if(!t&&n.type!==a.TOKEN_LEFT_PAREN){if(e)return null;this.fail("expected arguments",n.lineno,n.colno)}n.type===a.TOKEN_LEFT_PAREN&&(n=this.nextToken());for(var i,r=new h.NodeList(n.lineno,n.colno),s=new h.KeywordArgs(n.lineno,n.colno),o=!1;;){if(n=this.peekToken(),!t&&n.type===a.TOKEN_RIGHT_PAREN){this.nextToken();break}if(t&&n.type===a.TOKEN_BLOCK_END)break;o&&!this.skip(a.TOKEN_COMMA)?this.fail("parseSignature: expected comma after expression",n.lineno,n.colno):(i=this.parseExpression(),this.skipValue(a.TOKEN_OPERATOR,"=")?s.addChild(new h.Pair(i.lineno,i.colno,i,this.parseExpression())):r.addChild(i)),o=!0}return s.children.length&&r.addChild(s),r},i.parseUntilBlocks=function(){for(var e=this.breakOnBlocks,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.breakOnBlocks=n;var r=this.parse();return this.breakOnBlocks=e,r},i.parseNodes=function(){for(var e,t=[];e=this.nextToken();)if(e.type===a.TOKEN_DATA){var n=e.value,i=this.peekToken(),r=i&&i.value;this.dropLeadingWhitespace&&(n=n.replace(/^\s*/,""),this.dropLeadingWhitespace=!1),i&&(i.type===a.TOKEN_BLOCK_START&&"-"===r.charAt(r.length-1)||i.type===a.TOKEN_VARIABLE_START&&"-"===r.charAt(this.tokens.tags.VARIABLE_START.length)||i.type===a.TOKEN_COMMENT&&"-"===r.charAt(this.tokens.tags.COMMENT_START.length))&&(n=n.replace(/\s*$/,"")),t.push(new h.Output(e.lineno,e.colno,[new h.TemplateData(e.lineno,e.colno,n)]))}else if(e.type===a.TOKEN_BLOCK_START){this.dropLeadingWhitespace=!1;i=this.parseStatement();if(!i)break;t.push(i)}else e.type===a.TOKEN_VARIABLE_START?(r=this.parseExpression(),this.dropLeadingWhitespace=!1,this.advanceAfterVariableEnd(),t.push(new h.Output(e.lineno,e.colno,[r]))):e.type===a.TOKEN_COMMENT?this.dropLeadingWhitespace="-"===e.value.charAt(e.value.length-this.tokens.tags.COMMENT_END.length-1):this.fail("Unexpected token at top-level: "+e.type,e.lineno,e.colno);return t},i.parse=function(){return new h.NodeList(0,0,this.parseNodes())},i.parseAsRoot=function(){return new h.Root(0,0,this.parseNodes())},n}(i);e.exports={parse:function(e,t,n){e=new o(a.lex(e,n));return void 0!==t&&(e.extensions=t),e.parseAsRoot()},Parser:o}},function(e,t,n){var p=n(0),m=" \n\t\r ",g="()[]{}%*-+~/#,:|.<>=!",y="whitespace",_="block-start",v="block-end",w="variable-start",k="variable-end",b="comment",S="left-paren",x="right-paren",T="left-bracket",O="right-bracket",E="left-curly",C="right-curly",L="operator",N="boolean",A="none";function M(e,t,n,i){return{type:e,value:t,lineno:n,colno:i}}var i=function(){function e(e,t){this.str=e,this.index=0,this.len=e.length,this.lineno=0,this.colno=0,this.in_code=!1;e=(t=t||{}).tags||{};this.tags={BLOCK_START:e.blockStart||"{%",BLOCK_END:e.blockEnd||"%}",VARIABLE_START:e.variableStart||"{{",VARIABLE_END:e.variableEnd||"}}",COMMENT_START:e.commentStart||"{#",COMMENT_END:e.commentEnd||"#}"},this.trimBlocks=!!t.trimBlocks,this.lstripBlocks=!!t.lstripBlocks}var t=e.prototype;return t.nextToken=function(){var e=this.lineno,t=this.colno;if(this.in_code){var n,i=this.current();if(this.isFinished())return null;if('"'===i||"'"===i)return M("string",this._parseString(i),e,t);if(n=this._extract(m))return M(y,n,e,t);if(n=(n=this._extractString(this.tags.BLOCK_END))||this._extractString("-"+this.tags.BLOCK_END))return this.in_code=!1,this.trimBlocks&&("\n"===(i=this.current())?this.forward():"\r"===i&&(this.forward(),"\n"===(i=this.current())?this.forward():this.back())),M(v,n,e,t);if(n=(n=this._extractString(this.tags.VARIABLE_END))||this._extractString("-"+this.tags.VARIABLE_END))return this.in_code=!1,M(k,n,e,t);if("r"===i&&"/"===this.str.charAt(this.index+1)){this.forwardN(2);for(var r="";!this.isFinished();){if("/"===this.current()&&"\\"!==this.previous()){this.forward();break}r+=this.current(),this.forward()}for(var s=["g","i","m","y"],o="";!this.isFinished();){if(!(-1!==s.indexOf(this.current())))break;o+=this.current(),this.forward()}return M("regex",{body:r,flags:o},e,t)}if(-1!==g.indexOf(i)){this.forward();var a,l=["==","===","!=","!==","<=",">=","//","**"],u=i+this.current();switch(-1!==p.indexOf(l,u)&&(this.forward(),-1!==p.indexOf(l,(i=u)+this.current()))&&(i=u+this.current(),this.forward()),i){case"(":a=S;break;case")":a=x;break;case"[":a=T;break;case"]":a=O;break;case"{":a=E;break;case"}":a=C;break;case",":a="comma";break;case":":a="colon";break;case"~":a="tilde";break;case"|":a="pipe";break;default:a=L}return M(a,i,e,t)}if((n=this._extractUntil(m+g)).match(/^[-+]?[0-9]+$/))return"."===this.current()?(this.forward(),M("float",n+"."+this._extract("0123456789"),e,t)):M("int",n,e,t);if(n.match(/^(true|false)$/))return M(N,n,e,t);if("none"===n)return M(A,n,e,t);if("null"===n)return M(A,n,e,t);if(n)return M("symbol",n,e,t);throw new Error("Unexpected value while parsing: "+n)}var c=this.tags.BLOCK_START.charAt(0)+this.tags.VARIABLE_START.charAt(0)+this.tags.COMMENT_START.charAt(0)+this.tags.COMMENT_END.charAt(0);if(this.isFinished())return null;if(n=(n=this._extractString(this.tags.BLOCK_START+"-"))||this._extractString(this.tags.BLOCK_START))return this.in_code=!0,M(_,n,e,t);if(n=(n=this._extractString(this.tags.VARIABLE_START+"-"))||this._extractString(this.tags.VARIABLE_START))return this.in_code=!0,M(w,n,e,t);n="";var h,f=!1;for(this._matches(this.tags.COMMENT_START)&&(f=!0,n=this._extractString(this.tags.COMMENT_START));null!==(h=this._extractUntil(c));){if(n+=h,(this._matches(this.tags.BLOCK_START)||this._matches(this.tags.VARIABLE_START)||this._matches(this.tags.COMMENT_START))&&!f){if(this.lstripBlocks&&this._matches(this.tags.BLOCK_START)&&0<this.colno&&this.colno<=n.length){var d=n.slice(-this.colno);if(/^\s+$/.test(d)&&!(n=n.slice(0,-this.colno)).length)return this.nextToken()}break}if(this._matches(this.tags.COMMENT_END)){if(!f)throw new Error("unexpected end of comment");n+=this._extractString(this.tags.COMMENT_END);break}n+=this.current(),this.forward()}if(null===h&&f)throw new Error("expected end of comment, got end of file");return M(f?b:"data",n,e,t)},t._parseString=function(e){this.forward();for(var t="";!this.isFinished()&&this.current()!==e;){var n=this.current();if("\\"===n)switch(this.forward(),this.current()){case"n":t+="\n";break;case"t":t+="\t";break;case"r":t+="\r";break;default:t+=this.current()}else t+=n;this.forward()}return this.forward(),t},t._matches=function(e){return this.index+e.length>this.len?null:this.str.slice(this.index,this.index+e.length)===e},t._extractString=function(e){return this._matches(e)?(this.forwardN(e.length),e):null},t._extractUntil=function(e){return this._extractMatching(!0,e||"")},t._extract=function(e){return this._extractMatching(!1,e)},t._extractMatching=function(e,t){if(this.isFinished())return null;var n=t.indexOf(this.current());if(e&&-1===n||!e&&-1!==n){for(var i=this.current(),r=(this.forward(),t.indexOf(this.current()));(e&&-1===r||!e&&-1!==r)&&!this.isFinished();)i+=this.current(),this.forward(),r=t.indexOf(this.current());return i}return""},t._extractRegex=function(e){e=this.currentStr().match(e);return e?(this.forwardN(e[0].length),e):null},t.isFinished=function(){return this.index>=this.len},t.forwardN=function(e){for(var t=0;t<e;t++)this.forward()},t.forward=function(){this.index++,"\n"===this.previous()?(this.lineno++,this.colno=0):this.colno++},t.backN=function(e){for(var t=0;t<e;t++)this.back()},t.back=function(){var e;this.index--,"\n"===this.current()?(this.lineno--,e=this.src.lastIndexOf("\n",this.index-1),this.colno=-1===e?this.index:this.index-e):this.colno--},t.current=function(){return this.isFinished()?"":this.str.charAt(this.index)},t.currentStr=function(){return this.isFinished()?"":this.str.substr(this.index)},t.previous=function(){return this.str.charAt(this.index-1)},e}();e.exports={lex:function(e,t){return new i(e,t)},TOKEN_STRING:"string",TOKEN_WHITESPACE:y,TOKEN_DATA:"data",TOKEN_BLOCK_START:_,TOKEN_BLOCK_END:v,TOKEN_VARIABLE_START:w,TOKEN_VARIABLE_END:k,TOKEN_COMMENT:b,TOKEN_LEFT_PAREN:S,TOKEN_RIGHT_PAREN:x,TOKEN_LEFT_BRACKET:T,TOKEN_RIGHT_BRACKET:O,TOKEN_LEFT_CURLY:E,TOKEN_RIGHT_CURLY:C,TOKEN_OPERATOR:L,TOKEN_COMMA:"comma",TOKEN_COLON:"colon",TOKEN_TILDE:"tilde",TOKEN_PIPE:"pipe",TOKEN_INT:"int",TOKEN_FLOAT:"float",TOKEN_BOOLEAN:N,TOKEN_NONE:A,TOKEN_SYMBOL:"symbol",TOKEN_SPECIAL:"special",TOKEN_REGEX:"regex"}},function(e,t,n){function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var i=n(6),n=n(19).PrecompiledLoader,i=function(i){var e;function t(e,t){var n=i.call(this)||this;return n.baseURL=e||".",n.useCache=!!(t=t||{}).useCache,n.async=!!t.async,n}e=i,(n=t).prototype=Object.create(e.prototype),r(n.prototype.constructor=n,e);var n=t.prototype;return n.resolve=function(e,t){throw new Error("relative templates not support in the browser yet")},n.getSource=function(n,i){var r,s=this,o=this.useCache;return this.fetch(this.baseURL+"/"+n,function(e,t){if(e)if(i)i(e.content);else{if(404!==e.status)throw e.content;r=null}else r={src:t,path:n,noCache:!o},s.emit("load",n,r),i&&i(null,r)}),r},n.fetch=function(e,t){if("undefined"==typeof window)throw new Error("WebLoader can only by used in a browser");var n=new XMLHttpRequest,i=!0;n.onreadystatechange=function(){4===n.readyState&&i&&(i=!1,0===n.status||200===n.status?t(null,n.responseText):t({status:n.status,content:n.responseText}))},e+=(-1===e.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),n.open("GET",e,this.async),n.send()},t}(i);e.exports={WebLoader:i,PrecompiledLoader:n}},function(e,t,n){var r,i=n(0),s=n(7),o=s.Environment,a=s.Template,s=n(6),l=n(10),u=n(23),c=n(5),h=n(8),f=n(9),d=n(2),p=n(3),n=n(25);function m(e,t){var n;return t=t||{},i.isObject(e)&&(t=e,e=null),l.FileSystemLoader?n=new l.FileSystemLoader(e,{watch:t.watch,noCache:t.noCache}):l.WebLoader&&(n=new l.WebLoader(e,{useCache:t.web&&t.web.useCache,async:t.web&&t.web.async})),r=new o(n,t),t&&t.express&&r.express(t.express),r}e.exports={Environment:o,Template:a,Loader:s,FileSystemLoader:l.FileSystemLoader,NodeResolveLoader:l.NodeResolveLoader,PrecompiledLoader:l.PrecompiledLoader,WebLoader:l.WebLoader,compiler:c,parser:h,lexer:f,runtime:d,lib:i,nodes:p,installJinjaCompat:n,configure:m,reset:function(){r=void 0},compile:function(e,t,n,i){return r||m(),new a(e,t,n,i)},render:function(e,t,n){return r||m(),r.render(e,t,n)},renderString:function(e,t,n){return r||m(),r.renderString(e,t,n)},precompile:u?u.precompile:void 0,precompileString:u?u.precompileString:void 0}},function(e,t,n){var i=n(13),r=[],s=[],o=i.makeRequestCallFromTimer(function(){if(s.length)throw s.shift()});function a(e){var t=r.length?r.pop():new l;t.task=e,i(t)}function l(){this.task=null}e.exports=a,l.prototype.call=function(){try{this.task.call()}catch(e){a.onerror?a.onerror(e):(s.push(e),o())}finally{this.task=null,r[r.length]=this}}},function(u,e,t){!function(e){function t(e){i.length||n(),i[i.length]=e}u.exports=t;var n,i=[],r=0;function s(){for(;r<i.length;){var e=r;if(r+=1,i[e].call(),1024<r){for(var t=0,n=i.length-r;t<n;t++)i[t]=i[t+r];i.length-=r,r=0}}i.length=0,r=0}var o,a,e=void 0!==e?e:self,e=e.MutationObserver||e.WebKitMutationObserver;function l(i){return function(){var e=setTimeout(n,0),t=setInterval(n,50);function n(){clearTimeout(e),clearInterval(t),i()}}}n="function"==typeof e?(o=1,e=new e(e=s),a=document.createTextNode(""),e.observe(a,{characterData:!0}),function(){o=-o,a.data=o}):l(s),t.requestFlush=n,t.makeRequestCallFromTimer=l}.call(e,t(14))},function(e,t){var n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var o;function a(){var e=Array.prototype.slice.call(arguments);"function"==typeof e[0]&&e[0].apply(null,e.splice(1))}function l(e){"function"==typeof setImmediate?setImmediate(e):"undefined"!=typeof process&&process.nextTick?process.nextTick(e):setTimeout(e,0)}function u(n){function i(e){function t(){return n.length&&n[e].apply(null,arguments),t.next()}return t.next=function(){return e<n.length-1?i(e+1):null},t}return i(0)}function i(e,i,t){var r,s=t?l:a;return i=i||function(){},o(e)?e.length?void(r=function(n){return function(e){var t;e?(i.apply(null,arguments),i=function(){}):(t=Array.prototype.slice.call(arguments,1),(e=n.next())?t.push(r(e)):t.push(i),s(function(){n.apply(null,t)}))}})(u(e))():i():(t=new Error("First argument to waterfall must be an array of functions"),i(t))}o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},void 0!==(t=function(){return i}.apply(t,[]))&&(e.exports=t)},function(e,t,n){var i="object"==typeof Reflect?Reflect:null,l=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};var r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(a,l){return new Promise(function(e,t){function n(e){a.removeListener(l,i),t(e)}function i(){"function"==typeof a.removeListener&&a.removeListener("error",n),e([].slice.call(arguments))}var r,s,o;g(a,l,i,{once:!0}),"error"!==l&&(s=n,o={once:!0},"function"==typeof(r=a).on)&&g(r,"error",s,o)})},(o.EventEmitter=o).prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function h(e,t,n,i){var r,s;return u(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener||n),r=e._events),s=r[t]),void 0===s?(s=r[t]=n,++e._eventsCount):("function"==typeof s?s=r[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),0<(r=c(e))&&s.length>r&&!s.warned&&(s.warned=!0,(i=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",i.emitter=e,i.type=t,i.count=s.length,n=i,console)&&console.warn&&console.warn(n)),e}function f(e,t,n){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},t=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(e);return t.listener=n,e.wrapFn=t}function d(e,t,n){e=e._events;if(void 0===e)return[];e=e[t];if(void 0===e)return[];if("function"==typeof e)return n?[e.listener||e]:[e];if(n){for(var i=e,r=new Array(i.length),s=0;s<r.length;++s)r[s]=i[s].listener||i[s];return r}return m(e,e.length)}function p(e){var t=this._events;if(void 0!==t){t=t[e];if("function"==typeof t)return 1;if(void 0!==t)return t.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function g(n,i,r,s){if("function"==typeof n.on)s.once?n.once(i,r):n.on(i,r);else{if("function"!=typeof n.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n);n.addEventListener(i,function e(t){s.once&&n.removeEventListener(i,e),r(t)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){if((s=0<t.length?t[0]:s)instanceof Error)throw s;i=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw i.context=s,i}var s=r[e];if(void 0===s)return!1;if("function"==typeof s)l(s,this,t);else for(var o=s.length,a=m(s,o),n=0;n<o;++n)l(a[n],this,t);return!0},o.prototype.on=o.prototype.addListener=function(e,t){return h(this,e,t,!1)},o.prototype.prependListener=function(e,t){return h(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},o.prototype.off=o.prototype.removeListener=function(e,t){var n,i,r,s,o;if(u(t),void 0!==(i=this._events)&&void 0!==(n=i[e]))if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;0<=s;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;if(0===r)n.shift();else{for(var a=n,l=r;l+1<a.length;l++)a[l]=a[l+1];a.pop()}1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},o.prototype.removeAllListeners=function(e){var t,n=this._events;if(void 0!==n)if(void 0===n.removeListener)0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]);else if(0===arguments.length){for(var i,r=Object.keys(n),s=0;s<r.length;++s)"removeListener"!==(i=r[s])&&this.removeAllListeners(i);this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0}else if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;0<=s;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return 0<this._eventsCount?r(this._events):[]}},function(e,t,n){var s=n(3),o=n(0),i=0;function a(){return"hole_"+i++}function l(e,t){for(var n=null,i=0;i<e.length;i++){var r=t(e[i]);r!==e[i]&&((n=n||e.slice())[i]=r)}return n||e}function u(n,t,i){if(!(n instanceof s.Node))return n;if(!i){var e=t(n);if(e&&e!==n)return e}var r;return n instanceof s.NodeList?(e=l(n.children,function(e){return u(e,t,i)}))!==n.children&&(n=new s[n.typename](n.lineno,n.colno,e)):n instanceof s.CallExtension?(e=u(n.args,t,i),r=l(n.contentArgs,function(e){return u(e,t,i)}),e===n.args&&r===n.contentArgs||(n=new s[n.typename](n.extName,n.prop,e,r))):(r=l(e=n.fields.map(function(e){return n[e]}),function(e){return u(e,t,i)}))!==e&&(n=new s[n.typename](n.lineno,n.colno),r.forEach(function(e,t){n[n.fields[t]]=e})),i&&t(n)||n}function c(e,t){return u(e,t,!0)}function r(e,n,t){var i=[],r=c(t?e[t]:e,function(e){var t;return e instanceof s.Block?e:((e instanceof s.Filter&&-1!==o.indexOf(n,e.name.value)||e instanceof s.CallExtensionAsync)&&(t=new s.Symbol(e.lineno,e.colno,a()),i.push(new s.FilterAsync(e.lineno,e.colno,e.name,e.args,t))),t)});return t?e[t]=r:e=r,i.length?(i.push(e),new s.NodeList(e.lineno,e.colno,i)):e}function h(e,t){return n=t,t=c(e,function(e){return e instanceof s.Output?r(e,n):e instanceof s.Set?r(e,n,"value"):e instanceof s.For?r(e,n,"arr"):e instanceof s.If?r(e,n,"cond"):e instanceof s.CallExtension?r(e,n,"args"):void 0}),c(u(t,function(e){var t,n;e instanceof s.Block&&(t=!1,n=a(),e.body=u(e.body,function(e){if(e instanceof s.FunCall&&"super"===e.name.value)return t=!0,new s.Symbol(e.lineno,e.colno,n)}),t)&&e.body.children.unshift(new s.Super(0,0,e.name,new s.Symbol(0,0,n)))}),function(e){if(e instanceof s.If||e instanceof s.For){var t=!1;if(u(e,function(e){if(e instanceof s.FilterAsync||e instanceof s.IfAsync||e instanceof s.AsyncEach||e instanceof s.AsyncAll||e instanceof s.CallExtensionAsync)return t=!0,e}),t){if(e instanceof s.If)return new s.IfAsync(e.lineno,e.colno,e.cond,e.body,e.else_);if(e instanceof s.For&&!(e instanceof s.AsyncAll))return new s.AsyncEach(e.lineno,e.colno,e.arr,e.name,e.body,e.else_)}}});var n}e.exports={transform:function(e,t){return h(e,t||[])}}},function(e,t,n){var a=n(0),u=n(2);function s(e,t){return null==e||!1===e?t:e}function o(e){return e!=e}function i(e){var t=(e=s(e,"")).toLowerCase();return u.copySafeness(e,t.charAt(0).toUpperCase()+t.slice(1))}function r(e){if(a.isString(e))return e.split("");if(a.isObject(e))return a._entries(e||{}).map(function(e){return{key:e[0],value:e[1]}});if(a.isArray(e))return e;throw new a.TemplateError("list filter: type not iterable")}function l(s){return function(e,t,n){var i=this,r=i.env.getTest(t=void 0===t?"truthy":t);return a.toArray(e).filter(function(e){return r.call(i,e,n)===s})}}function c(e){return u.copySafeness(e,e.replace(/^\s*|\s*$/g,""))}(t=e.exports={}).abs=Math.abs,t.batch=function(e,t,n){for(var i=[],r=[],s=0;s<e.length;s++)s%t==0&&r.length&&(i.push(r),r=[]),r.push(e[s]);if(r.length){if(n)for(s=r.length;s<t;s++)r.push(n);i.push(r)}return i},t.capitalize=i,t.center=function(e,t){var n;return(e=s(e,"")).length>=(t=t||80)?e:(t=t-e.length,n=a.repeat(" ",t/2-t%2),t=a.repeat(" ",t/2),u.copySafeness(e,n+e+t))},t.default=function(e,t,n){return n?e||t:void 0!==e?e:t},t.dictsort=function(e,n,t){if(!a.isObject(e))throw new a.TemplateError("dictsort filter: val must be an object");var i,r,s=[];for(i in e)s.push([i,e[i]]);if(void 0===t||"key"===t)r=0;else{if("value"!==t)throw new a.TemplateError("dictsort filter: You can only sort by either key or value");r=1}return s.sort(function(e,t){e=e[r],t=t[r];return n||(a.isString(e)&&(e=e.toUpperCase()),a.isString(t)&&(t=t.toUpperCase())),t<e?1:e===t?0:-1}),s},t.dump=function(e,t){return JSON.stringify(e,null,t)},t.escape=function(e){return e instanceof u.SafeString?e:u.markSafe(a.escape((e=null==e?"":e).toString()))},t.safe=function(e){return e instanceof u.SafeString?e:u.markSafe((e=null==e?"":e).toString())},t.first=function(e){return e[0]},t.forceescape=function(e){return u.markSafe(a.escape((e=null==e?"":e).toString()))},t.groupby=function(e,t){return a.groupBy(e,t,this.env.opts.throwOnUndefined)},t.indent=function(e,t,n){if(""===(e=s(e,"")))return"";t=t||4;var i=e.split("\n"),r=a.repeat(" ",t),t=i.map(function(e,t){return 0!==t||n?""+r+e:e}).join("\n");return u.copySafeness(e,t)},t.join=function(e,t,n){return t=t||"",(e=n?a.map(e,function(e){return e[n]}):e).join(t)},t.last=function(e){return e[e.length-1]},t.length=function(e){return void 0!==(e=s(e,""))?"function"==typeof Map&&e instanceof Map||"function"==typeof Set&&e instanceof Set?e.size:(!a.isObject(e)||e instanceof u.SafeString?e:a.keys(e)).length:0},t.list=r,t.lower=function(e){return(e=s(e,"")).toLowerCase()},t.nl2br=function(e){return null==e?"":u.copySafeness(e,e.replace(/\r\n|\n/g,"<br />\n"))},t.random=function(e){return e[Math.floor(Math.random()*e.length)]},t.reject=l(!1),t.rejectattr=function(e,t){return e.filter(function(e){return!e[t]})},t.select=l(!0),t.selectattr=function(e,t){return e.filter(function(e){return!!e[t]})},t.replace=function(e,t,n,i){var r=e;if(t instanceof RegExp)return e.replace(t,n);void 0===i&&(i=-1);var s="";if("number"==typeof t)t=""+t;else if("string"!=typeof t)return e;if("string"!=typeof(e="number"==typeof e?""+e:e)&&!(e instanceof u.SafeString))return e;if(""===t)return s=n+e.split("").join(n)+n,u.copySafeness(e,s);var o=e.indexOf(t);if(0===i||-1===o)return e;for(var a=0,l=0;-1<o&&(-1===i||l<i);)s+=e.substring(a,o)+n,a=o+t.length,l++,o=e.indexOf(t,a);return a<e.length&&(s+=e.substring(a)),u.copySafeness(r,s)},t.reverse=function(e){var t=a.isString(e)?r(e):a.map(e,function(e){return e});return t.reverse(),a.isString(e)?u.copySafeness(e,t.join("")):t},t.round=function(e,t,n){return t=t||0,t=Math.pow(10,t),(n="ceil"===n?Math.ceil:"floor"===n?Math.floor:Math.round)(e*t)/t},t.slice=function(e,t,n){for(var i=Math.floor(e.length/t),r=e.length%t,s=[],o=0,a=0;a<t;a++){var l=o+a*i;a<r&&o++;l=e.slice(l,o+(a+1)*i);n&&r<=a&&l.push(n),s.push(l)}return s},t.sum=function(e,t,n){return(n=void 0===n?0:n)+(e=t?a.map(e,function(e){return e[t]}):e).reduce(function(e,t){return e+t},0)},t.sort=u.makeMacro(["value","reverse","case_sensitive","attribute"],[],function(e,n,i,r){var s=this,e=a.map(e,function(e){return e}),o=a.getAttrGetter(r);return e.sort(function(e,t){e=r?o(e):e,t=r?o(t):t;if(s.env.opts.throwOnUndefined&&r&&(void 0===e||void 0===t))throw new TypeError('sort: attribute "'+r+'" resolved to undefined');return!i&&a.isString(e)&&a.isString(t)&&(e=e.toLowerCase(),t=t.toLowerCase()),e<t?n?1:-1:t<e?n?-1:1:0}),e}),t.string=function(e){return u.copySafeness(e,e)},t.striptags=function(e,t){var n=c((e=s(e,"")).replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>|<!--[\s\S]*?-->/gi,"")),i="",i=t?n.replace(/^ +| +$/gm,"").replace(/ +/g," ").replace(/(\r\n)/g,"\n").replace(/\n\n\n+/g,"\n\n"):n.replace(/\s+/gi," ");return u.copySafeness(e,i)},t.title=function(e){var t=(e=s(e,"")).split(" ").map(i);return u.copySafeness(e,t.join(" "))},t.trim=c,t.truncate=function(e,t,n,i){var r=e;return(e=s(e,"")).length<=(t=t||255)?e:(e=n?e.substring(0,t):(-1===(n=e.lastIndexOf(" ",t))&&(n=t),e.substring(0,n)),u.copySafeness(r,e+=null!=i?i:"..."))},t.upper=function(e){return(e=s(e,"")).toUpperCase()},t.urlencode=function(e){var n=encodeURIComponent;return a.isString(e)?n(e):(a.isArray(e)?e:a._entries(e)).map(function(e){var t=e[0],e=e[1];return n(t)+"="+n(e)}).join("&")};var h=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,f=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,d=/^https?:\/\/.*$/,p=/^www\./,m=/\.(?:org|net|com)(?:\:|\/|$)/;t.urlize=function(e,i,t){o(i)&&(i=1/0);var r=!0===t?' rel="nofollow"':"";return e.split(/(\s+)/).filter(function(e){return e&&e.length}).map(function(e){var t=e.match(h),t=t?t[1]:e,n=t.substr(0,i);return d.test(t)?'<a href="'+t+'"'+r+">"+n+"</a>":p.test(t)?'<a href="http://'+t+'"'+r+">"+n+"</a>":f.test(t)?'<a href="mailto:'+t+'">'+t+"</a>":m.test(t)?'<a href="http://'+t+'"'+r+">"+n+"</a>":e}).join("")},t.wordcount=function(e){return(e=(e=s(e,""))?e.match(/\w+/g):null)?e.length:null},t.float=function(e,t){return o(e=parseFloat(e))?t:e};n=u.makeMacro(["value","default","base"],[],function(e,t,n){void 0===n&&(n=10);e=parseInt(e,n);return o(e)?t:e});t.int=n,t.d=t.default,t.e=t.escape},function(e,t,n){function r(e,t){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}n=function(n){var e,t;function i(e){var t=n.call(this)||this;return t.precompiled=e||{},t}return t=n,(e=i).prototype=Object.create(t.prototype),r(e.prototype.constructor=e,t),i.prototype.getSource=function(e){return this.precompiled[e]?{src:{type:"code",obj:this.precompiled[e]},path:e}:null},i}(n(6));e.exports={PrecompiledLoader:n}},function(e,t,n){var i=n(2).SafeString;t.callable=function(e){return"function"==typeof e},t.defined=function(e){return void 0!==e},t.divisibleby=function(e,t){return e%t==0},t.escaped=function(e){return e instanceof i},t.equalto=function(e,t){return e===t},t.eq=t.equalto,t.sameas=t.equalto,t.even=function(e){return e%2==0},t.falsy=function(e){return!e},t.ge=function(e,t){return t<=e},t.greaterthan=function(e,t){return t<e},t.gt=t.greaterthan,t.le=function(e,t){return e<=t},t.lessthan=function(e,t){return e<t},t.lt=t.lessthan,t.lower=function(e){return e.toLowerCase()===e},t.ne=function(e,t){return e!==t},t.null=function(e){return null===e},t.number=function(e){return"number"==typeof e},t.odd=function(e){return e%2==1},t.string=function(e){return"string"==typeof e},t.truthy=function(e){return!!e},t.undefined=function(e){return void 0===e},t.upper=function(e){return e.toUpperCase()===e},t.iterable=function(e){return"undefined"!=typeof Symbol?!!e[Symbol.iterator]:Array.isArray(e)||"string"==typeof e},t.mapping=function(e){var t=null!=e&&"object"==typeof e&&!Array.isArray(e);return Set?t&&!(e instanceof Set):t}},function(e,t,n){e.exports=function(){return{range:function(e,t,n){var i=[];if(0<(n=void 0===t?(t=e,e=0,1):n||1))for(var r=e;r<t;r+=n)i.push(r);else for(var s=e;t<s;s+=n)i.push(s);return i},cycler:function(){return e=Array.prototype.slice.call(arguments),t=-1,{current:null,reset:function(){t=-1,this.current=null},next:function(){return++t>=e.length&&(t=0),this.current=e[t],this.current}};var e,t},joiner:function(e){return t=(t=e)||",",n=!0,function(){var e=n?"":t;return n=!1,e};var t,n}}}},function(e,t,n){var i=n(4);e.exports=function(n,e){function t(e,t){if(this.name=e,this.path=e,this.defaultEngine=t.defaultEngine,this.ext=i.extname(e),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}return t.prototype.render=function(e,t){n.render(this.name,e,t)},e.set("view",t),e.set("nunjucksEnv",n),n}},function(e,t,n){var u=n(4),c=n(4),o=n(0)._prettifyError,a=n(5),h=n(7).Environment,f=n(24);function d(t,e){return Array.isArray(e)&&e.some(function(e){return t.match(e)})}function p(e,t){(t=t||{}).isString=!0;var n=t.env||new h([]),i=t.wrapper||f;if(t.name)return i([m(e,t.name,n)],t);throw new Error('the "name" option is required when compiling a string')}function m(e,t,n){var i,r=(n=n||new h([])).asyncFilters,s=n.extensionsList;t=t.replace(/\\/g,"/");try{i=a.compile(e,r,s,t,n.opts)}catch(e){throw o(t,!1,e)}return{name:t,template:i}}e.exports={precompile:function(s,o){var e=(o=o||{}).env||new h([]),t=o.wrapper||f;if(o.isString)return p(s,o);var n=u.existsSync(s)&&u.statSync(s),i=[],a=[];if(n.isFile())i.push(m(u.readFileSync(s,"utf-8"),o.name||s,e));else if(n.isDirectory()){!function i(r){u.readdirSync(r).forEach(function(e){var t=(e=c.join(r,e)).substr(c.join(s,"/").length),n=u.statSync(e);n&&n.isDirectory()?d(t+="/",o.exclude)||i(e):d(t,o.include)&&a.push(e)})}(s);for(var r=0;r<a.length;r++){var l=a[r].replace(c.join(s,"/"),"");try{i.push(m(u.readFileSync(a[r],"utf-8"),l,e))}catch(e){if(!o.force)throw e;console.error(e)}}}return t(i,o)},precompileString:p}},function(e,t,n){e.exports=function(e,t){var n="";t=t||{};for(var i=0;i<e.length;i++){var r=JSON.stringify(e[i].name);n+="(function() {(window.nunjucksPrecompiled = window.nunjucksPrecompiled || {})["+r+"] = (function() {\n"+e[i].template+"\n})();\n",t.asFunction&&(n+="return function(ctx, cb) { return nunjucks.render("+r+", ctx, cb); }\n"),n+="})();\n"}return n}},function(e,t,n){e.exports=function(){var t,e,u,o=this.runtime,c=this.lib,n=this.compiler.Compiler,i=this.parser.Parser,h=this.nodes,f=this.lexer,r=o.contextOrFrameLookup,s=o.memberLookup;function d(e){return{index:e.index,lineno:e.lineno,colno:e.colno}}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n&&(t=n.prototype.assertType),i&&(e=i.prototype.parseAggregate),o.contextOrFrameLookup=function(e,t,n){var i=r.apply(this,arguments);if(void 0!==i)return i;switch(n){case"True":return!0;case"False":return!1;case"None":return null;default:return}},h&&n&&i&&(u=h.Node.extend("Slice",{fields:["start","stop","step"],init:function(e,t,n,i,r){n=n||new h.Literal(e,t,null),i=i||new h.Literal(e,t,null),r=r||new h.Literal(e,t,1),this.parent(e,t,n,i,r)}}),n.prototype.assertType=function(e){e instanceof u||t.apply(this,arguments)},n.prototype.compileSlice=function(e,t){this._emit("("),this._compileExpression(e.start,t),this._emit("),("),this._compileExpression(e.stop,t),this._emit("),("),this._compileExpression(e.step,t),this._emit(")")},i.prototype.parseAggregate=function(){var t=this,n=d(this.tokens);n.colno--,n.index--;try{return e.apply(this)}catch(e){var i=d(this.tokens),r=function(){return c._assign(t.tokens,i),e},s=(c._assign(this.tokens,n),this.peeked=!1,this.peekToken());if(s.type===f.TOKEN_LEFT_BRACKET){this.nextToken();for(var o=new u(s.lineno,s.colno),a=!1,l=0;l<=o.fields.length&&!this.skip(f.TOKEN_RIGHT_BRACKET);l++){if(l===o.fields.length){if(!a)break;this.fail("parseSlice: too many slice components",s.lineno,s.colno)}a=!!this.skip(f.TOKEN_COLON)||(o[o.fields[l]]=this.parseExpression(),this.skip(f.TOKEN_COLON))||a}if(a)return new h.Array(s.lineno,s.colno,[o])}throw r()}});var l={pop:function(e){if(void 0===e)return this.pop();if(e>=this.length||e<0)throw new Error("KeyError");return this.splice(e,1)},append:function(e){return this.push(e)},remove:function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return this.splice(t,1);throw new Error("ValueError")},count:function(e){for(var t=0,n=0;n<this.length;n++)this[n]===e&&t++;return t},index:function(e){if(-1===(e=this.indexOf(e)))throw new Error("ValueError");return e},find:function(e){return this.indexOf(e)},insert:function(e,t){return this.splice(e,0,t)}},p={items:function(){return c._entries(this)},values:function(){return c._values(this)},keys:function(){return c.keys(this)},get:function(e,t){e=this[e];return e=void 0===e?t:e},has_key:function(e){return a(this,e)},pop:function(e,t){var n=this[e];if(void 0===n&&void 0!==t)n=t;else{if(void 0===n)throw new Error("KeyError");delete this[e]}return n},popitem:function(){var e,t=c.keys(this);if(t.length)return e=this[t=t[0]],delete this[t],[t,e];throw new Error("KeyError")},setdefault:function(e,t){return void 0===t&&(t=null),e in this||(this[e]=t),this[e]},update:function(e){return c._assign(this,e),null}};return p.iteritems=p.items,p.itervalues=p.values,p.iterkeys=p.keys,o.memberLookup=function(e,t,n){return 4===arguments.length?function(e,t,n,i){e=e||[],null===t&&(t=i<0?e.length-1:0),null===n?n=i<0?-1:e.length:n<0&&(n+=e.length),t<0&&(t+=e.length);for(var r=[],s=t;!(s<0||s>e.length||0<i&&n<=s||i<0&&s<=n);s+=i)r.push(o.memberLookup(e,s));return r}.apply(this,arguments):c.isArray(e=e||{})&&a(l,t)?l[t].bind(e):c.isObject(e)&&a(p,t)?p[t].bind(e):s.apply(this,arguments)},function(){o.contextOrFrameLookup=r,o.memberLookup=s,n&&(n.prototype.assertType=t),i&&(i.prototype.parseAggregate=e)}}}],r={},i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=11);function i(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,i),t.l=!0,t)).exports}var n,r},e.exports=n()}),nunjucks$1=getDefaultExportFromCjs(nunjucks);class TestData{}TestData.ViewOfObsidianTemplate={title:"test title 2",url:"https://www.dotalk.cn/product/wucai",wucaiurl:"",readurl:"",tags:"",trimtags:"",mergedtags:"",notetype:"page",pagenote:"",pagescore:1,isstar:!1,ispagemirror:!1,isdailynote:!1,highlights:[{note:"",imageUrl:"",imageurl:"",updateat_ts:1702951131,createat_ts:1702951131,type:"highlight",annotation:"",annonation:"",color:"",slotid:1,refid:"323aef",refurl:""}],highlightcount:12,createat:"",createat_ts:1702951131,updateat:"",updateat_ts:1702951131,noteid:"232ad",citekey:"",author:"",publishat:"",publishat_ts:1702951131,diffupdateat_ts:0,domain2:"",domain:"",mdcontent:""},TestData.ViewOfObsidianTitle={title:"网页标题",createat_ts:Math.floor(+new Date/1e3),updateat_ts:Math.floor(+new Date/1e3),domain2:"aa.com",domain:"bb.aa.com",notetype:"page",isdailynote:!1},TestData.templateObStyle1=`---
标题: "{{title}}"
笔记ID: {{noteid}}
笔记类型: {{notetype}}
星标: {{isstar}}
tags: {{mergedtags}}
{% if not isdailynote %}
域名: {{domain}}
域名2: {{domain2}}
作者: "{{author}}"
原文链接: "{{url}}"
{% endif %}
五彩链接: "{{wucaiurl}}"
划线数量: {{highlightcount}}
创建时间: {{createat}}
更新时间: {{updateat}}
---

## {{title}} 
{{alltags}}

## 页面笔记
{% block pagenote %}
{{pagenote}}
{% endblock %}

## 划线列表
{% block highlights %}
{% for item in highlights %}
{% set suffix = "[Link]("+item.refurl+")" %}
{{ item | style1({prefix:"- ", suffix:suffix, anno:"	- " }) }}
{% endfor %}
{% endblock %}

## 全文剪藏
{% block mdcontent %}
{{mdcontent}}
{% endblock %}`;const strref="string";class WuCaiTemplates{static isNeedRender(e){return 0<=(e||"").indexOf(WuCaiTemplates.leftHolder)}constructor(){this.templateEnv=nunjucks$1.configure({autoescape:!1,trimBlocks:!0,lstripBlocks:!0}),this.templateEnv.addFilter("date",function(e,t){return e<=0?"":(e=new Date(1e3*e),WuCaiUtils.formatDateTime(e,t))}),this.templateEnv.addFilter("pretty",function(e,t){var n=(t=t||{}).prefix||"",i=void 0===t.trim||t.trim;if((e=e||"").length<=0)return"";var r=e.split(/\n/),s=[];for(let t=0;t<r.length;t++){let e=r[t]||"";(e=i?e.replace(/^\s+|\s+$/g,""):e).length<=0||s.push(n+e+"\n")}return s.join("\n")}),this.templateEnv.addFilter("style_dailynote",function(e,t){var n,i,r=[],s=(t=t||{}).groupby||"YYYY-MM-DD HH:mm",o={},a=[];let l={};for(n of e){var u=WuCaiUtils.formatTime(n.createat_ts||n.updateat_ts||0,s);null==l[u]&&(l[u]=1,a.push(u),o[u]=[]),o[u].push(n)}e=l=void 0;for(i of a){r.push("- "+i);var c,h,f,d,p,m=WuCaiUtils.repeatStr("\t",1),g=WuCaiUtils.repeatStr("\t",2);for(c of o[i])if(c.imageurl)r.push(`${m}- ![](${c.imageurl})`);else{for(h of(c.note||"").split("\n"))h&&!WuCaiUtils.isOnlyDateTimeLine(h)&&(f=WuCaiUtils.detectIsMardownFormat(h)?"":"- ",r.push(m+f+h));if(c.annotation)for(d of(c.annotation||"").split("\n"))d&&!WuCaiUtils.isOnlyDateTimeLine(d)&&(p=WuCaiUtils.detectIsMardownFormat(d)?"":"- ",r.push(g+p+d))}}return r.join("\n")}),this.templateEnv.addFilter("yaml_text",function(e){return e?typeof e!==strref?"error type":" |-\n  "+e.replace(/\n/g,"\n  "):""}),this.templateEnv.addFilter("yaml_field",function(e,t){return t&&e?(t.indexOf(":")<0&&(t+=":"),t+" "+e):""}),this.templateEnv.addFilter("yaml_list",function(e,t=",",n){if(!e)return"";t=t||",";let i=[];return typeof e===strref?i=e.split(t):Array.isArray(e)&&(i=e),!(i=i.filter(e=>e))||i.length<=0?"":WuCaiUtils.toYAMLList(i)}),this.templateEnv.addFilter("tobacklink",function(e){var t;return e&&(t=e.split(" "),WuCaiUtils.formatTags(t,!1))}),this.templateEnv.addFilter("style1",function(t,e){var n=t.note||"",i=(e=e||{}).prefix||"";let r=(e.suffix||"").trim();var s=t.annotation||"",o=e.anno||"",a=e.annosuffix||"",l=t.type||"highlight",u=e.color_tags||[];let c=e.color||"";var h,f=e.color_line||e.colorline||!1,d=t.slotid||1,e=e.refid&&!0,p=[];let m=!1;if("math"===l)p.push(`
$$
${n}
$$
`),m=!0;else if("image"===l)p.push(i+`![](${n})`),m=!0;else if(WuCaiUtils.detectIsMardownFormat(n))p.push(n),m=!0;else{let e=0;for(h of n.split(/\n/))(h=WuCaiUtils.trimString(h))&&((c=0==e&&u&&0<u.length?u[d-1]:c)&&0==e?p.push(`${i}<font color="${t.color}">${c}</font>`+h):p.push(f?`${i}<font color="${t.color}">${h}</font>`:i+h),e++,m=!0)}if(m&&r&&0<p.length&&(r=" "+r.trim(),p[p.length-1]+=r),s){if(m=!1,WuCaiUtils.detectIsMardownFormat(s))p.push(s),m=!0;else{var g,y=WuCaiUtils.getPrefxFromAnnoPrefix(o);let e=0;for(g of s.split(/\n/))(g=WuCaiUtils.trimString(g)).length<=0||(o&&(/^#/.test(g)&&(g=" "+g),g=0==e?o+g:y+g),p.push(g),e++,m=!0)}m&&a&&0<p.length&&(p[p.length-1]+=" "+a)}l=p.length,e&&0<l&&(p[l-1]+=" ^"+t.refid),n=0===i.indexOf("- ");return n||0<l&&p.push(""),p.join("\n")})}precompile(e){let t=e.obTemplate||TestData.templateObStyle1;var n,i,r;t=(t=t.replace(/annonation/g,"annotation")).replace(/imageUrl/g,"imageurl"),this.pageTemplateStr=t,2===e.writeStyle?(n={},(i=WuCaiUtils.getBlocks(t)).pagenote&&(n.pagenote=WuCaiUtils.wrapBlock(i.pagenote,"pagenote")),i.highlights&&(n.highlights=WuCaiUtils.wrapBlock(i.highlights,"highlights")),i.mdcontent&&(n.mdcontent=WuCaiUtils.wrapBlock(i.mdcontent,"mdcontent")),this.pagenoteEngine=nunjucks$1.compile(i.pagenote,this.templateEnv),this.highlightsEngine=nunjucks$1.compile(i.highlights,this.templateEnv),this.mdcontentEngine=nunjucks$1.compile(i.mdcontent,this.templateEnv),this.blocks=i,i=WuCaiUtils.replaceBlocks(t,n),this.pageEngine=nunjucks$1.compile(i,this.templateEnv)):this.pageEngine=nunjucks$1.compile(this.pageTemplateStr,this.templateEnv);let s=e.titleTemplate,o=(s=(s=s||'wucai-{{ createat_ts | date("YYYY-MM-DD") }}').replace(/[\n]+/,"").trim(),this.titleTemplateStr=s,this.titleEngine=nunjucks$1.compile(s,this.templateEnv),"");for(r of[{name:"Template",tpl:this.pageEngine,view:TestData.ViewOfObsidianTemplate},{name:"Title Template",tpl:this.titleEngine,view:TestData.ViewOfObsidianTitle}])try{r.tpl.render(r.view)}catch(e){o+="Template Error: "+e;break}return o}}function logger(e){BGCONSTS.IS_DEBUG&&console.log(e)}WuCaiTemplates.leftHolder="{{",WuCaiTemplates.rightHolder="}}";const WAITING_STATUSES=["PENDING","RECEIVED","STARTED","RETRY"],API_URL_INIT="/apix/openapi/wucai/sync/init",API_URL_DOWNLOAD="/apix/openapi/wucai/sync/download",API_URL_ACK="/apix/openapi/wucai/sync/ack",API_URL_DELETE_SERVER_NOTE="/apix/openapi/wucai/sync/delete",API_URL_ARCHIVE_NOTE="/apix/openapi/wucai/sync/archive",WRITE_STYLE_OVERWRITE=1,WRITE_STYLE_APPEND=2,DEFAULT_SETTINGS={token:"",useridx:"",wuCaiDir:"WuCai",frequency:"0",triggerOnLoad:!0,lastSyncFailed:!1,refreshNotes:!1,notesToRefresh:[],reimportShowConfirmation:!0,lastCursor:"",dataVersion:0,notePaths:{},exportConfig:{pageMirrorStyle:2,truncateTile255:0,writeStyle:2,highlightStyle:1,annotationStyle:1,tagStyle:1,obTemplate:"",titleTemplate:"",obQuery:""}};function localize(e){return e}class WuCaiPlugin extends obsidian.Plugin{constructor(){super(...arguments),this.scheduleInterval=null}checkResponseBody(e,t){if(!t)return!1;if(t&&1===t.code)return!1;var n=t.code;1e4===n&&(this.settings.token="",this.settings.useridx="");let i=localize(t.message||"call api failed");return n&&(i+=", error:"+n),this.handleSyncError(e,i),!0}getErrorMessageFromResponse(e){return e&&409===e.status?"Sync in progress initiated by different client":e&&417===e.status?"Obsidian export is locked. Wait for an hour.":""+(e?e.statusText:"Can't connect to server")}handleSyncError(e,t){this.settings.lastSyncFailed=!0,this.saveSettings(),e?(this.showInfoStatus(e.buttonEl.parentElement,t,"wc-error"),e.buttonEl.setText(localize("Run sync"))):this.notice(t,!0,4,!0)}handleSyncSuccess(e,t="Synced",n=""){this.settings.lastSyncFailed=!1;n=this.getLastCursor(n,this.settings.lastCursor);n&&(this.settings.lastCursor=n),this.saveSettings(),e&&(this.showInfoStatus(e.buttonEl.parentNode.parentElement,t,"wc-success"),e.buttonEl.setText("Run sync"))}callApi(n,i){return __awaiter(this,void 0,void 0,function*(){var e=Math.floor(+new Date/1e3);i.v=BGCONSTS.VERSION_NUM,i.serviceId=BGCONSTS.SERVICE_ID,n+=`?appid=${BGCONSTS.APPID}&ep=${BGCONSTS.ENDPOINT}&version=${BGCONSTS.VERSION}&reqtime=`+e;let t;return t="/"==n[0]?BGCONSTS.BASE_URL+n:n,fetch(t,{headers:Object.assign(Object.assign({},this.getAuthHeaders()),{"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(i)})})}exportInit(r,e,s=""){return __awaiter(this,void 0,void 0,function*(){if(this.stopSyncing)logger({msg:"WuCai sync stoped, because of stopSyncing status"});else{var t,n=this.app.vault.getAbstractFileByPath(this.settings.wuCaiDir),n=!(n&&n instanceof obsidian.TFolder),i=(n&&(this.settings.lastCursor="",this.settings.notesToRefresh=[],this.settings.notePaths={}),logger({msg:"onload last cursor",lastCursor:this.settings.lastCursor,flagx:s,isDirDeleted:n,isSync:this.isSyncing}),this.settings.lastCursor),n={noteDirDeleted:n,lastCursor2:i};let e;try{e=yield this.callApi(API_URL_INIT,n)}catch(e){logger({msg:"WuCai Official plugin: fetch failed in exportInit: ",e:e})}e&&e.ok?(n=yield e.json(),this.checkResponseBody(r,n)?this.isSyncing=!1:(logger({msg:"in exportInit",initRet:n=n.data||{},lastCursor2:i,flagx:s}),this.settings.exportConfig=n.exportConfig,t={obTemplate:n.exportConfig.obTemplate,titleTemplate:n.exportConfig.titleTemplate,writeStyle:n.exportConfig.writeStyle},(t=this.pageTemplate.precompile(t))?(this.handleSyncError(r,t),this.isSyncing=!1):((i=this.getLastCursor(n.lastCursor2,i))&&(this.settings.lastCursor=i),yield this.saveSettings(),"SYNCED"===n.taskStatus?(this.handleSyncSuccess(r,"Synced",i),this.notice("Latest WuCai sync already happened on your other device. Data should be up to date",!1,4,!0),logger({msg:"syncing -> false",flagx:s+" init+ck+synced"}),this.isSyncing=!1):"EXPIRED"==n.taskStatus?(this.handleSyncError(r,"sync service expried"),logger({msg:"syncing -> false",flagx:s+" init+ck+expired"}),this.isSyncing=!1):WAITING_STATUSES.includes(n.taskStatus)?(0<n.notesExported?(t=localize("Exporting WuCai data")+` (${n.notesExported} / ${n.totalNotes}) ...`,this.notice(t)):this.notice("Building export..."),yield new Promise(e=>setTimeout(e,3e3)),yield this.exportInit(r,!1,"exportInit timeout")):"SYNCING"===n.taskStatus?(this.notice("Syncing WuCai data"),yield this.downloadArchive(i,[],r,s+" init+ck")):(this.handleSyncError(r,"Sync failed,"+n.taskStatus),logger({msg:"syncing -> false",flagx:s+" init+ck+exception"}),this.isSyncing=!1)))):(logger({msg:"WuCai Official plugin: bad response in exportInit: ",rsp:e}),this.handleSyncError(r,this.getErrorMessageFromResponse(e)),this.isSyncing=!1)}})}notice(e,t=!1,n=0,i=!1){t&&new obsidian.Notice(e),obsidian.Platform.isMobileApp?t||new obsidian.Notice(e):this.statusBar.displayMessage(e.toLowerCase(),n,i)}showInfoStatus(e,t,n=""){e=e.find(".wc-info-container");e&&(e.setText(t),e.addClass(n))}clearInfoStatus(e){e.find(".wc-info-container").empty()}getAuthHeaders(){return{AUTHORIZATION:"Token "+(this.settings.token||""),"Obsidian-Client":""+this.getObsidianClientID()}}getLastCursor(e,t){return e||t||""}processEntity(T,n){return __awaiter(this,void 0,void 0,function*(){let e;var i=WuCaiUtils.getDomainByUrl(T.url),r=WuCaiUtils.getDomain2ByDomain(i),s=3===T.noteType,o=s?"dailynote":"page",a=(e=n?(a={title:WuCaiUtils.normalTitle(T.title),createat_ts:T.createAt,updateat_ts:Math.max(T.updateAt,T.createAt),domain2:r||"",domain:i||"",notetype:o,isdailynote:s},this.pageTemplate.titleEngine.render(a)):this.pageTemplate.titleTemplateStr,this.settings.exportConfig),l=(0<a.truncateTile255&&(l=`-${T.noteIdX}.md`.length,e=WuCaiUtils.truncateFileName255(e,l,a.truncateTile255)),e=`${this.settings.wuCaiDir}/${e}-${T.noteIdX}.md`,obsidian.normalizePath(e).replace(/[\/ \s]+$/,""));if(l&&!(l.length<=0)){let n=!1;var t,u,c=this.settings.notePaths[T.noteIdX]||"";c&&c!=l&&(c=yield this.app.vault.getAbstractFileByPath(c))&&c instanceof obsidian.TFile&&(!(t=WuCaiUtils.getDirFromPath(l))||(u=yield this.app.vault.getAbstractFileByPath(t))&&u instanceof obsidian.TFolder||(yield this.app.vault.createFolder(t),n=!0),yield this.app.vault.rename(c,l)),this.settings.notePaths[T.noteIdX]=l;try{n||!(h=WuCaiUtils.getDirFromPath(l))||(f=yield this.app.vault.getAbstractFileByPath(h))&&f instanceof obsidian.TFolder||(yield this.app.vault.createFolder(h)),T.highlights=T.highlights||[],T.pageScore=T.pageScore||0,T.sou=T.sou||"";var h,f,d=1===a.tagStyle,p=0<T.pageScore,m=WuCaiUtils.formatTags(T.tags,d),g=WuCaiUtils.mergeTags(T.tags,T.notetags,d),y=WuCaiUtils.toYAMLList(WuCaiUtils.trimTags(m)),_=WuCaiUtils.toYAMLList(WuCaiUtils.trimTags(g));let e="",t=!1;2!==a.pageMirrorStyle&&T.sou&&(e=yield WuCaiUtils.getPageMirrorMarkdown(T.sou),e=WuCaiUtils.formatPageMirror(e),t=!0);var v,w,k,b={title:WuCaiUtils.formatPageTitle(T.title),url:T.url,wucaiurl:T.wucaiurl||"",readurl:T.readurl||"",tags:m,alltags:g,trimtags:y,mergedtags:_,notetype:o,pagenote:WuCaiUtils.formatPageNote(T.pageNote,d),pagescore:T.pageScore,isstar:p,ispagemirror:t,isdailynote:s,highlights:WuCaiUtils.formatHighlights(T.url||"",T.highlights,a),highlightcount:T.highlights.length,createat:WuCaiUtils.formatTime(T.createAt),createat_ts:T.createAt,updateat:WuCaiUtils.formatTime(T.updateAt),updateat_ts:T.updateAt,noteid:T.noteIdX,citekey:T.citekey||"",author:T.author||"",publishat:WuCaiUtils.formatTime(T.publishat),publishat_ts:T.publishat||0,diffupdateat_ts:WuCaiUtils.getDiffDay(T.createAt,T.updateAt),domain:i,domain2:r,mdcontent:e},S=yield this.app.vault.getAbstractFileByPath(l),x=S&&S instanceof obsidian.TFile;x&&WRITE_STYLE_OVERWRITE!==a.writeStyle?WRITE_STYLE_APPEND===a.writeStyle?(v=yield this.app.vault.read(S),w=WuCaiUtils.renderTemplateWithEditable(b,v,this.pageTemplate),yield this.app.vault.modify(S,w)):this.notice("WuCai: error writeStyle "+a.writeStyle,!0,4,!0):(k=WuCaiUtils.renderTemplate(b,this.pageTemplate),x?yield this.app.vault.modify(S,k):yield this.app.vault.create(l,k))}catch(e){logger([`WuCai Official plugin: error writing ${l}:`,e]),this.notice(`WuCai: error while writing ${l}: `+e,!0,4,!0),T.noteIdX&&(this.settings.notesToRefresh.push(T.noteIdX),yield this.saveSettings())}}})}downloadArchive(s,o,a,l=""){return __awaiter(this,void 0,void 0,function*(){let e;var{writeStyle:t,obQuery:n}=this.settings.exportConfig;BGCONSTS.IS_DEBUG&&(s=""),logger({msg:"download",flagx:l,lastCursor2:s,obQuery:n});try{e=yield this.callApi(API_URL_DOWNLOAD,{lastCursor2:s,noteIdXs:o,flagx:l,writeStyle:t,q:n||""})}catch(e){logger({msg:"WuCai Official plugin: fetch failed in downloadArchive: ",e:e})}if(e&&e.ok){t=yield e.json();if(this.checkResponseBody(a,t))logger({msg:"syncing -> false",flagx:l+" download+nil"}),this.isSyncing=!1;else{var n=t.data,t=n.notes||[],i=WuCaiTemplates.isNeedRender(this.pageTemplate.titleTemplateStr);for(const r of t)r&&(yield this.processEntity(r,i));(s=this.getLastCursor(n.lastCursor2,s))&&(this.settings.lastCursor=s),yield this.saveSettings(),t.length<=0||BGCONSTS.IS_DEBUG?(logger({msg:"syncing -> false",flagx:l+" download+done"}),this.isSyncing=!1,yield this.acknowledgeSyncCompleted(a),this.handleSyncSuccess(a,"Synced!",s),this.notice("WuCai sync completed",!0,1,!0),obsidian.Platform.isMobileApp&&this.notice("If you don't see all of your WuCai files reload obsidian app",!0)):this.stopSyncing?(this.isSyncing=!1,this.notice("WuCai sync stoped, because of stopSyncing",!0,1,!0)):(this.handleSyncSuccess(a,"Syncing",s),yield new Promise(e=>setTimeout(e,5e3)),this.downloadArchive(s,[],a,l))}}else logger({msg:"WuCai Official plugin: bad response in downloadArchive: ",response:e}),this.handleSyncError(a,this.getErrorMessageFromResponse(e)),logger({msg:"syncing -> false",flagx:l+" download+exception"}),this.isSyncing=!1})}acknowledgeSyncCompleted(n){return __awaiter(this,void 0,void 0,function*(){let e;try{var t={lastCursor2:this.settings.lastCursor};e=yield this.callApi(API_URL_ACK,t)}catch(e){logger(["WuCai Official plugin: fetch failed to acknowledged sync: ",e])}e&&!e.ok&&(logger(["WuCai Official plugin: bad response in acknowledge sync: ",e]),this.handleSyncError(n,this.getErrorMessageFromResponse(e)))})}configureSchedule(){return __awaiter(this,void 0,void 0,function*(){var e=parseInt(this.settings.frequency),t=60*e*1e3;logger(["WuCai Official plugin: setting interval to ",e,"minutes"]),window.clearInterval(this.scheduleInterval),this.scheduleInterval=null,t&&(this.scheduleInterval=window.setInterval(()=>{this.isSyncing||this.stopSyncing||(this.isSyncing=!0,logger(["start sync, schedule",this.settings.lastCursor,this.isSyncing]),this.exportInit(null,!0,"schedule init"))},t),this.registerInterval(this.scheduleInterval))})}refreshNoteExport(){return __awaiter(this,void 0,void 0,function*(){if(this.settings.refreshNotes){var n=this.settings.notesToRefresh||[];if(!(n.length<=0)){let t=[];for(let e=0;e<n.length&&(t.push(n[e]),!(5<=e));e++);this.downloadArchive(null,t,null,"refresh"),this.settings.notesToRefresh=this.settings.notesToRefresh.filter(e=>!t.includes(e))}}})}addNoteToRefresh(e){return __awaiter(this,void 0,void 0,function*(){this.settings.notesToRefresh.push(e),yield this.saveSettings()})}reimportFile(e,t){}startSync(e="",t=null){if(this.isSyncing)this.notice("WuCai sync already in progress",!0);else{this.isSyncing=!0,this.saveSettings();try{this.exportInit(t,!1,e||"startSync init")}catch(e){this.notice("WuCai sync error, "+e),this.isSyncing=!1}}}logout(){this.stopSyncing=!0,this.settings.lastCursor="",this.settings.token="",this.settings.useridx="",this.resetObsidianClientID(),this.saveSettings()}onload(){return __awaiter(this,void 0,void 0,function*(){logger({msg:"load WuCai plugin"}),this.stopSyncing=!1,obsidian.Platform.isMobileApp||(this.statusBar=new StatusBar(this.addStatusBarItem()),this.registerInterval(window.setInterval(()=>this.statusBar.display(),1e3)));let n=this;var e;yield this.loadSettings(),this.addCommand({id:"sync",name:"Sync your data now",callback:()=>{this.startSync()}}),this.addCommand({id:"archive",name:"Archive this file",editorCallback(e,t){t=t.file.path,t=WuCaiUtils.getNoteIdxFromFilePath(t);if(t.length<=0)n.notice("error, error file title",!0,4,!0);else try{n.callApi(API_URL_ARCHIVE_NOTE,{noteid:t}).then(function(t){return __awaiter(this,void 0,void 0,function*(){var e;t&&t.ok?(e=yield t.json(),n.checkResponseBody(null,e)||n.notice("archive file success",!0,4,!0)):(logger({msg:"WuCai Official plugin: bad response in delete server note: ",rsp:t}),n.handleSyncError(null,n.getErrorMessageFromResponse(t)))})})}catch(e){logger({msg:"WuCai Official plugin: archive note, error ",e:e})}}}),this.addCommand({id:"deletefromserver",name:"Delete this file from server",editorCallback(e,t){t=t.file.path,t=WuCaiUtils.getNoteIdxFromFilePath(t);if(t.length<=0)n.notice("error, error file title",!0,4,!0);else try{n.callApi(API_URL_DELETE_SERVER_NOTE,{noteid:t}).then(function(t){return __awaiter(this,void 0,void 0,function*(){var e;t&&t.ok?(e=yield t.json(),n.checkResponseBody(null,e)||n.notice("delete file success",!0,4,!0)):(logger({msg:"WuCai Official plugin: bad response in delete server note: ",rsp:t}),n.handleSyncError(null,n.getErrorMessageFromResponse(t)))})})}catch(e){logger({msg:"WuCai Official plugin: delete server note, error ",e:e})}}}),this.addSettingTab(new WuCaiSettingTab(this.app,this)),yield this.configureSchedule(),this.isSyncing=!1,this.settings.token&&this.settings.triggerOnLoad&&!this.isSyncing&&(!((e=this.app.vault.getAbstractFileByPath(this.settings.wuCaiDir))&&e instanceof obsidian.TFolder)?this.app.workspace.onLayoutReady(()=>{logger(["onload last cursor 1",this.settings.lastCursor,this.isSyncing]),this.startSync("onload + not exists")}):this.startSync("onload + exists 2"))})}onunload(){this.stopSyncing=!0,logger({msg:"unload WuCai plugin"})}loadSettings(){return __awaiter(this,void 0,void 0,function*(){this.settings=Object.assign({},DEFAULT_SETTINGS,yield this.loadData()),this.pageTemplate=new WuCaiTemplates})}saveSettings(){return __awaiter(this,void 0,void 0,function*(){yield this.saveData(this.settings)})}resetObsidianClientID(){return window.localStorage.setItem("wc-ObsidianClientId",""),this.getObsidianClientID()}getObsidianClientID(){var e=window.localStorage.getItem("wc-ObsidianClientId")||"";return e&&0<e.length||(e=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),window.localStorage.setItem("wc-ObsidianClientId",e)),e}getUserAuthToken(i,r=0){return __awaiter(this,void 0,void 0,function*(){var e=this.getObsidianClientID();0===r&&window.open(`${BGCONSTS.BASE_URL}/page/gentoken/${BGCONSTS.SERVICE_ID}/`+e);let t;try{t=yield this.callApi("/page/auth/openapi/gettoken",{did:e})}catch(e){logger({msg:"WuCai Official plugin: fetch failed in getUserAuthToken: ",e:e})}if(t&&t.ok){var e=yield t.json(),n=e.data;if(1===e.code&&n.accessToken)this.settings.token=n.accessToken,this.settings.useridx=n.useridx||"";else{if(20<r)return void logger({msg:"WuCai Official plugin: reached attempt limit in getUserAuthToken"});logger({msg:"WuCai Official plugin: didn't get token data",attempt:r}),yield new Promise(e=>setTimeout(e,1e3)),yield this.getUserAuthToken(i,r+1)}return yield this.saveSettings(),!0}logger({msg:"WuCai Official plugin: bad response in getUserAuthToken: ",response:t}),this.showInfoStatus(i.parentElement,"Authorization failed. Try again","wc-error")})}}class WuCaiSettingTab extends obsidian.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,this.plugin.isSyncing=!1}display(){let e=this.plugin.getObsidianClientID()||"",n=this["containerEl"];n.empty(),n.createEl("h1",{text:"WuCai Official"}),n.createEl("p",{text:"Created by "}).createEl("a",{text:"希果壳五彩",href:"https://www.dotalk.cn/product/wucai"}),n.getElementsByTagName("p")[0].appendText(" Version "+BGCONSTS.VERSION),n.createEl("h2",{text:"Settings"});var i=this.plugin.settings.token;if(i&&0<i.length){let t="Start Sync";this.plugin.isSyncing&&(t="Syncing ..."),new obsidian.Setting(n).setName("Sync your WuCai data with Obsidian").setDesc("On first sync, the WuCai plugin will create a new folder containing all your highlights").setClass("wc-setting-sync").addButton(e=>{e.setCta().setTooltip("Once the sync begins, you can close this plugin page").setButtonText(t).onClick(()=>__awaiter(this,void 0,void 0,function*(){this.plugin.isSyncing?new obsidian.Notice("WuCai sync already in progress"):(this.plugin.stopSyncing=!1,this.plugin.clearInfoStatus(n),yield this.plugin.saveData(this.plugin.settings),e.setButtonText("Syncing..."),this.plugin.startSync("click sync",e))}))});i=n.createEl("div",{cls:"wc-info-container"}),i=(n.find(".wc-setting-sync > .setting-item-control ").prepend(i),new obsidian.Setting(n).setName("Customize formatting options").setDesc("You can customize which items export to Obsidian and how they appear from the WuCai website").addButton(e=>{e.setButtonText("Customize").onClick(()=>{window.open(BGCONSTS.BASE_URL+"/page/plugins/obsidian/preferences")})}),new obsidian.Setting(n).setName("Customize base folder").setDesc("By default, the plugin will save all your highlights into a folder named WuCai").addText(e=>e.setPlaceholder("Defaults to: WuCai").setValue(this.plugin.settings.wuCaiDir).onChange(e=>__awaiter(this,void 0,void 0,function*(){this.plugin.isSyncing?new obsidian.Notice("WuCai sync already in progress"):(this.plugin.settings.wuCaiDir=obsidian.normalizePath(e||"WuCai"),yield this.plugin.saveSettings())}))),new obsidian.Setting(n).setName("Configure resync frequency").setDesc("If not set to Manual, WuCai will automatically resync with Obsidian when the app is open at the specified interval").addDropdown(e=>{e.addOption("0","Manual"),e.addOption("180","Every 3 hour"),e.addOption(720..toString(),"Every 12 hours"),e.addOption(1440..toString(),"Every 24 hours"),e.setValue(this.plugin.settings.frequency),e.onChange(e=>{this.plugin.settings.frequency=e,this.plugin.saveSettings(),this.plugin.configureSchedule()})}),new obsidian.Setting(n).setName("Sync automatically when Obsidian opens").setDesc("If enabled, WuCai will automatically resync with Obsidian each time you open the app").addToggle(e=>{e.setValue(this.plugin.settings.triggerOnLoad),e.onChange(e=>{this.plugin.settings.triggerOnLoad=e,this.plugin.saveSettings()})}),this.plugin.settings.lastSyncFailed&&this.plugin.showInfoStatus(n.find(".wc-setting-sync .wc-info-container").parentElement,"Last sync failed","wc-error"),this.plugin.settings.useridx||"");new obsidian.Setting(n).setName("Logout").setDesc("Logout your WuCai account "+i).addButton(e=>{e.setButtonText("Logout").setCta().onClick(e=>__awaiter(this,void 0,void 0,function*(){this.plugin.logout(),new obsidian.Notice("Logout success")}))})}else{e=this.plugin.resetObsidianClientID(),new obsidian.Setting(n).setName("Connect Obsidian to WuCai").setClass("wc-setting-connect").setDesc("The WuCai plugin enables automatic syncing of all your highlights. Note: Requires WuCai account.").addButton(e=>{e.setButtonText("Connect").setCta().onClick(e=>__awaiter(this,void 0,void 0,function*(){(yield this.plugin.getUserAuthToken(e.target))&&this.display()}))});i=n.createEl("div",{cls:"wc-info-container"});n.find(".wc-setting-connect > .setting-item-control ").prepend(i)}new obsidian.Setting(n).setName("Client ID").setDesc("Client id is "+e).addButton(e=>{e.setButtonText("WuCai Dashboard").setCta().onClick(e=>__awaiter(this,void 0,void 0,function*(){window.open("https://www.dotalk.cn/s/KE")}))}),n.createEl("p").innerHTML="Question? Please see our <a href='https://www.dotalk.cn/s/M7'>feedback</a> or view <a href='https://www.dotalk.cn/s/KH'>changelog</a></b>"}}module.exports=WuCaiPlugin;
